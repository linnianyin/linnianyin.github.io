!function(){"use strict";var t,e,s;!function(t){t[t.Line=1]="Line",t[t.DownCurve=2]="DownCurve",t[t.UpCurve=3]="UpCurve"}(t||(t={})),function(t){t[t.Return=1]="Return",t[t.Repeat=2]="Repeat",t[t.Remove=3]="Remove"}(e||(e={})),function(t){t[t.Top=1]="Top",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Bottom=4]="Bottom"}(s||(s={}));class i{static setEnemys1(t,e){const s=this["enemys"+e];for(let e=1;e<t.length;e++){const i=t[e];let l=s[i[2]];l||(s[i[2]]=[],l=s[i[2]]),l.push({id:i[0],chapter:i[1],level:i[2],difficulty:i[3],type:i[4],direntry:i[5],entry:i[6],direxit:i[7],exit:i[8],distance:i[9],time:i[10],return:i[11],route:i[12],speed:i[13],att:i[14],hp:i[15],def:i[16],shooting:i[17],atttime:i[18],bulletsp:i[19],bulletstart:i[20],in:this.getPos(i[5],i[6]),out:this.getPos(i[7],i[8])})}}static getPos(t,e){if("number"!=typeof t||"number"!=typeof e)return null;const i=new Laya.Vector2;return t==s.Top?(i.x=e,i.y=0):t==s.Left?(i.x=0,i.y=e):t==s.Right?(i.x=720,i.y=e):t==s.Bottom&&(i.x=e,i.y=1280),i}}i.enemys1={},i.enemys2={},i.enemys3={},i.enemys4={},i.enemys5={};class l{static setExps(t){for(let e=1;e<t.length;e++){const s=t[e];1==s[1]?this.upLevExps[s[2]]=s[4]:2==s[1]&&(this.levelExps[s[3]]=s[4])}}}l.levelExps={},l.upLevExps={};const a=new class{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.speed=0,this.fspeed=0,this.eneHurtStr=0,this.bosHurtStr=0,this.hp=0,this.currHP=0,this.defense=0,this.subHurt=0,this.id=1,this.chapter=1,this.rate=1,this.exp=0,this.level=1,this.skills={},this.rewards={},this.track=!1,this.cross=!1,this.unlock=[]}setAttHp(t,e){this.attack=t,this.hp=e}setChapter(){let t=this.chapter;this.chapter<5&&this.chapter++,this.rate=1;const e=r.comChapters[t-1].unlockskill;for(let t=0;t<e.length;t++){const s=e[t];this.unlock.indexOf(s)<0&&this.unlock.push(s)}}};var n,o;!function(t){t[t.Common=1]="Common",t[t.Hard=2]="Hard",t[t.Hell=3]="Hell"}(n||(n={}));class r{static setChatpers(t){const e=t[1];this.basChapter={id:e[0],nameCN:e[1],name:e[2],chapter:e[3],level:e[4],maxair:e[5],fight:e[6],fightatt:e[7],fighthp:e[8],difficulty:e[9],drop:e[10],unlockskill:[]};for(let e=2;e<t.length;e+=2){const s=t[e];this.comChapters.push({id:s[0],nameCN:s[1],name:s[2],chapter:s[3],level:s[4],maxair:s[5],fight:s[6],fightatt:s[7],fighthp:s[8],difficulty:s[9],drop:s[10],unlockskill:[]})}a.unlock=r.basChapter.unlockskill}}r.basChapter=null,r.comChapters=[];class h{static setEnemys(t){const e=this.enemys;for(let s=1;s<t.length;s++){const i=t[s];e[i[0]]={id:i[0],nameCN:i[1],icon:i[2],shooting:i[3],bullettype:i[4],skill:i[5]}}}}h.enemys={},function(t){t[t.Once=1]="Once",t[t.Add=2]="Add",t[t.Always=3]="Always",t[t.Supply=4]="Supply"}(o||(o={}));class c{static setSkills(t){for(let e=1;e<t.length;e++){const s=t[e];this.skills[s[0]]={id:s[0],nameCN:s[1],name:s[2],describeCN:s[3],describe:s[4],skilltype:s[5],fightadd:s[6],value:s[7],bullettype:s[8],buff:s[9],bufftime:s[10],add:s[11],speed:"number"==typeof s[13]?s[13]:0,fspeed:"number"==typeof s[14]?s[14]:0,robotsp:"number"==typeof s[14]?s[15]:0,robotbullet:"number"==typeof s[14]?s[16]:0};const i=(s[12]+"").split("|"),l=i[0]?parseInt(i[0]):0,a=i[1]?parseInt(i[1]):0;l?r.comChapters[a-1].unlockskill.push(s[0]):s[11]!=o.Add&&1e3!=s[0]&&r.basChapter.unlockskill.push(s[0])}r.basChapter.unlockskill.push(1001,1005,1009,1016,1020)}}c.skills={};const d=new class{constructor(){this.level=1,this.planes=[1,2]}};class p{static setPlanes(t){for(let e=1;e<t.length;e++){const s=t[e];for(let t=1;t<5;t++){const e=this["plane"+t];e&&(e[s[1]]={id:t,att:s[3+2*t],hp:s[4+2*t],addAtt:s[3],addHp:s[4]})}}let e=a.id,s=d.level;const i=this.getAttHp(s,e);a.hp=i.hp,a.attack=i.att}static setGolds(t){for(let e=1;e<t.length;e++){const s=t[e];this.upPlaGold[s[1]]={gold:s[5],adgo:s[4]}}}static getAttHp(t,e){const s={att:0,hp:0},i=this["plane"+e];if(i){const e=i[t];if(e)s.att=e.att,s.hp=e.hp;else{const e=Object.keys(i).sort((t,e)=>{return parseInt(t)-parseInt(e)});for(let l=0;l<e.length;l++){const a=parseInt(e[l]),n=l+1>=e.length?9999:parseInt(e[l+1]);if(t>a&&t<n){let e=i[a];s.att=e.att+(t-a)*e.addAtt,s.hp=e.hp+(t-a)*e.addHp;break}}}}return s}static getGold(t){let e=0;const s=this.upPlaGold,i=s[t];if(i)e=i.gold;else{const i=Object.keys(s).sort((t,e)=>{return parseInt(t)-parseInt(e)});for(let l=0;l<i.length;l++){const a=parseInt(i[l]),n=l+1>=i.length?9999:parseInt(i[l+1]);if(t>a&&t<n){let i=s[a];e=i.gold+(t-a)*i.adgo;break}}}return e}}p.plane1={},p.plane2={},p.plane3={},p.plane4={},p.upPlaGold={};class y{static setPlanes(t){for(let e=1;e<t.length;e++){const s=t[e];this.planes[s[0]]={id:s[0],nameCN:s[1],name:s[2],att:s[3],hp:s[4],shooting:s[5],crit:s[6],range:s[7],unlocking:s[8],bullettype:s[9],weapon:s[10],sustain:s[11],bulletsp:s[12]}}const e=this.planes[a.id];a.crit=100*e.crit,a.critHurt=1.5,a.speed=e.shooting,a.fspeed=e.bulletsp}}y.planes={},y.planesUI={1:[2,3,4,5,6],2:[6,5,4,3,2],3:[5,5,5,5,5]};const u={lobby:{BattlePage:"prefab/lobby/BattlePage.json",HangarPage:"prefab/lobby/HangarPage.json",HangarPlaneItem:"prefab/lobby/HangarPlaneItem.json"},battle:{BgNode:"prefab/battle/bg/BgNode.json",Player:"prefab/battle/player/Player.json",Player1:"prefab/battle/player/Player1.json",PlayerHP:"prefab/battle/player/PlayerHP.json",Player1Bullet:"prefab/battle/skill/Player1Bullet.json",PlayerLaser:"prefab/battle/skill/PlayerLaser.json",PlayerShield:"prefab/battle/skill/PlayerShield.json",PlayerTimeShield:"prefab/battle/skill/PlayerTimeShield.json",PlayerDieShot:"prefab/battle/skill/PlayerDieShot.json",PlayerDieBoom:"prefab/battle/skill/PlayerDieBoom.json",PlayerSkill1:"prefab/battle/skill/PlayerSkill1.json",PlayerSkill2:"prefab/battle/skill/PlayerSkill2.json",PlayerSkill3:"prefab/battle/skill/PlayerSkill3.json",PlayerSkill4:"prefab/battle/skill/PlayerSkill4.json",PlayerSkill5:"prefab/battle/skill/PlayerSkill5.json",PlayerSkill6:"prefab/battle/skill/PlayerSkill6.json",PlayerSkill7:"prefab/battle/skill/PlayerSkill7.json",PlayerSkill8:"prefab/battle/skill/PlayerSkill8.json",PlayerSkill9:"prefab/battle/skill/PlayerSkill9.json",PlayerSkill10:"prefab/battle/skill/PlayerSkill10.json",PlayerWing1:"prefab/battle/wing/PlayerWing1.json",PlayerWing1b:"prefab/battle/wing/PlayerWing1b.json",PlayerWing2:"prefab/battle/wing/PlayerWing2.json",PlayerWing2b:"prefab/battle/wing/PlayerWing2b.json",PlayerWing3:"prefab/battle/wing/PlayerWing3.json",PlayerWing3b:"prefab/battle/wing/PlayerWing3b.json",PlayerWing4:"prefab/battle/wing/PlayerWing4.json",PlayerWing4b:"prefab/battle/wing/PlayerWing4b.json",PlayerWing5:"prefab/battle/wing/PlayerWing5.json",PlayerWing5b:"prefab/battle/wing/PlayerWing5b.json",PlayerWing6:"prefab/battle/wing/PlayerWing6.json",PlayerWing6b:"prefab/battle/wing/PlayerWing6b.json",PlayerRobot1:"prefab/battle/robot/PlayerRobot1.json",PlayerRobot1b:"prefab/battle/robot/PlayerRobot1b.json",PlayerRobot2:"prefab/battle/robot/PlayerRobot2.json",PlayerRobot3:"prefab/battle/robot/PlayerRobot3.json",Enemy1001:"prefab/battle/enemy/Enemy1001.json",Enemy1002:"prefab/battle/enemy/Enemy1002.json",Enemy1004:"prefab/battle/enemy/Enemy1004.json",Enemy1006:"prefab/battle/enemy/Enemy1006.json",Enemy1008:"prefab/battle/enemy/Enemy1008.json",Enemy1010:"prefab/battle/enemy/Enemy1010.json",Enemy1012:"prefab/battle/enemy/Enemy1012.json",Enemy1014:"prefab/battle/enemy/Enemy1014.json",Enemy1016:"prefab/battle/enemy/Enemy1016.json",Enemy1017:"prefab/battle/enemy/Enemy1017.json",Enemy1018:"prefab/battle/enemy/Enemy1018.json",Enemy1019:"prefab/battle/enemy/Enemy1019.json",Enemy1020:"prefab/battle/enemy/Enemy1020.json",Enemy1021:"prefab/battle/enemy/Enemy1021.json",Enemy1023:"prefab/battle/enemy/Enemy1023.json",Enemy1024:"prefab/battle/enemy/Enemy1024.json",Enemy1025:"prefab/battle/enemy/Enemy1025.json",Enemy1026:"prefab/battle/enemy/Enemy1026.json",Enemy1027:"prefab/battle/enemy/Enemy1027.json",Enemy1029:"prefab/battle/enemy/Enemy1029.json",Enemy2001:"prefab/battle/enemy/Enemy2001.json",Enemy3001:"prefab/battle/enemy/Enemy3001.json",Enemy3002:"prefab/battle/enemy/Enemy3002.json",EnemyHPTip:"prefab/battle/enemy/EnemyHPTip.json",EnemyLine:"prefab/battle/enemySkill/EnemyLine.json",EnemySkill1:"prefab/battle/enemySkill/EnemySkill1.json",EnemySkill3:"prefab/battle/enemySkill/EnemySkill3.json",EnemySkill5:"prefab/battle/enemySkill/EnemySkill5.json",EnemySkill9:"prefab/battle/enemySkill/EnemySkill9.json",EnemySkill10:"prefab/battle/enemySkill/EnemySkill10.json",EnemySkill11:"prefab/battle/enemySkill/EnemySkill11.json",EnemySkill13:"prefab/battle/enemySkill/EnemySkill13.json",EnemySkill15:"prefab/battle/enemySkill/EnemySkill15.json",EnemySkill16:"prefab/battle/enemySkill/EnemySkill16.json",EnemySkill18:"prefab/battle/enemySkill/EnemySkill18.json",EnemySkill2001:"prefab/battle/enemySkill/EnemySkill2001.json",EnemyBoom:"prefab/battle/effect/EnemyBoom.json",PlayerLaserHit:"prefab/battle/effect/PlayerLaserHit.json",PlayerLaserHit2:"prefab/battle/effect/PlayerLaserHit2.json",PlayerLaserHit3:"prefab/battle/effect/PlayerLaserHit3.json",PlayerBlast:"prefab/battle/effect/PlayerBlast.json",PlayerFireBuff:"prefab/battle/effect/PlayerFireBuff.json",PlayerPoisonBuff:"prefab/battle/effect/PlayerPoisonBuff.json",PlayerIceBuff:"prefab/battle/effect/PlayerIceBuff.json"},battleUI:{ChooseSkillDialog:"prefab/battle/bg/ChooseSkillDialog.json",SupplySkillDialog:"prefab/battle/bg/SupplySkillDialog.json",GamePauseDialog:"prefab/battle/bg/GamePauseDialog.json",GameOverDialog:"prefab/battle/bg/GameOverDialog.json",PlayerSkillItem:"prefab/battle/bg/PlayerSkillItem.json"}},g={PlaneTrackModel:"unity/lizi1/plane.lh",PlaneModel1:"unity/plane1/plane.lh",PlaneModel2:"unity/plane2/plane.lh",PlaneModel3:"unity/plane3/plane.lh",Coin:"unity/coin/plane.lh",Track:"unity/tuowei/plane.lh",CaiHon:"unity/caihon/plane.lh",DaoDanLiaoJi:"unity/daodanliaoji/plane.lh",DaoDanGui:"unity/daodangui/plane.lh",FuYouPao:"unity/fuyoupao/plane.lh",E_DaoDan:"unity/e_daodan/plane.lh",E_Hxb:"unity/e_hxb/plane.lh"},m={2001:"battle/enemy/plane/2001/boss01.sk",3001:"battle/enemy/plane/3001/foe3001.sk",3002:"battle/enemy/plane/3002/BuJi.sk",1002:"battle/enemy/plane/1002/foe1002.sk",1004:"battle/enemy/plane/1004/foe1004.sk",1006:"battle/enemy/plane/1006/foe1006.sk",1014:"battle/enemy/plane/1014/foe1014.sk"},f={1001:"prefab/battle/enemy/Enemy1001.json",1002:"prefab/battle/enemy/Enemy1002.json",1003:"prefab/battle/enemy/Enemy1002.json",1004:"prefab/battle/enemy/Enemy1004.json",1005:"prefab/battle/enemy/Enemy1004.json",1006:"prefab/battle/enemy/Enemy1006.json",1007:"prefab/battle/enemy/Enemy1006.json",1008:"prefab/battle/enemy/Enemy1008.json",1009:"prefab/battle/enemy/Enemy1008.json",1010:"prefab/battle/enemy/Enemy1010.json",1011:"prefab/battle/enemy/Enemy1010.json",1012:"prefab/battle/enemy/Enemy1012.json",1013:"prefab/battle/enemy/Enemy1012.json",1014:"prefab/battle/enemy/Enemy1014.json",1015:"prefab/battle/enemy/Enemy1014.json",1016:"prefab/battle/enemy/Enemy1016.json",1017:"prefab/battle/enemy/Enemy1017.json",1018:"prefab/battle/enemy/Enemy1018.json",1019:"prefab/battle/enemy/Enemy1019.json",1020:"prefab/battle/enemy/Enemy1020.json",1021:"prefab/battle/enemy/Enemy1021.json",1022:"prefab/battle/enemy/Enemy1021.json",1023:"prefab/battle/enemy/Enemy1023.json",1024:"prefab/battle/enemy/Enemy1024.json",1025:"prefab/battle/enemy/Enemy1025.json",1026:"prefab/battle/enemy/Enemy1026.json",1027:"prefab/battle/enemy/Enemy1027.json",1028:"prefab/battle/enemy/Enemy1004.json",1029:"prefab/battle/enemy/Enemy1029.json",2001:"prefab/battle/enemy/Enemy2001.json",3001:"prefab/battle/enemy/Enemy3001.json",3002:"prefab/battle/enemy/Enemy3002.json",3003:"prefab/battle/enemy/Enemy3002.json"},b={1:"unity/plane1/plane.lh",2:"unity/plane2/plane.lh",3:"unity/plane3/plane.lh"},S={BlackItalic:"font/DIN-BlackItalic.ttf"},C={Chapter:"json/battle/chapter.json",Skill:"json/battle/skill.json",Level1:"json/battle/level1.json",Level2:"json/battle/level2.json",Level3:"json/battle/level3.json",Level4:"json/battle/level4.json",Level5:"json/battle/level5.json",Enaircraft:"json/battle/enaircraft.json",Exp:"json/battle/exp.json",Upaircraft:"json/lobby/upaircraft.json",Upgold:"json/lobby/upgold.json",Aircraft:"json/lobby/aircraft.json"},L=new Laya.EventDispatcher;class k extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)})}loadRes(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}))})}getRes(t){return Laya.loader.getRes(t)}open(t,e){const s=Laya.Pool.getItemByCreateFun(t,e.create,e);return s.__sign__=t,s}recover(t){let e=t.__sign__;e&&Laya.Pool.recover(e,t);let s=window.__PoolSigns__;s&&s.indexOf&&s.indexOf(e)<0&&s.push(e)}openDialog(t,e,s,i){this.loadPrefab(t).then(l=>{const a=this.open(t,l);a.pos(360,640),i||a.scale(0,0),i||(a.alpha=0),e.addChild(a),s&&s(a),i||Laya.Tween.to(a,{scaleX:1,scaleY:1,alpha:1},200,Laya.Ease.quadInOut)})}setClick(t,e,s,i,l){t.on(Laya.Event.MOUSE_DOWN,s,()=>{l||Laya.Tween.to(t,{scaleX:.9,scaleY:.9},100)});const a=()=>{Laya.Tween.to(t,{scaleX:1,scaleY:1},100)};if(!l){const t=e;e=(()=>{a(),t.call(s,i)})}t.on(Laya.Event.MOUSE_OUT,s,a),t.on(Laya.Event.CLICK,s,e,i)}schedule(t,e,s,i,l,a,n){const o=e;let r=0;e=(()=>{if(r>=i)return Laya.timer.clear(s,e),void(n&&n.call(s));r++,o.call(s,l)}),a&&Laya.timer.clear(s,e),Laya.timer.loop(t,s,e,l)}getVec2(t=0,e=0){return new Laya.Vector2(t,e)}getVec3(t=0,e=0,s=0){return t instanceof Laya.Vector2&&(e=t.y,t=t.x),new Laya.Vector3(t,e,s)}getVec4(t=0,e=0,s=0,i=0){return new Laya.Vector4(t,e,s,i)}}var E,_,T;!function(t){t[t.READY=0]="READY",t[t.START=1]="START",t[t.PAUSE=2]="PAUSE",t[t.END=3]="END"}(E||(E={})),function(t){t.LASER="laser",t.POISON="poison",t.FIRE="fire",t.ICE="ice",t.MAGNET="magnet"}(_||(_={})),function(t){t.GameStateChange="gamestate_change",t.RateStart="battle_rate_start",t.RateEnd="battle_rate_end",t.GameOver="game_over",t.StudySkill="study_skill",t.LevelEnemy="make_level_enemy",t.LevelEnemyEnd="make_level_enemy_end",t.PlayerBullet="player_main_bullet",t.PlayerHP="player_hp",t.PlayerMaxHP="player_max_hp",t.PlayerSpeed="player_speed",t.LaserHide="player_laser_hide",t.LaserCross="player_laser_cross",t.LaserTrack="player_laser_track",t.LaserTrackTar="player_laser_track_tar",t.BaseSkill1="player_1001_baseskill",t.BaseSkill1a="player_1002_baseskill",t.BaseSkill1b="player_1003_baseskill",t.BaseSkill2="player_1005_baseskill",t.BaseSkill2a="player_1006_baseskill",t.BaseSkill2b="player_1007_baseskill",t.BaseSkill3="player_1013_baseskill",t.BaseSkill4="player_1009_baseskill",t.BaseSkill4a="player_1010_baseskill",t.BaseSkill4b="player_1011_baseskill",t.BaseSkill5="player_1016_baseskill",t.BaseSkill5a="player_1017_baseskill",t.BaseSkill5b="player_1018_baseskill",t.BaseSkill6="player_1020_baseskill",t.BaseSkill6a="player_1021_baseskill",t.BaseSkill6b="player_1022_baseskill",t.BaseSkill7="player_1024_baseskill",t.BaseSkill9="player_1023_baseskill",t.Shield="player_1025_baseskill",t.TimeShield="player_1027_baseskill",t.DieShot="player_1028_baseskill",t.BaseSkill11="player_1029_baseskill",t.BaseSkill13="player_1030_baseskill",t.BaseSkill14="player_1031_baseskill",t.BaseSkill15="player_1032_baseskill",t.SuckBlood="player_1033_baseskill",t.DieBoom="player_1034_baseskill",t.BulSkill1="player_2004_bulskill",t.BulSkill1_Start="player_2004_bulskill_start",t.BulSkill2="player_2005_bulskill",t.BulSkill3="player_2003_bulskill",t.BulSkill4="player_2001_bulskill",t.BulSkill5="player_2006_bulskill",t.BulSkill6="player_2007_bulskill",t.BulSkill7="player_2010_bulskill",t.BulSkill7_Start="player_2010_bulskill_start",t.BulSkill8="player_2009_bulskill",t.BulSkill9="player_2011_bulskill",t.BulSkill10="player_2008_bulskill",t.WingSkill1="player_3005_wingskill",t.WingSkill2="player_3002_wingskill",t.WingSkill3="player_3003_wingskill",t.WingSkill4="player_3004_wingskill",t.WingSkill5="player_3001_wingskill",t.WingSkill6="player_3006_wingskill",t.RobSkill1="player_4001_robskill",t.RobSkill2="player_4003_robskill",t.RobSkill3="player_4002_robskill",t.Sup_HP="player_1004_supply",t.Sup_Att="player_1008_supply",t.Sup_Speed="player_1012_supply",t.Sup_HPRec1="player_1014_supply",t.Sup_HPRec2="player_1015_supply",t.Sup_Crit="player_1019_supply",t.EnemyDead="enemy_dead",t.EnemyPause="enemy_pause",t.EnemyReturn="enemy_return",t.EnemyHit="enemy_hit"}(T||(T={}));const P=[];var x;window.__PoolSigns__=P,function(t){t[t.HP1=1001]="HP1",t[t.Attack1=1005]="Attack1",t[t.HPRec1=1013]="HPRec1",t[t.Speed=1009]="Speed",t[t.Crit=1016]="Crit",t[t.MainStr=1020]="MainStr",t[t.MainCross=1024]="MainCross",t[t.MainTrack=1023]="MainTrack",t[t.Shield=1025]="Shield",t[t.TimeShield=1027]="TimeShield",t[t.DieShot=1028]="DieShot",t[t.Back=1029]="Back",t[t.Anger=1030]="Anger",t[t.Cri=1031]="Cri",t[t.Fearless=1032]="Fearless",t[t.SuckBlood=1033]="SuckBlood",t[t.DieBoom=1034]="DieBoom",t[t.Shotgun=2001]="Shotgun",t[t.Laser=2003]="Laser",t[t.SwimShell=2004]="SwimShell",t[t.ShockWave=2005]="ShockWave",t[t.RainbowMissile=2006]="RainbowMissile",t[t.RotatePoison=2007]="RotatePoison",t[t.RotateIce=2008]="RotateIce",t[t.RotateFire=2009]="RotateFire",t[t.NaughtyGhost=2010]="NaughtyGhost",t[t.Magnet=2011]="Magnet",t[t.ShotWing=3001]="ShotWing",t[t.MissileWing=3002]="MissileWing",t[t.LaserWing=3003]="LaserWing",t[t.AutoWing=3004]="AutoWing",t[t.BlastWing=3005]="BlastWing",t[t.ShieldWing=3006]="ShieldWing",t[t.BlastRobot=4001]="BlastRobot",t[t.LaserRobot=4002]="LaserRobot",t[t.ShieldRobot=4003]="ShieldRobot",t[t.Sup_HP=1004]="Sup_HP",t[t.Sup_Att=1008]="Sup_Att",t[t.Sup_Speed=1012]="Sup_Speed",t[t.Sup_HPRec1=1014]="Sup_HPRec1",t[t.Sup_HPRec2=1015]="Sup_HPRec2",t[t.Sup_Crit=1019]="Sup_Crit"}(x||(x={}));const V={1:[[0],[-30,-10,10,30],[-60,-40,-20,0,20,40,60],[-90,-70,-50,-30,-10,10,30,50,70,90]],2:[[0],[-30,30],[-5,0,5],[-20,-10,10,20]]},D=[[{dx:-80,dy:60,v:-1},{dx:80,dy:60,v:1}],[{dx:-160,dy:60,v:-1},{dx:160,dy:60,v:1}],[{dx:-240,dy:60,v:-1},{dx:240,dy:60,v:1}]],A={2001:{self:{x:50,y:75},b1:[{x:-221,y:261},{x:221,y:261}],b2:[{x:-130,y:240},{x:130,y:240}],b3:[{x:-83,y:195},{x:83,y:195}]},3002:{self:{x:312,y:908}},1002:{self:{x:43.5,y:81}},1004:{self:{x:65,y:70}},1006:{self:{x:51.5,y:80}},1014:{self:{x:43.5,y:83}}};class w extends k{constructor(){super(),this.width2=50,this.height2=50,this.deltaY=0,this.aabb=null,this.bid=null,this.bids=[],w.__bid__++,this.bid=w.__bid__}onEnable(){this.aabb={x:0,y:0,width:this.width2,height:this.height2}}onDisable(){this.bids.length=0}onLateUpdate(){const t=this.owner;t&&(this.aabb.x=t.x-this.width2/2,this.aabb.y=t.y-this.height2/2+this.deltaY)}}w.__bid__=0;class R extends k{constructor(){super(),this.delta=250}onEnable(){let t={1001:2,1002:2,1003:2,1004:3,1005:3,1006:2,1007:2,1008:2,1009:2,1010:1.5,1011:1.5,1012:2,1013:2,1014:2,1015:2,1016:1.5,2001:6,3001:1.5,3002:1.5,hit:1}[this.owner.__$type$__]||2;const e=this.owner.getChildByName("boom");e.scale(t,t),e.blendMode=Laya.BlendMode.LIGHTER,Laya.timer.once(this.delta,this,()=>{this.owner.removeSelf()})}onDisable(){Laya.timer.clearAll(this),this.recover(this.owner)}}class v extends k{constructor(){super(),this.ins=st.instance,this.move=!0}onEnable(){this.move=!0}onDisable(){}moveCoin(){const t=this.owner,e=this.ins.playerPosV3;Laya.Tween.to(t.transform,{localPositionX:e.x,localPositionY:e.y,localPositionZ:e.z,localScaleX:3,localScaleY:3,localScaleZ:3},300,null,Laya.Handler.create(this,()=>{t.removeSelf()}))}onUpdate(){const t=this.ins;if(t.gameState!=E.START)return;const e=this.owner;e.transform.rotate(this.getVec3(0,.1,0)),this.move&&(e.transform.translate(this.getVec3(0,-.04,0)),Math.abs(e.transform.position.z-t.playerPosV3.z)<=2&&(this.move=!1,this.moveCoin()))}}class I extends k{constructor(){super(),this.xp=null,this.yp=null}onEnable(){const t=this.owner;t.blendMode=Laya.BlendMode.LIGHTER,Laya.timer.once(100,this,()=>{t.templet&&t.play(1,!0)})}onDisable(){this.xp=null,this.yp=null,this.recover(this.owner)}onLateUpdate(){if(this.xp&&this.yp){const t=this.owner;t.x=this.xp.x,t.y=this.yp.y}}}class M{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.eneHurtStr=0,this.bosHurtStr=0}}class B extends k{constructor(){super(),this.data=new M}onEnable(){}onDisable(){}setData(t,e,s,i,l){this.data.attack=t,this.data.crit=e,this.data.critHurt=s,this.data.eneHurtStr=i,this.data.bosHurtStr=l}}class H{constructor(t){this._tree=new Quadtree(t)}check(t,e){let s=[];if(this._tree){this._tree.clear();for(let e=0,s=t.length;e<s;e++){const s=t[e],i=s.aabb,l={x:i.x,y:i.y,height:i.height,width:i.width,collider:s};this._tree.insert(l)}if(this._tree.retrieve(e.aabb).forEach(t=>{(function(t,e){const s=t.owner,i=e.owner,l=s.y+t.deltaY,a=i.y+e.deltaY;return Math.abs(s.x-i.x)<=(t.width2+e.width2)/2&&Math.abs(l-a)<=(t.height2+e.height2)/2})(t.collider,e)&&s.push(t.collider)}),this._collisions)for(let t=0;t<this._collisions.length;t++){const i=this._collisions[t];if(s.indexOf(i)<0){let t=i.bids.indexOf(e.bid);if(t>-1&&(i.bids.splice(t,1),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionExit){l.onCollisionExit(e,i);break}}}let s=e.bids.indexOf(i.bid);if(s>-1&&(e.bids.splice(s,1),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionExit){l.onCollisionExit(i,e);break}}}}}for(let t=0;t<s.length;t++){const i=s[t];if(i.bids.indexOf(e.bid)<0&&(i.bids.push(e.bid),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionEnter){l.onCollisionEnter(e,i);break}}}if(e.bids.indexOf(i.bid)<0&&(e.bids.push(i.bid),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionEnter){l.onCollisionEnter(i,e);break}}}}this._collisions=s}}}function Quadtree(t,e,s,i){this.max_objects=e||10,this.max_levels=s||4,this.level=i||0,this.bounds=t,this.objects=[],this.nodes=[]}Quadtree.prototype.split=function(){var t=this.level+1,e=this.bounds.width/2,s=this.bounds.height/2,i=this.bounds.x,l=this.bounds.y;this.nodes[0]=new Quadtree({x:i+e,y:l,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[1]=new Quadtree({x:i,y:l,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[2]=new Quadtree({x:i,y:l+s,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[3]=new Quadtree({x:i+e,y:l+s,width:e,height:s},this.max_objects,this.max_levels,t)},Quadtree.prototype.getIndex=function(t){var e=[],s=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,l=t.y<i,a=t.x<s,n=t.x+t.width>s,o=t.y+t.height>i;return l&&n&&e.push(0),a&&l&&e.push(1),a&&o&&e.push(2),n&&o&&e.push(3),e},Quadtree.prototype.insert=function(t){var e,s=0;if(this.nodes.length)for(e=this.getIndex(t),s=0;s<e.length;s++)this.nodes[e[s]].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){for(this.nodes.length||this.split(),s=0;s<this.objects.length;s++){e=this.getIndex(this.objects[s]);for(var i=0;i<e.length;i++)this.nodes[e[i]].insert(this.objects[s])}this.objects=[]}},Quadtree.prototype.retrieve=function(t){var e=this.getIndex(t),s=this.objects;if(this.nodes.length)for(var i=0;i<e.length;i++)s=s.concat(this.nodes[e[i]].retrieve(t));return s=s.filter(function(t,e){return s.indexOf(t)>=e})},Quadtree.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]};class N extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=E.READY,this.tar=null,this.speed=1.5,this.cross=!1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),L.on(T.BulSkill1_Start,this,()=>{this.state=E.START});const t=this.ins,e=this.owner;if(e.__type__){const s=new Laya.Sprite3D,i=this.getRes(g.FuYouPao),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s;let n=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x+150*this.norV3.x,e.y+150*this.norV3.y),n),Laya.Tween.to(s.transform,{localPositionX:n.x,localPositionZ:n.z},100),Laya.timer.loop(100,this,()=>{Laya.Tween.to(l.transform,{localPositionX:.1},50,null,Laya.Handler.create(this,()=>{Laya.Tween.to(l.transform,{localPositionX:-.1},50)}))})}}onDisable(){this.s3d.removeSelf(),this.s3d=null,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.cross||this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.tar&&!this.tar.parent&&(this.tar=null),this.tar&&this.tar.parent)if(t.y<=this.tar.y||this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.tar=null;else{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d&&this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class O{static getRandom(t,e){return Math.floor(Math.random()*(t-e+1)+e)}}class W extends k{constructor(){super(),this.ins=st.instance,this.tar=null,this.dex=0}onEnable(){}onDisable(){const t=this.owner;t.height=0,t.rotation=0,this.recover(this.owner)}onLateUpdate(){if(this.ins.gameState!=E.START)return;const t=this.owner,e=this.tar,s=-e.rotation/180*Math.PI,i=e.x+this.dex*Math.cos(s),l=e.y-this.dex*Math.sin(s);t.pos(i,l);let a=this.ins.playerV2,n=i-(a.x+this.dex),o=l-a.y;t.height=Math.sqrt(n*n+o*o),t.rotation=Math.atan2(n,-o)/Math.PI*180}}class U extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=E.READY,this.speed=.5}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280}))}onDisable(){L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class j extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.going=!0,this.currDis=0,this.state=E.START,this.speed=.5,this.distance=500,this.tar=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.currDis=0,this.going=!0}onDisable(){L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.playerV2;if(this.going&&s&&s.parent){let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(s.x,s.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}if(!this.going&&this.tar&&this.tar.parent){let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}if(this.currDis>=this.distance&&this.going)if(this.going=!1,this.tar&&this.tar.parent){let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}else this.tar=null,this.norV3.x*=-1,this.norV3.y*=-1;!this.going&&this.tar&&this.tar.parent&&Math.abs(this.tar.x-t.x)<=3*e&&Math.abs(this.tar.y-t.y)<=3*e&&t.removeSelf(),t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180);let i=e*this.norV3.x,l=e*this.norV3.y;t.x+=i,t.y+=l,this.going&&(this.currDis+=Math.sqrt(i*i+l*l)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class G extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.angle=0,this.state=E.READY,this.js=!1,this.tar=null,this.pangle=0,this.speed=.4,this.xv=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.angle=0,this.js=!1,this.state=E.START;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(g.E_DaoDan),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s}onDisable(){this.s3d.removeSelf(),L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.js){if(this.tar){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i),Laya.Vector3.lerp(this.norV3,i,e/50,l),this.norV3=l,e*=2}}else{if(this.tar){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let a=Math.atan2(-i.y,i.x);Laya.Vector3.lerp(this.getVec3(this.pangle),this.getVec3(a),e/100,l),this.pangle=l.x}this.angle+=6;let s=-Math.sin(this.angle/180*Math.PI),i=.4*Math.tan(s),l=new Laya.Vector3(0,0,0),a=this.pangle,n=1*Math.cos(a)+i*Math.sin(a);n*=this.xv;let o=i*Math.cos(a)-1*Math.sin(a);Laya.Vector3.normalize(this.getVec3(n,o),l),this.norV3=l}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class F extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.circle=!0,this.state=E.READY,this.ranax=1,this.tar=null,this.angle=0,this.xv=1,this.speed=.5,this.trail=g.E_DaoDan,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.state=E.START,this.circle=!0;const t=this.ins,e=this.owner;if(this.ranax=Math.floor(3*Math.random()+8)/10,this.trail){const s=new Laya.Sprite3D,i=this.getRes(this.trail),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s}}onDisable(){this.s3d&&this.s3d.removeSelf(),L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.tar&&this.circle){let s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x)-Math.atan2(-this.norV3.y,this.norV3.x);if(l<0&&(l+=2*Math.PI),l<=.2){this.circle=!1;let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3),this.tar=null}else{this.angle-=this.xv*e/2*this.ranax;let t=Math.tan(this.angle/180*Math.PI),s=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-t,0),s),(this.angle>90&&this.angle<270||this.angle<-90&&this.angle>-270)&&(s.x=-s.x,s.y=-s.y),this.norV3.x=s.x,this.norV3.y=s.y}}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d&&this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=-200||t.x>=920||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class q extends k{constructor(){super(),this.ins=st.instance,this.enemyCom=null,this.skill1Pre=null,this.skill3Pre=null,this.skill5Pre=null,this.skillLinePre=null,this.skillRotatePre=null,this.skill10Pre=null,this.skill11Pre=null,this.skill13Pre=null,this.skill15Pre=null,this.skill16Pre=null,this.skill18Pre=null,this.lines=[],this.skill1Pre=this.getRes(u.battle.EnemySkill1),this.skill3Pre=this.getRes(u.battle.EnemySkill3),this.skill5Pre=this.getRes(u.battle.EnemySkill5),this.skillLinePre=this.getRes(u.battle.EnemyLine),this.skillRotatePre=this.getRes(u.battle.EnemySkill9),this.skill10Pre=this.getRes(u.battle.EnemySkill10),this.skill11Pre=this.getRes(u.battle.EnemySkill11),this.skill13Pre=this.getRes(u.battle.EnemySkill13),this.skill15Pre=this.getRes(u.battle.EnemySkill15),this.skill16Pre=this.getRes(u.battle.EnemySkill16),this.skill18Pre=this.getRes(u.battle.EnemySkill18)}onEnable(){this.enemyCom=this.owner.getComponent(z),this.enemyCom&&this.enemyCom.edata}initSkill(){const t=this.enemyCom.edata,e=h.enemys[t.type];if(e.skill){const s=e.skill,i=t.shooting,l=t.bulletstart;if("number"==typeof s)if(7!=s&&14!=s&&16!=s||(this.enemyCom.isRotate=!0),12==s)this.enemyCom.isRotSelf=!0,this.enemyCom.isPauseSelf=!0,L.on(T.EnemyPause,this,this.skill12);else if(17==s)this.enemyCom.isRotSelf=!0,L.on(T.EnemyReturn,this,this.skill17);else{const e=()=>{if(this.ins.gameState==E.START)if(L.event(T.EnemyHit,[t.type,this.enemyCom.eid]),t.type>2e3);else{this["skill"+s]&&this["skill"+s]()}};Laya.timer.once(1e3*l,this,e),Laya.timer.loop(1e3*i,this,()=>{e()})}else if("string"==typeof s){const e=s.split("|"),i=t.shooting.split("|"),a=t.att.split("|"),n=t.bulletsp.split("|");let o=0;const r=()=>{if(this.ins.gameState==E.START){if(L.event(T.EnemyHit,[t.type,this.enemyCom.eid,e[o]]),t.type>2e3);else{this["skill"+e[o]]&&this["skill"+e[o]](parseInt(a[o]),parseInt(n[o]))}++o>=e.length&&(o=0)}},h=()=>{Laya.timer.once(1e3*parseInt(i[o]),this,()=>{r(),h()})};h(),Laya.timer.once(1e3*l,this,r)}}}onDisable(){for(let t=0;t<this.lines.length;t++){this.lines[t].removeSelf()}this.lines.length=0,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}skill1(t,e){const s=this.owner,i=this.enemyCom.edata,l=[-10,10],a=i.atttime||1;for(let n=0;n<a;n++)for(let a=0;a<l.length;a++){const o=this.open(u.battle.EnemySkill1,this.skill1Pre);let r=o.getComponent(B);r||(r=o.addComponent(B)),r.setData(t||i.att,0,0,0,0);const h=o.getComponent(U);h.norV3=this.getVec3(0,1),h.state=E.START,h.speed=e||i.bulletsp,o.pos(s.x+l[a],s.y+10+20*n),this.ins.eneBulNode.addChild(o)}}skill2(t,e){this.ins;const s=this.enemyCom.edata,i=this.owner,l=[-20,20];let a=0;this.schedule(50,()=>{const n=this.open(u.battle.EnemySkill1,this.skill1Pre);let o=n.getComponent(B);o||(o=n.addComponent(B)),o.setData(t||s.att,0,0,0,0);const r=n.getComponent(U);r.norV3=this.getVec3(0,1),r.state=E.START,r.speed=e||s.bulletsp,n.pos(i.x+l[a],i.y+10),this.ins.eneBulNode.addChild(n),++a>1&&(a=0)},this,10)}skill3(t,e){const s=this.ins,i=this.enemyCom.edata,l=this.owner,a=[110,70,100,80];let n=0;this.schedule(200,()=>{const e=this.open(u.battle.EnemySkill3,this.skill3Pre);let o=e.getComponent(B);o||(o=e.addComponent(B)),o.setData(t||i.att,0,0,0,0);const r=e.getComponent(F);r.norV3=this.getVec3(0,-1),r.angle=a[n],r.xv=a[n]>90?-1:1,r.tar=this.getVec2(s.playerV2.x,s.playerV2.y),e.pos(l.x,l.y),this.ins.eneBulNode.addChild(e),n++},this,4)}skill4(t,e){this.ins;const s=this.enemyCom.edata,i=this.owner,l=[this.getVec3(-.34,.94),this.getVec3(-.17,.98),this.getVec3(.17,.98),this.getVec3(.34,.94)];for(let e=0;e<4;e++){const a=this.open(u.battle.EnemySkill3,this.skill3Pre);let n=a.getComponent(B);n||(n=a.addComponent(B)),n.setData(t||s.att,0,0,0,0);const o=a.getComponent(F);o.norV3=l[e].clone(),o.angle=0,o.xv=1,o.tar=null,a.pos(i.x,i.y+10),this.ins.eneBulNode.addChild(a)}}skill5(t,e){const s=this.owner,i=this.enemyCom.edata,l=[-40,-20,20,40],a=i.atttime||1;for(let n=0;n<a;n++)for(let a=0;a<l.length;a++){const o=this.open(u.battle.EnemySkill5,this.skill5Pre);let r=o.getComponent(B);r||(r=o.addComponent(B)),r.setData(t||i.att,0,0,0,0);const h=o.getComponent(U);h.norV3=this.getVec3(0,1),h.state=E.READY,h.speed=e||i.bulletsp,o.pos(s.x+l[a],s.y+10+20*n),this.ins.eneBulNode.addChild(o),Laya.Tween.to(o,{y:s.y+100+20*n},500,null,Laya.Handler.create(this,()=>{const t=this.ins.playerV2;Laya.timer.once(1e3,this,()=>{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(t.x+l[a],t.y),this.getVec3(o.x,o.y),e),Laya.Vector3.normalize(e,h.norV3),h.state=E.START})}))}}skill6(t,e){const s=this.owner,i=this.enemyCom.edata,l=[this.getVec3(-.17,.98),this.getVec3(0,1),this.getVec3(.17,.98)];this.schedule(100,()=>{for(let a=0;a<l.length;a++){const n=this.open(u.battle.EnemySkill1,this.skill1Pre);let o=n.getComponent(B);o||(o=n.addComponent(B)),o.setData(t||i.att,0,0,0,0);const r=n.getComponent(U);r.norV3=l[a].clone(),r.state=E.START,r.speed=e||i.bulletsp,n.pos(s.x,s.y+10),this.ins.eneBulNode.addChild(n)}},this,5)}skill7(t,e){const s=this.owner,i=this.enemyCom.edata,l=[[0,0],[-1,1],[1,1],[-2,2],[0,2],[2,2]],a=this.open(u.battle.EnemyLine,this.skillLinePre),n=a.getComponent(W);n.dex=0,n.tar=s,a.pos(s.x,s.y),this.ins.bgTopNode.addChild(a),this.lines.push(a),Laya.timer.once(1500,this,()=>{if(a.removeSelf(),this.lines.splice(this.lines.indexOf(a),1),this.ins.gameState==E.START)for(let a=0;a<l.length;a++){const n=this.open(u.battle.EnemySkill1,this.skill1Pre);let o=n.getComponent(B);o||(o=n.addComponent(B)),o.setData(t||i.att,0,0,0,0);const r=n.getComponent(U);r.speed=e||i.bulletsp,r.norV3=this.getVec3(0,1);let h=this.getVec3();const c=this.ins.playerV2;let d=10*l[a][0],p=20*l[a][1];n.pos(s.x+d,s.y+p+10),Laya.Vector3.subtract(this.getVec3(c.x+d,c.y+p),this.getVec3(n.x,n.y),h),Laya.Vector3.normalize(h,r.norV3),r.state=E.START,this.ins.eneBulNode.addChild(n)}})}skill8(t,e){const s=this.owner,i=this.enemyCom.edata,l=[[0,0],[-1,1],[1,1],[-2,2],[2,2],[-3,3],[3,3],[-2,4],[2,4],[-1,5],[1,5],[0,6]],a=i.atttime||1;for(let n=0;n<a;n++)for(let a=0;a<l.length;a++){const o=this.open(u.battle.EnemySkill1,this.skill1Pre);let r=o.getComponent(B);r||(r=o.addComponent(B)),r.setData(t||i.att,0,0,0,0);const h=o.getComponent(U);h.norV3=this.getVec3(0,1),h.speed=e||i.bulletsp;let c=20*l[a][0],d=20*l[a][1];o.pos(s.x+c,s.y+d+10+140*n),h.state=E.START,this.ins.eneBulNode.addChild(o)}}skill9(t,e){const s=this.owner,i=this.enemyCom.edata,l=[this.getVec3(0,-1),this.getVec3(.03,-1),this.getVec3(.07,-1),this.getVec3(.1,-.99),this.getVec3(.14,-.99),this.getVec3(.17,-.98),this.getVec3(.98,-.17),this.getVec3(.99,-.14),this.getVec3(.99,-.1),this.getVec3(.99,-.07),this.getVec3(1,-.03),this.getVec3(1,0),this.getVec3(.5,.87),this.getVec3(.47,.88),this.getVec3(.44,.9),this.getVec3(.41,.91),this.getVec3(.37,.93),this.getVec3(.34,.94),this.getVec3(-.5,.87),this.getVec3(-.53,.85),this.getVec3(-.56,.83),this.getVec3(-.59,.81),this.getVec3(-.62,.79),this.getVec3(-.64,.77),this.getVec3(-.98,-.17),this.getVec3(-.98,-.21),this.getVec3(-.97,-.24),this.getVec3(-.96,-.28),this.getVec3(-.95,-.31),this.getVec3(-.94,-.34)],a=this.open(u.battle.EnemySkill9,this.skillRotatePre);a.pos(s.x,s.y+30),this.ins.eneBulNode.addChild(a),Laya.Tween.to(a,{y:s.y+230},1e3),this.lines.push(a),Laya.timer.once(2e3,this,()=>{if(a.removeSelf(),this.lines.splice(this.lines.indexOf(a),1),this.ins.gameState==E.START)for(let s=0;s<l.length;s++){const n=this.open(u.battle.EnemySkill1,this.skill1Pre);let o=n.getComponent(B);o||(o=n.addComponent(B)),o.setData(t||i.att,0,0,0,0);const r=n.getComponent(U);let h,c;if(r.speed=e||i.bulletsp,r.norV3=l[s],s<=5){let t=25*l[0].x,e=25*l[0].y;h=t+=10*(s-0),c=e-=10*(s-0)}else if(s>5&&s<=11){let t=25*l[6].x,e=25*l[6].y;h=t+=10*(s-6),c=e+=5*(s-6)}else if(s>11&&s<=17){let t=25*l[12].x,e=25*l[12].y;h=t-=5*(s-12),c=e+=10*(s-12)}else if(s>17&&s<=23){let t=25*l[18].x,e=25*l[18].y;h=t-=10*(s-18),c=e-=2*(s-18)}else if(s>23&&s<=29){let t=25*l[24].x,e=25*l[24].y;h=t-=5*(s-24),c=e-=10*(s-24)}n.pos(a.x+h,a.y+c),r.state=E.START,this.ins.eneBulNode.addChild(n)}})}skill10(t,e){const s=this.owner,i=this.enemyCom.edata,l=[[-110,100],[-60,115],[0,130],[60,115],[110,100]],a=[.65,.8,1,.8,.65],n=i.atttime||1;for(let o=0;o<n;o++)for(let n=0;n<l.length;n++){const r=this.open(u.battle.EnemySkill10,this.skill10Pre);let h=r.getComponent(B);h||(h=r.addComponent(B)),h.setData(t||i.att,0,0,0,0);const c=r.getComponent(U);c.norV3=this.getVec3(0,1),c.state=E.READY,c.speed=e||i.bulletsp,r.alpha=a[n],r.scale(a[n],a[n]),r.pos(s.x+l[n][0],s.y+80+50*o),this.ins.eneBulNode.addChild(r),Laya.Tween.to(r,{y:s.y+l[n][1]+50*o},200,null,Laya.Handler.create(this,()=>{this.ins.playerV2;Laya.timer.once(1e3,this,()=>{let t=this.getVec3(),e=this.ins.playerV2;Laya.Vector3.subtract(this.getVec3(e.x,e.y),this.getVec3(r.x,r.y),t),Laya.Vector3.normalize(t,c.norV3),c.state=E.START})}))}}skill11(t,e){const s=this.owner,i=this.enemyCom.edata,l=[this.getVec3(.87,-.5),this.getVec3(-.5,-.87),this.getVec3(-.87,.5),this.getVec3(.5,.87)],a=[-150,150];for(let n=0;n<a.length;n++){const o=this.open(u.battle.EnemySkill11,this.skill11Pre);o.pos(s.x,s.y+30),this.ins.eneBulNode.addChild(o),Laya.Tween.to(o,{x:s.x+a[n],y:s.y+230},1e3),this.lines.push(o),Laya.timer.once(6e3,this,()=>{o.removeSelf(),this.lines.splice(this.lines.indexOf(o),1)}),Laya.timer.once(2e3,this,()=>{let s=0;this.schedule(250,()=>{if(this.ins.gameState!=E.START)return;const a=this.open(u.battle.EnemySkill1,this.skill1Pre);let r=a.getComponent(B);r||(r=a.addComponent(B)),r.setData(t||i.att,0,0,0,0);const h=a.getComponent(U);h.speed=e||i.bulletsp,h.norV3=l[s].clone(),n&&(h.norV3.x*=-1),a.pos(o.x,o.y),h.state=E.START,this.ins.eneBulNode.addChild(a),++s>=l.length&&(s=0)},this,12)})}}skill12(t){if(t!=this.enemyCom.eid)return;const e=this.owner,s=this.enemyCom.edata,i=this.enemyCom.norV3;let l=Math.atan2(-i.y,i.x);for(let t=0;t<2;t++){const i=this.open(u.battle.EnemySkill13,this.skill13Pre);let a=i.getComponent(B);a||(a=i.addComponent(B)),a.setData(s.att,0,0,0,0);let n=l+(t?Math.PI/2:-Math.PI/2),o=e.x+100*Math.cos(n),r=e.y-100*Math.sin(n);i.pos(o,r),this.ins.eneBulNode.addChild(i)}}skill14(t,e){const s=this.owner,i=this.enemyCom.edata,l=[-25,25],a=[];for(let t=0;t<2;t++){const e=this.open(u.battle.EnemyLine,this.skillLinePre),i=e.getComponent(W);i.dex=l[t],i.tar=s,e.pos(s.x+l[t],s.y),this.ins.bgTopNode.addChild(e),a.push(e),this.lines.push(e)}Laya.timer.once(1e3,this,()=>{for(let t=0;t<a.length;t++){const e=a[t];e.removeSelf(),this.lines.splice(this.lines.indexOf(e),1)}if(this.ins.gameState!=E.START)return;let e=500,n=0;const o=()=>{for(let e=0;e<l.length;e++){const a=this.open(u.battle.EnemySkill1,this.skill1Pre);let n=a.getComponent(B);n||(n=a.addComponent(B)),n.setData(t||i.att,0,0,0,0);const o=a.getComponent(U);o.norV3=this.getVec3(0,1);let r=this.getVec3(),h=this.getVec3();const c=this.ins.playerV2;a.pos(s.x+l[e],s.y+10),Laya.Vector3.subtract(this.getVec3(c.x+l[e],c.y),this.getVec3(a.x,a.y),r),Laya.Vector3.normalize(r,h),o.norV3=h,o.state=E.START,this.ins.eneBulNode.addChild(a)}e>100&&(e-=50),e<=100&&n++,n>15?Laya.timer.clear(this,o):Laya.timer.once(e,this,o)};o()})}skill15(t,e){const s=this.owner,i=this.ins,l=this.enemyCom.edata,a=[[-40,-10],[40,-10],[-40,55],[40,55]],n=[135,45,-135,-45];let o=0;this.schedule(100,()=>{if(this.ins.gameState==E.START)for(let e=0;e<a.length;e++){const r=this.open(u.battle.EnemySkill15,this.skill15Pre);let h=r.getComponent(B);h||(h=r.addComponent(B)),h.setData(t||l.att,0,0,0,0);const c=r.getComponent(F);c.trail=g.E_Hxb,c.norV3=this.getVec3(0,-1),c.angle=n[e],c.xv=Math.abs(n[e])>90?-1:1,c.tar=this.getVec2(i.playerV2.x,i.playerV2.y),r.pos(s.x+a[e][0],s.y+a[e][1]),this.ins.eneBulNode.addChild(r),o++,console.log(o)}},this,3)}skill16(t,e){const s=this.owner,i=this.ins,l=this.enemyCom.edata;if(this.ins.gameState==E.START)for(let e=0;e<1;e++){const e=this.open(u.battle.EnemySkill16,this.skill16Pre);let a=e.getComponent(B);a||(a=e.addComponent(B)),a.setData(t||l.att,0,0,0,0);const n=e.getComponent(j);n.tar=s,n.norV3=this.getVec3(0,1);let o=this.getVec3();e.pos(s.x,s.y+10),Laya.Vector3.subtract(this.getVec3(i.playerV2.x,i.playerV2.y),this.getVec3(e.x,e.y),o),Laya.Vector3.normalize(o,n.norV3),this.ins.eneBulNode.addChild(e)}}skill17(t){if(!t)return;const e=this.owner,s=this.enemyCom.edata;for(let t=0;t<1;t++){const t=this.open(u.battle.EnemySkill10,this.skill10Pre);let i=t.getComponent(B);i||(i=t.addComponent(B)),i.setData(s.att,0,0,0,0);const l=t.getComponent(U);t.pos(e.x,e.y+10),l.norV3=this.getVec3(0,1);let a=this.getVec3(),n=this.ins.playerV2;Laya.Vector3.subtract(this.getVec3(n.x,n.y),this.getVec3(t.x,t.y),a),Laya.Vector3.normalize(a,l.norV3),l.state=E.START,this.ins.eneBulNode.addChild(t)}}skill18(t,e){const s=this.owner,i=this.enemyCom.edata,l=[-10,10],a=[1,-1,-1,1],n=i.atttime||1;let o=null,r=0;this.schedule(300,()=>{o||(o=this.getVec3(s.x,s.y));for(let e=0;e<l.length;e++){const s=this.open(u.battle.EnemySkill18,this.skill18Pre);let n=s.getComponent(B);n||(n=s.addComponent(B)),n.setData(t||i.att,0,0,0,0);const h=s.getComponent(G);h.xv=a[r],h.pangle=-Math.PI/2,h.tar=null,s.pos(o.x+l[e],o.y+10),this.ins.eneBulNode.addChild(s),++r>=a.length&&(r=0)}},this,2*n)}}var X;!function(t){t[t.Move=0]="Move",t[t.Pause=1]="Pause",t[t.End=2]="End"}(X||(X={}));class z extends k{constructor(){super(),this.ins=st.instance,this.timer=0,this._norV3=null,this.btimer=0,this.start=null,this.end=null,this.pt=null,this.bspeed=.02,this.endMsg=!1,this.going=!0,this.moveTime=0,this.pauseTime=0,this.pauseMsg=!1,this.eskillCom=null,this.randed=!1,this.randnm=0,this.randty=0,this.eid=null,this.state=E.START,this.moveState=X.Move,this.edata=null,this.isRotate=!1,this.isRotSelf=!1,this.isPauseSelf=!1,z.__eid__++,this.eid=z.__eid__}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&this.isRotSelf&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){if(this.state=E.START,this.moveState=X.Move,this.timer=0,this.btimer=0,this.moveTime=0,this.pauseTime=0,this.pauseMsg=!1,this.endMsg=!1,this.going=!0,!this.edata)return;this.eskillCom=this.owner.getComponent(q);const i=this.edata,l=this.owner,a=h.enemys[i.type];if(a.skill){const t=a.skill;12==t&&(this.isRotSelf=!0,this.isPauseSelf=!0),17==t&&(this.isRotSelf=!0)}this.start=i.in.clone(),i.direntry==s.Top?this.start.y-=l.height:i.direntry==s.Left?this.start.x-=l.width:i.direntry==s.Right?this.start.x+=l.width:i.direntry==s.Bottom&&(this.start.y+=l.height);const n=this.start;if(l.pos(n.x,n.y),i.out){this.end=i.out.clone(),i.return!=e.Repeat&&i.return!=e.Remove||(i.direxit==s.Top?this.end.y-=l.height:i.direxit==s.Left?this.end.x-=l.width:i.direxit==s.Right?this.end.x+=l.width:i.direxit==s.Bottom&&(this.end.y+=l.height));const a=this.end;if(i.route==t.Line){let t=this.getVec3(),e=this.getVec3();Laya.Vector3.subtract(this.getVec3(a.x,a.y),this.getVec3(n.x,n.y),t),Laya.Vector3.normalize(t,e),this.norV3=e}else if(i.route==t.DownCurve){let t=this.getVec2(a.x-n.x,a.y-n.y),e=this.getVec2(n.x+t.x/2,n.y+t.y/2),s=this.getVec2(-t.y,t.x);t.x<0&&(s=this.getVec2(t.y,-t.x));let i=this.getVec2(e.x+s.x/4,e.y+s.y/4),l=2*i.x-(n.x+a.x)/2,o=2*i.y-(n.y+a.y)/2,r=this.getVec2(l,o);this.pt=r}else if(i.route==t.UpCurve){let t=this.getVec2(a.x-n.x,a.y-n.y),e=this.getVec2(n.x+t.x/2,n.y+t.y/2),s=this.getVec2(t.y,-t.x);t.x<0&&(s=this.getVec2(-t.y,t.x));let i=this.getVec2(e.x+s.x/4,e.y+s.y/4),l=2*i.x-(n.x+a.x)/2,o=2*i.y-(n.y+a.y)/2,r=this.getVec2(l,o);this.pt=r}}else{this.end=this.getVec2(n.x,i.in.y+i.distance);let t=this.end,e=this.getVec3(),s=this.getVec3();Laya.Vector3.subtract(this.getVec3(t.x,t.y),this.getVec3(n.x,n.y),e),Laya.Vector3.normalize(e,s),this.norV3=s}let o=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.end.x,this.end.y),this.getVec3(n.x,n.y),o);let r=Math.sqrt(o.x*o.x+o.y*o.y);this.bspeed=300/r*.02*(i.speed||1),this.randed=!1,this.randty=0,this.randnm=0}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.recover(this.owner)}bezier(t,e,s,i,l){l?(t.x=(1-e)*(1-e)*s.x+2*e*(1-e)*l.x+e*e*i.x,t.y=(1-e)*(1-e)*s.y+2*e*(1-e)*l.y+e*e*i.y):(t.x=s.x+(i.x-s.x)*e,t.y=s.y+(i.y-s.y)*e)}easeOutQuart(t){return-((t-=1)*t*t*t-1)}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;if(!this.edata)return;const s=this.owner,i=this.edata;let l=Laya.timer.delta;if(this.moveState==X.Move){if(this.btimer>=1){if(this.endMsg||(this.endMsg=!0,this.eskillCom&&this.eskillCom.initSkill(),this.edata.return==e.Remove&&(L.event(T.EnemyDead,s.getComponent(w)),s.removeSelf())),"number"==typeof i.return){const t=i.return;if(t==e.Return){const t=this.start.clone();this.start=this.end.clone(),this.end=t,this.norV3&&(this.norV3=this.getVec3(-this.norV3.x,-this.norV3.y)),this.going&&L.event(T.EnemyReturn,this.going),this.going=!this.going}else e.Repeat;this.btimer=0}else this.moveState=X.End;return}if(this.moveTime>=1e3)return this.moveState=X.Pause,void(this.moveTime=0);const a=this.start,n=this.end;if(i.route==t.Line){let t=this.bspeed;this.going||(t*=2),this.btimer+=t;let e=this.btimer;"null"===i.return&&(e=this.easeOutQuart(this.btimer)),s.x=a.x+(n.x-a.x)*e,s.y=a.y+(n.y-a.y)*e,this.isPauseSelf&&(this.moveTime+=l)}else this.btimer+=this.bspeed,this.bezier(s,this.btimer,this.start,this.end,this.pt)}if(this.moveState==X.Pause){if(this.pauseTime>=500)return this.moveState=X.Move,this.pauseTime=0,void(this.pauseMsg=!1);this.pauseMsg||(this.pauseMsg=!0,L.event(T.EnemyPause,this.eid)),this.pauseTime+=l}if(this.moveState==X.End){this.timer+=Laya.timer.delta/1e3;let t=Math.cos(this.timer);if(Math.abs(t)>=.999){if(!this.randed)if(this.randed=!0,this.randnm>=1){let t=[-1,0,1],e=O.getRandom(2,0);this.randty=t[e],this.randnm=0}else this.randnm++}else this.randed=!1;s.x+=t,s.y+=.8*t*this.randty}if(this.isRotate){let t=this.ins.playerV2,e=s.x-t.x,i=s.y-t.y,a=Math.atan2(e,-i)/Math.PI*180,n=this.getVec3();Laya.Vector3.lerp(this.getVec3(s.rotation),this.getVec3(a),l/500,n),s.rotation=n.x}}}z.__eid__=0;class Y extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.enemyCom=null,this.buffNode=null,this.buff2Node=null,this.buff3Node=null,this.boomPre=null,this.hpBar=null,this.barPor=1,this.hp=0,this.timers={},this.boomPre=this.getRes(u.battle.EnemyBoom)}onEnable(){const t=this.owner;this.hpBar=t.getChildByName("hpBar"),this.selfCol=this.owner.getComponent(w),this.enemyCom=this.owner.getComponent(z),this.hp=this.enemyCom.edata.hp,this.hpBar.value=1,this.barPor=1,L.on(T.LaserHide,this,t=>{let e=this.selfCol.bids.indexOf(t.bid);e>-1&&(this.selfCol.bids.splice(e,1),this.onCollisionExit(t,this.selfCol))}),L.on(T.GameStateChange,this,()=>{if(this.ins.gameState==E.PAUSE)for(const t in this.timers){const e=this.timers[t];e&&e.hit&&e.hit.removeSelf()}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this),this.buffNode&&this.buffNode.removeSelf(),this.buffNode=null,this.buff2Node&&this.buff2Node.removeSelf(),this.buff2Node=null,this.buff3Node&&this.buff3Node.removeSelf(),this.buff3Node=null;for(const t in this.timers){const e=this.timers[t];e&&e.timer&&clearInterval(e.timer),e&&e.hit&&e.hit.removeSelf()}this.timers={}}onCollision(t,e,s){if(this.ins.gameState!=E.START)return;const i=this.owner;if(!i||!i.parent)return void this.onDisable();if(i.x<=-10||i.x>=730||i.y<=-10||i.y>=1290)return;if(!e||!e.owner||!e.owner.getComponent(B))return;const l=e.owner.getComponent(B).data,a=this.ins.playerData.skills;if(a[x.Cri]){c.skills[x.Cri].value}if(console.log("hp -> ",this.hp),this.barPor=this.hp/this.enemyCom.edata.hp,s&&this.makeBoom("hit",e.owner),a[x.SuckBlood]){c.skills[x.SuckBlood].value}const n=this.open(u.battle.EnemyHPTip,this.ins.eneHPTipPre);n.text=`-${Math.floor(l.attack)}`,n.pos(t.x,this.owner.y),this.ins.effectNode.addChild(n),this.hp<=0&&(this.onDisable(),this.owner.removeSelf(),L.event(T.EnemyDead,this.selfCol),this.makeBoom(this.enemyCom.edata.type),this.makeCoin(),a[x.DieBoom]&&this.makeDieBoom(),a[x.DieShot]&&this.makeDieShot())}makeBoom(t,e){const s=this.boomPre,i=this.open(u.battle.EnemyBoom,s);i.__$type$__=t;let l=this.owner;e?(i.x=e.x,i.y=e.y,i.getComponent(R).delta=150):(i.x=l.x,i.y=l.y),this.ins.effectNode.addChild(i)}makeCoin(){const t=this.getRes(g.Coin),e=Laya.Sprite3D.instantiate(t),s=this.ins,i=this.owner;let l=this.getVec3();s.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(i.x,i.y),l),e.transform.position=l,e.transform.localScale=this.getVec3(10,10,10),e.transform.rotationEuler=this.getVec3(-90,0,0),e.addComponent(v),s.modSceneV3.addChild(e)}makeDieBoom(){const t=this.ins.playerData,e=this.getRes(u.battle.PlayerDieBoom),s=this.open(u.battle.PlayerDieBoom,e),i=this.owner;s.x=i.x,s.y=i.y;let l=s.getComponent(B);l||(l=s.addComponent(B));const a=c.skills[x.DieBoom].value||1;l.setData(Math.floor(t.attack*a),t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr),this.ins.effectNode.addChild(s)}makeDieShot(){const t=this.owner,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(.71,-.71),this.getVec3(1,0),this.getVec3(.71,.71),this.getVec3(0,1),this.getVec3(-.71,.71),this.getVec3(-1,0),this.getVec3(-.71,-.71)],i=this.getRes(u.battle.PlayerDieShot),l=c.skills[x.DieShot];for(let a=0;a<8;a++){const n=this.open(u.battle.PlayerDieShot,i),o=n.getComponent(N);let r=n.getComponent(B);r||(r=n.addComponent(B));const h=c.skills[x.DieShot].value||1;r.setData(Math.floor(e.attack*h),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),o.speed=l.fspeed,o.norV3=s[a].clone(),o.state=E.START,o.tar=null,n.pos(t.x,t.y),this.ins.playerNode.addChild(n)}}onCollisionEnter(t,e,s){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;const i=this.owner;let l=t.owner.__type__,a=!0,n=t.owner;if((s||l&&l==_.MAGNET)&&(n=e.owner,a=!1),l&&(l==_.POISON||l==_.FIRE)){if(a=!1,this.schedule(1e3,()=>{this.onCollision(e.owner,t)},this,4,null,!0),l==_.POISON&&!this.buffNode){const t=u.battle.PlayerPoisonBuff,e=this.getRes(t),s=this.open(t,e),l=i.getChildAt(0);s.pos(l.x,l.y),this.owner.addChild(s),this.buffNode=s,Laya.timer.once(4e3,this,()=>{s.removeSelf(),this.buffNode=null})}if(l==_.FIRE&&!this.buff2Node){const t=u.battle.PlayerFireBuff,e=this.getRes(t),s=this.open(t,e),l=i.getChildAt(0);s.pos(l.x,l.y),this.owner.addChild(s),this.buff2Node=s,Laya.timer.once(4e3,this,()=>{s.removeSelf(),this.buff2Node=null})}}if(l&&l==_.ICE&&(a=!1,this.enemyCom.state=E.PAUSE,!this.buff3Node)){const t=u.battle.PlayerIceBuff,e=this.getRes(t),s=this.open(t,e),l=i.getChildAt(0);s.pos(l.x,l.y),this.owner.addChild(s),this.buff3Node=s,Laya.timer.once(3e3,this,()=>{s.removeSelf(),this.buff3Node=null,this.enemyCom.state=E.START})}if(l&&l==_.LASER&&(a=!1),this.onCollision(n,t,a),this.timers&&l&&l==_.LASER){let e=setInterval(()=>{this.onCollision(n,t)},200);const s=()=>{if(this.ins.gameState!=E.START)return;const e=t.owner.__spicol__;let s=u.battle.PlayerLaserHit;1==e&&(s=u.battle.PlayerLaserHit3),2==e&&(s=u.battle.PlayerLaserHit2);const i=this.getRes(s),l=this.open(s,i);l.x=n.x,l.y=this.owner.y;const a=l.getComponent(I);return a.xp=n,a.yp=this.owner,this.ins.effectNode.addChild(l),l},i=this.timers[t.bid];if(i)if(i.timer&&clearInterval(i.timer),this.timers[t.bid].timer=e,i.hit){const t=i.hit.getComponent(I);t.xp=n,t.yp=this.owner}else{const e=s();this.timers[t.bid].hit=e}else{const i=s();this.timers[t.bid]={timer:e,hit:i}}}}onCollisionExit(t,e){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;let s=t.owner.__type__;if(s&&s==_.LASER){if(!this.timers)return;const e=this.timers[t.bid];e&&(e.timer&&clearInterval(e.timer),e&&e.hit&&e.hit.removeSelf(),this.timers[t.bid]=null)}}onLateUpdate(){let t=this.getVec3();Laya.Vector3.lerp(this.getVec3(this.hpBar.value),this.getVec3(this.barPor),.01*Laya.timer.delta,t),this.hpBar.value=t.x}}class Q extends k{constructor(){super(),this.ins=st.instance,this.han1=null,this.han2=null,this.cloHan=null,this.tar=null,this.isClose=!1}onEnable(){this.isClose=!1;const t=this.owner,e=this.ins,s=t.getChildByName("s1"),i=t.getChildByName("s2"),l=e.playerData.supUnlock,a=l.length-1,n=[];for(;n.length<2;){let t=Math.floor(Math.random()*(a-0+1)+0);n.indexOf(t)<0&&n.push(t)}let o=l[n[0]],r=l[n[1]];this.setSkill(s,o,0),this.setSkill(i,r,1),this.setClick(s,()=>{this.han1&&this.han1(),this.onCloseClick()},this),this.setClick(i,()=>{this.han2&&this.han2(),this.onCloseClick()},this)}setSkill(t,e,s){const i=t.getChildByName("name"),l=t.getChildByName("desc"),a=c.skills[e];i.text=a.name,l.text=a.describe,s?this.han2=(()=>{L.event(`player_${a.id}_supply`)}):this.han1=(()=>{L.event(`player_${a.id}_supply`)})}onCloseClick(){this.owner.removeSelf();const t=this.ins,e=this.tar;Laya.Tween.to(e,{y:0-e.height/2},500,null,Laya.Handler.create(this,()=>{this.cloHan&&!this.isClose&&(this.isClose=!0,this.cloHan()),t.player2Node.alpha=1,t.playerNode.alpha=1,t.effectNode.alpha=1,t.bgTopNode.alpha=1,e.removeSelf()}))}onDisable(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}onUpdate(){this.ins.gameState,E.START}}class Z extends k{constructor(){super(),this.ins=st.instance,this.skeCon=null,this.templet=null,this.ske=null,this.cloHan=null,this.edata=null}onEnable(){const t=this.owner,e=this.ins;e.playerNode.alpha=0;const s=e.player2Node;for(let t=s.numChildren-1;t>=0;t--){s.getChildAt(t).removeSelf()}e.player2Node.alpha=0,e.effectNode.alpha=0,e.bgTopNode.alpha=0;const i=new Laya.Templet;this.templet=i,i.on(Laya.Event.COMPLETE,this,this.parseComplete),i.loadAni(m[3002]);const l=e.playerV3;let a=this.getVec3();e.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,764),a),Laya.Tween.to(t,{y:640},500,null,Laya.Handler.create(this,()=>{Laya.Tween.to(l.transform,{localPositionX:a.x,localPositionZ:a.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{e.playerPosV3=a,e.playerPosV2=this.getVec3(360,764),Laya.timer.once(1e3,this,()=>{this.openDialog(u.battleUI.SupplySkillDialog,e.dialogNode,e=>{e.y=1140;const s=e.getComponent(Q);s.cloHan=this.cloHan,s.tar=t},!0)})}))}))}parseComplete(){this.ske=this.templet.buildArmature(0);const t=this.ske,e=A[3002];t.pos(e.self.x,e.self.y),t.on(Laya.Event.STOPPED,this,this.completeHandler),t.play(0,!1),this.skeCon.addChild(t)}completeHandler(){this.ske.play(1,!0)}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop(),this.ske.removeSelf()),this.templet&&(this.templet.offAllCaller(this),this.templet.destroy()),Laya.Tween.clearAll(this),Laya.timer.clearAll(this),this.recover(this.owner)}onUpdate(){}}class $ extends k{constructor(){super(),this.maskNode=null,this.parentNode=null,this.bgSke=null,this.skill1Tit=null,this.skill1Icon=null,this.skill1Desc=null,this.skill2Tit=null,this.skill2Icon=null,this.skill2Desc=null,this.skill3Tit=null,this.skill3Icon=null,this.skill3Desc=null,this.skills=[],this.handle=null}onEnable(){this.owner;this.bgSke.alpha=0,this.parentNode.alpha=0,this.setClick(this.skill1Icon,()=>{const t=this.skills[0].han;t&&t(),this.hide(this.skills[0].id)},this),this.setClick(this.skill2Icon,()=>{const t=this.skills[1].han;t&&t(),this.hide(this.skills[1].id)},this),this.setClick(this.skill3Icon,()=>{const t=this.skills[2].han;t&&t(),this.hide(this.skills[2].id)},this),this.setClick(this.maskNode,()=>{},this,null,!0),this.skills.length||(this.skills.push({title:this.skill1Tit,icon:this.skill1Icon,desc:this.skill1Desc,han:null,id:null}),this.skills.push({title:this.skill2Tit,icon:this.skill2Icon,desc:this.skill2Desc,han:null,id:null}),this.skills.push({title:this.skill3Tit,icon:this.skill3Icon,desc:this.skill3Desc,han:null,id:null})),Laya.timer.once(200,this,()=>{this.bgSke.templet&&(this.bgSke.play(0,!1),this.bgSke.alpha=1,Laya.timer.once(2e3,this,()=>{this.bgSke.alpha=0}))}),Laya.Tween.to(this.parentNode,{alpha:1},1e3,Laya.Ease.circIn)}setData(t){const e=this.skills;for(let s=0;s<t.length;s++){const i=t[s],l=e[s];if(!l)continue;const a=c.skills[i];l.title.text=a.name,l.desc.text=a.describe,l.han=(()=>{let t="";i<2e3?t=`player_${i}_baseskill`:i>2e3&&i<3e3?t=`player_${i}_bulskill`:i>3e3&&i<4e3?t=`player_${i}_wingskill`:i>4e3&&(t=`player_${i}_robskill`),L.event(t)}),l.id=i}}hide(t){this.handle&&t&&this.handle(t);(()=>{Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{L.event(T.RateStart),L.event(T.StudySkill),this.owner.removeSelf()}))})()}onDisable(){this.bgSke.offAllCaller(this)}}class J extends k{constructor(){super(),this.ins=st.instance,this.pauseBtn=null,this.lvPro=null,this.lvSke=null,this.lvLab=null,this.rateLab=null,this.coinLab=null,this.rewardLab=null,this.rateTipLab=null,this.supplyData=null}onEnable(){const t=this.ins,e=t.playerData,s=r.comChapters[e.chapter-1];this.rateLab.text=`${e.rate}/${s.level}`,this.lvSke.alpha=0,this.setClick(this.pauseBtn,()=>{let e=t.gameState;e==E.START&&(t.gameState=e==E.START?E.PAUSE:E.START,this.loadPrefab(u.battleUI.PlayerSkillItem).then(()=>{this.openDialog(u.battleUI.GamePauseDialog,t.dialogNode)}))},this),L.on(T.RateStart,this,()=>{t.gameState=E.START;let i=l.levelExps[e.level],a=e.exp/i,n=e.level,o=r.comChapters[e.chapter-1].maxair;e.level>=o+1&&(a=1,n=o),this.lvPro.value=a,this.lvLab.text=`LV. ${n}`,e.rate+=1,this.rateLab.text=`${e.rate}/${s.level}`;let h=this.rateTipLab;h.text=`第${e.rate}关`,h.x=1080,Laya.Tween.to(h,{x:340},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{Laya.Tween.to(h,{x:380},1e3,null,Laya.Handler.create(this,()=>{Laya.Tween.to(h,{x:-360},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{}))}))})),L.event(T.LevelEnemy)}),L.on(T.RateEnd,this,()=>{const s=()=>{const s=e.chapter;let a=e.rate;const n=e.rate+1;if(!i["enemys"+s][n])return t.playerNode.alpha=0,t.player2Node.alpha=0,t.eneBulNode.alpha=0,t.effectNode.alpha=0,t.bgTopNode.alpha=0,void(t.gameState=E.END);let o=l.upLevExps[a]||1,h=l.levelExps[e.level];e.exp+=o;let c=e.exp/h,d=r.comChapters[e.chapter-1].maxair;e.level>=d+1&&(c=1),Laya.Tween.to(this.lvPro,{value:c},1e3,Laya.Ease.cubicIn,Laya.Handler.create(this,()=>{e.level<d+1&&e.exp>=h?(e.level+=1,e.exp=0,this.lvSke.templet?(this.lvSke.play(0,!1),this.lvPro.alpha=0,this.lvSke.alpha=1,Laya.timer.once(1e3,this,()=>{this.lvSke.alpha=0,this.lvPro.alpha=1,this.getRandomSkill()})):(this.lvPro.alpha=1,this.getRandomSkill())):L.event(T.RateStart)}))};if(this.supplyData){t.gameState=E.PAUSE;const e=this.supplyData;this.supplyData=null;const i=this.open(f[e.type],t.eneMgr.enemyPres[e.type]),l=i.getComponent(Z);i.pos(360,1280+i.height/2),l.edata=e,l.cloHan=s.bind(this),this.ins.bgSceneV2.addChild(i)}else s()});let n=!1;L.on(T.GameStateChange,this,()=>{this.ins.gameState!=E.END||n||(n=!0,e.currHP>0&&t.playerV3&&t.playerV3.parent?(Laya.timer.once(3e3,this,()=>{const e=t.playerV3;let s=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,640),s),Laya.Tween.to(e.transform,{localPositionX:s.x,localPositionZ:s.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{Laya.timer.once(1e3,this,()=>{Laya.Tween.to(e.transform,{localPositionZ:s.z-8},300,null,Laya.Handler.create(this,()=>{this.loadPrefab(u.battleUI.PlayerSkillItem).then(()=>{this.openDialog(u.battleUI.GameOverDialog,t.dialogNode)})}))})}))}),a.setChapter()):Laya.timer.once(3e3,this,()=>{this.openDialog(u.battleUI.GameOverDialog,t.dialogNode)}))}),L.on(T.GameOver,this,()=>{t.gameState=E.END})}getRandomSkill(){const t=this.ins,e=t.playerData;t.gameState=E.PAUSE;const s=e.unlock,i=c.skills,l=(()=>{let l=s.concat();const a=l.indexOf(1013);if(e.currHP>=e.hp&&a>=0&&l.splice(a,1),t.plaWingsV2.length>=4)for(let t=l.length-1;t>=0;t--){const e=l[t];3==i[e].skilltype&&l.splice(t,1)}else{let t=null;for(const s in e.skills)3==i[s].skilltype&&(t=parseInt(s));if(t)for(let e=l.length-1;e>=0;e--){const s=l[e];3==i[s].skilltype&&s!=t&&l.splice(e,1)}}return l})();if(l.length<3)return void L.event(T.RateStart);const a=[],n=l.length-1;for(;a.length<3;){let t=Math.floor(Math.random()*(n-0+1)+0);a.indexOf(t)<0&&a.push(t)}let r=l[a[0]],h=l[a[1]],d=l[a[2]];this.openDialog(u.battleUI.ChooseSkillDialog,t.dialogNode,t=>{const e=t.getComponent($);e.handle=(t=>{const e=i[t],l=s.indexOf(t);e.add==o.Once&&s.splice(l,1),e.add==o.Add&&(i[t+1]&&i[t+1].add==o.Add?s[l]=t+1:s.splice(l,1))}).bind(this),e.setData([r,h,d])})}onDisable(){L.offAllCaller(this),Laya.timer.clearAll(this),Laya.Tween.clearAll(this)}}class K extends k{constructor(){super(),this.ins=null,this.timer=0,this.eneQue={},this.start=!1,this.insUI=null,this.enemyPres={};for(const t in f){const e=f[t];this.enemyPres[t]=this.getRes(e)}}onEnable(){this.ins=st.instance,this.insUI=this.ins.owner.getComponent(J),L.on(T.LevelEnemy,this,this.makeLevelEnemy)}onDisable(){}makeLevelEnemy(){const t=this.ins,e=t.playerData,s=e.chapter,l=e.rate;t.isMakingEnemy=!0;const a=i["enemys"+s][l];for(let t=0;t<a.length;t++){const e=a[t];if(this.enemyPres[e.type])if(3002==e.type||3003==e.type)this.insUI.supplyData=e;else if(1001==e.type){const t=6,s=e.time;for(let i=0;i<t;i++){let t=s+.2*i;if(this.eneQue[1e3*t]){let s=.2;for(;this.eneQue[1e3*t+s];)s+=.2;this.eneQue[1e3*t+s]=e}else this.eneQue[1e3*t]=e}}else if(this.eneQue[1e3*e.time]){let t=1;for(;this.eneQue[1e3*e.time+t];)t++;this.eneQue[1e3*e.time+t]=e}else this.eneQue[1e3*e.time]=e}this.start=!0,this.timer=0}enemy(t){const e=this.open(f[t.type],this.enemyPres[t.type]),s=e.getComponent(z);s.edata=t,s.isRotate=!1,s.isRotSelf=!1,s.isPauseSelf=!1,e.pos(0,-1e3),this.ins.enemyNode.addChild(e);const i=e.getComponent(w);this.ins.enemyCols.push(i),Object.keys(this.eneQue).length||(L.event(T.LevelEnemyEnd),this.ins.isMakingEnemy=!1)}onLateUpdate(){if(this.ins.gameState==E.START&&this.start){this.timer+=Laya.timer.delta;for(const t in this.eneQue)if(this.timer>=parseInt(t)){const e=this.eneQue[t];delete this.eneQue[t],this.enemy(e)}Object.keys(this.eneQue).length||(this.start=!1,this.timer=0)}}}class tt{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.speed=0,this.fspeed=0,this.eneHurtStr=0,this.bosHurtStr=0,this.planeData=null,this.hp=0,this.currHP=0,this.defense=0,this.subHurt=0,this.id=0,this.chapter=1,this.rate=1,this.exp=0,this.level=1,this.skills={},this.rewards={},this.track=!1,this.cross=!1,this.unlock=[],this.supUnlock=[],this.laserSta=0,this.trackTar=null,this.trackBox=null,this.trackCol=null,this.mainNum=0}init(){this.id=a.id,this.planeData=y.planes[this.id],this.attack=a.attack,this.crit=a.crit,this.critHurt=a.critHurt,this.speed=a.speed,this.fspeed=a.fspeed,this.eneHurtStr=a.eneHurtStr,this.bosHurtStr=a.bosHurtStr,this.hp=a.hp,this.currHP=a.hp,this.defense=a.defense,this.subHurt=a.subHurt,this.chapter=a.chapter,this.rate=a.rate,this.exp=0,this.level=1,this.skills={},this.rewards={};const t=a.unlock;for(let e=0;e<t.length;e++){c.skills[t[e]].add!=o.Supply?this.unlock.push(t[e]):this.supUnlock.push(t[e])}}setSkill(t){this.skills[t]?this.skills[t]++:this.skills[t]=1}setSkill2(t){const e=this.skills;let s=null;for(let i=0;i<5;i++){const l=t+i;if(e[l]){s=l;break}}s?(e[s+1]=1,delete e[s]):e[t]=1}}class et extends k{constructor(){super(),this.ins=st.instance,this.stuSke=null}onEnable(){this.stuSke.alpha=0,this.stuSke.blendMode=Laya.BlendMode.LIGHTER,this.stuSke.on(Laya.Event.STOPPED,this,()=>{this.stuSke.alpha=0}),L.on(T.StudySkill,this,()=>{this.stuSke.templet&&(this.stuSke.play(0,!1),this.stuSke.alpha=1)})}onDisable(){this.stuSke.offAllCaller(this)}onLateUpdate(){const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),i=this.getVec3();Laya.Vector3.lerp(s,this.ins.playerPosV2,15*e,i),t.pos(i.x,i.y)}}class st extends k{constructor(){super(),this.bgPre=null,this.eneHPTipPre=null,this.enemyNode=null,this.bgTopNode=null,this.eneBulNode=null,this.playerNode=null,this.player2Node=null,this.effectNode=null,this.dialogNode=null,this.bgSceneV2=null,this.modSceneV3=null,this.modCameraV3=null,this.playerV3=null,this.playerV2=null,this.playerHPV2=null,this.plaLassV2=[],this.plaWingsV2=[],this.playerPosV3=new Laya.Vector3(0,0,0),this.playerPosV2=new Laya.Vector3(360,900,0),this.touchX=0,this.touchY=0,this.rotationZ=0,this.lastX=0,this.ratio3D=128,this.isMakingEnemy=!1,this.playerData=null,this._gameState=E.READY,this.eneMgr=null,this.enemyCols=[],this.playerCols=[],st.instance=this;const t=Laya.stage.addChild(new Laya.Scene);t.zOrder=-2,this.bgSceneV2=t;const e=Laya.stage.addChild(new Laya.Scene3D);e.zOrder=-1,this.modSceneV3=e;const s=e.addChild(new Laya.Camera(0,.1,1e3));this.modCameraV3=s,s.clearFlag=Laya.CameraClearFlags.Nothing,s.clearColor=new Laya.Vector4(0,0,0,0),s.transform.rotate(new Laya.Vector3(-90,0,0),!1,!1),s.orthographic=!0,s.orthographicVerticalSize=10;const i=e.addChild(new Laya.DirectionLight);i.color=new Laya.Vector3(1,1,1),i.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0)),this.bgPre=this.getRes(u.battle.BgNode),this.eneHPTipPre=this.getRes(u.battle.EnemyHPTip)}set gameState(t){this._gameState=t,L.event(T.GameStateChange)}get gameState(){return this._gameState}onEnable(){const t=this.open(u.battle.BgNode,this.bgPre);this.bgSceneV2.addChild(t),this.enemyNode=this.bgSceneV2.addChild(new Laya.Sprite),this.bgTopNode=this.bgSceneV2.addChild(new Laya.Sprite),this.eneMgr=this.owner.getChildByName("enemyManager").getComponent(K),this.gameState=E.READY,this.playerData=new tt,this.playerData.init(),L.on(T.LaserTrack,this,this.getTrackEnemy),L.on(T.EnemyDead,this,t=>{this.enemyCols.splice(this.enemyCols.indexOf(t),1);this.playerData;this.isMakingEnemy||this.enemyCols.length||Laya.timer.once(2e3,this,()=>{L.event(T.RateEnd)}),2==this.playerData.laserSta&&this.playerData.trackBox&&t.bid==this.playerData.trackBox.bid&&this.getTrackEnemy()}),L.on(T.LevelEnemyEnd,this,()=>{2==this.playerData.laserSta&&this.getTrackEnemy()}),L.on(T.GameOver,this,()=>{this.playerV3.removeSelf(),this.playerV2.removeSelf(),this.playerHPV2.removeSelf();for(let t=0;t<this.plaLassV2.length;t++)this.plaLassV2[t].removeSelf();for(let t=0;t<this.plaWingsV2.length;t++)this.plaWingsV2[t].removeSelf()});const e=window.location.href,s=e.indexOf("?");if(s>-1){const t=e.slice(s+1).split("&"),i=[];for(let e=0;e<t.length;e++){const s=t[e];i[e]=parseFloat(s)}const l=c.skills;if(i[0]<1e3){const t=this.playerData;t.id=i[0],t.planeData=y.planes[t.id],t.planeData.att=i[1],t.speed=i[2],t.fspeed=i[3]}else{const t=l[i[0]];t&&(t.value=i[1],t.speed=i[2],t.fspeed=i[3],t.robotsp=i[4],t.robotbullet=i[5])}}}onDisable(){this.bgSceneV2.destroy(!0),this.modSceneV3.destroy(!0),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}getTrackEnemy(){let t=this.getMinEnemy(this.playerV2);t?(this.playerData.trackTar=t,this.playerData.trackBox=t.getComponent(w),this.playerData.trackCol=t.getComponent(Y)):(this.playerData.trackTar=null,this.playerData.trackBox=null,this.playerData.trackCol=null),L.event(T.LaserTrackTar)}getMinEnemy(t){let e=null,s=null;for(let i=0;i<this.enemyCols.length;i++){const l=this.enemyCols[i].owner;if(!l||!l.parent)continue;let a=l.x-t.x,n=l.y-t.y,o=a*a+n*n;(!e||o<e)&&(e=o,s=l)}return s}onStageMouseDown(t){this.gameState==E.START&&(this.touchX=t.stageX,this.touchY=t.stageY)}onStageMouseMove(t){if(this.gameState!=E.START)return;let e=t.stageX-this.touchX,s=t.stageY-this.touchY;this.rotationZ-=e/8,Math.abs(this.rotationZ)>45&&(this.rotationZ*=.7),this.touchX=t.stageX,this.touchY=t.stageY;let i=this.playerPosV2.x+e,l=this.playerPosV2.y+s;i>=0&&i<=720&&(this.playerPosV2.x=i),l>=0&&l<=1280&&(this.playerPosV2.y=l),this.modCameraV3.convertScreenCoordToOrthographicCoord(this.playerPosV2,this.playerPosV3)}onStageMouseUp(t){this.gameState==E.START&&(this.touchX=0,this.touchY=0,this.rotationZ=0,this.playerV3.transform.localRotationEulerZ=0)}onLateUpdate(){if(this.gameState!=E.START)return;let t=Laya.timer.delta/1e3;if(this.playerV3){let e=this.playerV3.transform.position,s=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(e,this.playerPosV3,15*t,s),this.playerV3.transform.position=s,Math.abs(this.playerV3.transform.position.x-this.lastX)<=.02&&(this.rotationZ=0);let i=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(this.playerV3.transform.localRotationEuler,this.getVec3(0,0,this.rotationZ),15*t,i),this.playerV3.transform.localRotationEuler=i,this.lastX=this.playerV3.transform.position.x}}}class it extends k{constructor(){super(),this.ins=st.instance,this.laser=null,this.laser2=null,this.deltaX=0,this.deltaY=0}onEnable(){this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER),this.laser2&&(this.laser2.blendMode=Laya.BlendMode.LIGHTER)}onDisable(){}onLateUpdate(){const t=this.owner;let e=this.ins.playerV2;t.pos(e.x+this.deltaX,e.y+this.deltaY)}}class lt extends k{constructor(){super(),this.ins=st.instance,this._norV3=null,this.speed=.1}get norV3(){return this._norV3}set norV3(t){this._norV3=t}onEnable(){}onDisable(){}onLateUpdate(){if(this.ins.gameState!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class at extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this._norV3=null,this.state=E.READY,this.radius=100,this.angle=0,this.speed=1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner;this.selfCol=this.owner.getComponent(w),this.ins.playerCols.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol),this.state=E.START}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins,e=this.owner;let s=Laya.timer.delta/200*this.speed;this.angle+=s,e.rotation=-180-this.angle/Math.PI*180,e.x=t.playerV2.x+this.radius*Math.cos(this.angle),e.y=t.playerV2.y-this.radius*Math.sin(this.angle)}}class nt extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.beil=2,this.state=E.READY,this.speed=.8}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.state=E.START,this.beil=3}onDisable(){L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;this.beil>1&&(this.beil-=.06);let e=this.speed*this.beil,s=Laya.timer.delta*e;t.x+=s*this.norV3.x,t.y+=s*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(st.instance.enemyCols,this.selfCol)}}class ot extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.speed=2.5,this.state=E.READY,this.delta=0}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.state=E.START}onDisable(){L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0-this.delta||t.x>=720+this.delta||t.y<=0-this.delta||t.y>=1280+this.delta)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class rt extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.angle=0,this.state=E.READY,this.js=!1,this.tar=null,this.pangle=0,this.speed=.5,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.angle=0,this.js=!1,this.state=E.START;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(g.CaiHon),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y-30),a),s.transform.position=a,this.s3d=s}onDisable(){this.s3d.removeSelf(),L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.js){if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i),Laya.Vector3.lerp(this.norV3,i,e/50,l),this.norV3=l,e*=2}}else{if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let a=Math.atan2(-i.y,i.x);Laya.Vector3.lerp(this.getVec3(this.pangle),this.getVec3(a),e/100,l),this.pangle=l.x;let n=this.tar.x-t.x,o=this.tar.y-t.y;n*n+o*o<=9e4&&(this.js=!0)}this.angle+=5;let s=Math.atan(Math.cos(this.angle/180*Math.PI)),i=.7*Math.tan(s),l=new Laya.Vector3(0,0,0),a=this.pangle,n=1*Math.cos(a)+i*Math.sin(a),o=i*Math.cos(a)-1*Math.sin(a);Laya.Vector3.normalize(this.getVec3(n,o),l),this.norV3=l}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class ht extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=E.READY,this.angle=0,this.type=null,this.speed=1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-180-Math.atan2(-t.y,t.x)/Math.PI*180)}onEnable(){this.owner.__type__=this.type?this.type:_.POISON,this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.state=E.START}onDisable(){L.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta/200*this.speed;this.angle+=e,t.rotation=-180-this.angle/Math.PI*180,t.x=this.ins.playerV2.x+200*Math.cos(this.angle),t.y=this.ins.playerV2.y-200*Math.sin(this.angle),this.quadTree.check(st.instance.enemyCols,this.selfCol)}}class ct extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=E.READY,this.move=!0,this.getTar=!1,this.timer=0,this.startGet=0,this.timer2=0,this.staPos=this.getVec3(),this.staPosV3=this.getVec3(),this.endPos=this.getVec3(),this.endPosV3=this.getVec3(),this.speed=.5,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.move=!0,this.getTar=!1,this.timer=0,this.startGet=0,this.state=E.READY,L.on(T.BulSkill7_Start,this,()=>{this.state=E.START});const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(g.DaoDanGui),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s,this.timer2=0,this.setStaEndPos()}setStaEndPos(){const t=this.owner,e=this.ins;this.staPos=this.getVec3(t.x,t.y),this.endPos=this.getVec3(t.x+200*this.norV3.x,t.y+200*this.norV3.y),e.modCameraV3.convertScreenCoordToOrthographicCoord(this.staPos,this.staPosV3),e.modCameraV3.convertScreenCoordToOrthographicCoord(this.endPos,this.endPosV3)}onDisable(){this.s3d.removeSelf(),L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}easeOutQuart(t){return-((t-=1)*t*t*t-1)}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;if(this.move)if(this.timer2>=1)this.move=!1,this.timer2=0,this.startGet++;else{let s=this.staPos,i=this.staPosV3,l=this.endPos,a=this.endPosV3,n=this.s3d;this.timer2+=.003*e;let o=this.easeOutQuart(this.timer2);t.x=s.x+(l.x-s.x)*o,t.y=s.y+(l.y-s.y)*o,n.transform.localPositionX=i.x+(a.x-i.x)*o,n.transform.localPositionZ=i.z+(a.z-i.z)*o,t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180)}else if(this.timer>=10)this.move=!0,this.getTar=!1,this.timer=0;else{if(!this.getTar){this.getTar=!0;let e=this.ins.getMinEnemy(this.owner);if(this.startGet>=2&&e&&e.parent){let s=this.getVec3();Laya.Vector3.subtract(this.getVec3(e.x,e.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,this.norV3)}else 1!=this.startGet&&(this.norV3.x=-this.norV3.x);this.setStaEndPos()}this.timer+=Laya.timer.delta}(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class dt extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.t=0,this.circle=!1,this.bezierd=!1,this.start=null,this.pt=null,this.state=E.START,this.tar=null,this.speed=1,this.cross=!1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.t=0,this.circle=!1,this.bezierd=!1}onDisable(){this.recover(this.owner)}bezier(t,e,s,i,l){t.x=(1-e)*(1-e)*s.x+2*e*(1-e)*l.x+e*e*i.x,t.y=(1-e)*(1-e)*s.y+2*e*(1-e)*l.y+e*e*i.y;let a=2*((1-e)*(l.x-s.x)+e*(i.x-l.x)),n=2*((1-e)*(l.y-s.y)+e*(i.y-l.y)),o=this.getVec3();Laya.Vector3.normalize(this.getVec3(a,n,0),o),this.norV3=o}onCollisionEnter(t,e){this.cross||this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;this.quadTree.check(this.ins.enemyCols,this.selfCol);const t=this.owner;let e=Laya.timer.delta*this.speed;if(this.tar&&this.tar.parent)if(t.y<=this.tar.y||this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.t=1,this.tar=null;else if(Math.abs(t.y-this.tar.y)<=500&&!this.bezierd){this.bezierd=!0,this.start=this.getVec3(t.x,t.y);let e=this.start,s=this.tar,i=2*(e.x+(s.x-e.x)/4)-(e.x+s.x)/2,l=2*(e.y+(s.y-e.y)/4*3)-(e.y+s.y)/2;this.pt=this.getVec3(i,l),this.circle=!0}if(this.circle&&this.tar&&this.tar.parent){if(this.t>=1)return void(this.circle=!1);this.t+=.021,this.bezier(t,this.t,this.start,this.getVec3(this.tar.x,this.tar.y),this.pt)}this.circle&&this.tar&&this.tar.parent||(t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class pt extends k{constructor(){super(),this.ins=st.instance,this.deltaX=0,this.deltaY=0}onEnable(){}onDisable(){}onLateUpdate(){const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),i=this.getVec3(this.ins.playerPosV2.x+this.deltaX,this.ins.playerPosV2.y+this.deltaY),l=this.getVec3();Laya.Vector3.lerp(s,i,8*e,l),t.pos(l.x,l.y)}}class yt extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.circle=!0,this.state=E.READY,this.tar=null,this.angle=0,this.xv=1,this.speed=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.state=E.START,this.circle=!0;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(g.DaoDanLiaoJi),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s}onDisable(){this.s3d.removeSelf(),L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.tar&&this.tar.parent)if(t.y<=this.tar.y||this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.tar=null;else if(this.circle){let s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x)-Math.atan2(-this.norV3.y,this.norV3.x);if(l<0&&(l+=2*Math.PI),l<=.2)this.circle=!1;else{this.angle+=this.xv*e/2;let t=Math.tan(this.angle/180*Math.PI),s=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-t,0),s),this.angle>90&&(s.x=-s.x,s.y=-s.y),this.norV3.x=s.x,this.norV3.y=s.y}}else{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=-200||t.x>=920||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class ut extends k{constructor(){super(),this.ins=st.instance,this.wing2BPre=null,this.xv=1,this.wing2BPre=this.getRes(u.battle.PlayerWing2b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=c.skills[x.MissileWing],i=s.speed||5,l=s.fspeed||.2;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=E.START)return;let i=0;for(let a=0;a<6;a++){let a=Math.floor(89*Math.random()+1),n=Math.tan(a/180*Math.PI),o=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,n,0),o),o.x*=this.xv,i+=Math.floor(251*Math.random()+50),Laya.timer.once(i,this,()=>{const i=this.open(u.battle.PlayerWing2b,this.wing2BPre);let n=i.getComponent(B);n||(n=i.addComponent(B));const r=s.value||1;let h=e.attack*r;e.skills[x.MissileWing]&&(h+=e.attack*r*(e.skills[x.MissileWing]-1)*2.4),n.setData(h,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const c=i.getComponent(yt);c.speed=l,c.norV3=o,c.angle=this.xv>0?-a:a+180,c.xv=this.xv,c.tar=this.ins.getMinEnemy(t),i.pos(t.x,t.y),this.ins.player2Node.addChild(i)})}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}onLateUpdate(){}}class gt extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this.bid=x.Laser}onEnable(){const t=this.owner;t.__type__=_.LASER,t.__spicol__=this.bid==x.Laser?1:2,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),t.alpha=1;const e=c.skills[this.bid];let s=1e3*(e.fspeed+e.speed+1),i=1e3*e.speed+500;Laya.timer.loop(s,this,()=>{Laya.Tween.to(t,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids()})),Laya.timer.once(i,this,()=>{Laya.Tween.to(t,{alpha:1},500)})}),L.on(T.GameStateChange,this,()=>{this.ins.gameState==E.START?t.visible=!0:t.visible=!1})}onDisable(){this.clearBids(),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}clearBids(){this.selfCol.bids.length=0,L.event(T.LaserHide,this.selfCol)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;const t=this.owner;t.visible&&t.alpha>=.1&&this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class mt extends k{constructor(){super(),this.ins=st.instance,this.laser=null,this.tar=null,this.deltaX=0,this.deltaY=0}onEnable(){this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER)}onDisable(){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(!this.tar)return;const t=this.owner;let e=this.tar;t.pos(e.x+this.deltaX,e.y+this.deltaY)}}class ft extends k{constructor(){super(),this.ins=st.instance,this.wing3BPre=null,this.xv=1,this.wing3BPre=this.getRes(u.battle.PlayerWing3b)}onEnable(){const t=this.ins.playerData,e=this.open(u.battle.PlayerWing3b,this.wing3BPre);let s=e.getComponent(B);s||(s=e.addComponent(B));const i=c.skills[x.LaserWing].value||1;let l=t.attack*i;t.skills[x.LaserWing]&&(l+=t.attack*i*(t.skills[x.LaserWing]-1)*2.4),s.setData(l,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr);let a=this.owner;e.getComponent(mt).tar=a,e.getComponent(gt).bid=x.LaserWing,e.pos(a.x,a.y),this.ins.playerNode.addChild(e)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}onLateUpdate(){}}class bt extends k{constructor(){super(),this.ins=st.instance,this.wing5BPre=null,this.xv=1,this.wing5BPre=this.getRes(u.battle.PlayerWing5b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=c.skills[x.ShotWing],i=s.speed||.2,l=s.fspeed||.2,a=[this.getVec3(.03,-1),this.getVec3(.07,-1),this.getVec3(.1,-.99),this.getVec3(.14,-.99),this.getVec3(.17,-.98),this.getVec3(.21,-.98)];let n=0;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=E.START)return;n>=6&&(n=0);const i=this.open(u.battle.PlayerWing5b,this.wing5BPre);let o=i.getComponent(B);o||(o=i.addComponent(B));const r=s.value||1;let h=e.attack*r;e.skills[x.ShotWing]&&(h+=e.attack*r*(e.skills[x.ShotWing]-1)*2.4),o.setData(h,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const c=i.getComponent(ot);let d=a[n];c.norV3=this.getVec3(d.x*this.xv,d.y),c.speed=l,i.pos(t.x,t.y),this.ins.player2Node.addChild(i);const p=i.getChildByName("bi");p.height=0,Laya.Tween.clearAll(p),Laya.Tween.to(p,{height:66},100),n++})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}onLateUpdate(){}}class St extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.state=E.READY,this._norV3=null,this.speed=.2}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner;this.state=E.START,this.selfCol=this.owner.getComponent(w),this.ins.playerCols.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class Ct extends k{constructor(){super(),this.ins=st.instance,this.wing6BPre=null,this.wing6BPre=this.getRes(u.battle.PlayerWing6b)}onEnable(){const t=this.owner,e=c.skills[x.ShieldWing],s=e.speed||5,i=e.fspeed||.2;Laya.timer.loop(1e3*s,this,()=>{if(this.ins.gameState!=E.START)return;const e=this.open(u.battle.PlayerWing6b,this.wing6BPre),s=e.getComponent(St);s.norV3=this.getVec3(0,-1),s.speed=i,e.pos(t.x,t.y-30),this.ins.player2Node.addChild(e)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}onLateUpdate(){}}class Lt extends k{constructor(){super(),this.ins=null,this.plaBul1Pre=null,this.plaBulPre=null,this.skill1Pre=null,this.skill2Pre=null,this.skill3Pre=null,this.skill4Pre=null,this.skill5Pre=null,this.skill6Pre=null,this.skill7Pre=null,this.skill8Pre=null,this.skill9Pre=null,this.skill10Pre=null,this.plaWing1Pre=null,this.plaWing2Pre=null,this.plaWing3Pre=null,this.plaWing4Pre=null,this.plaWing5Pre=null,this.plaWing6Pre=null,this.plaRob1Pre=null,this.plaRob2Pre=null,this.plaRob3Pre=null,this.plaBul1Pre=this.getRes(u.battle.Player1Bullet),this.plaBulPre=this.getRes(u.battle.PlayerLaser),this.skill1Pre=this.getRes(u.battle.PlayerSkill1),this.skill2Pre=this.getRes(u.battle.PlayerSkill2),this.skill3Pre=this.getRes(u.battle.PlayerSkill3),this.skill4Pre=this.getRes(u.battle.PlayerSkill4),this.skill5Pre=this.getRes(u.battle.PlayerSkill5),this.skill6Pre=this.getRes(u.battle.PlayerSkill6),this.skill7Pre=this.getRes(u.battle.PlayerSkill7),this.skill8Pre=this.getRes(u.battle.PlayerSkill8),this.skill9Pre=this.getRes(u.battle.PlayerSkill9),this.skill10Pre=this.getRes(u.battle.PlayerSkill10),this.plaWing1Pre=this.getRes(u.battle.PlayerWing1),this.plaWing2Pre=this.getRes(u.battle.PlayerWing2),this.plaWing3Pre=this.getRes(u.battle.PlayerWing3),this.plaWing4Pre=this.getRes(u.battle.PlayerWing4),this.plaWing5Pre=this.getRes(u.battle.PlayerWing5),this.plaWing6Pre=this.getRes(u.battle.PlayerWing6),this.plaRob1Pre=this.getRes(u.battle.PlayerRobot1),this.plaRob2Pre=this.getRes(u.battle.PlayerRobot2),this.plaRob3Pre=this.getRes(u.battle.PlayerRobot3)}onEnable(){this.ins=st.instance,L.on(T.PlayerBullet,this,this.playerMainBullet),L.on(T.BaseSkill1,this,this.baseSkill1),L.on(T.BaseSkill1a,this,this.baseSkill1),L.on(T.BaseSkill1b,this,this.baseSkill1),L.on(T.BaseSkill2,this,this.baseSkill2),L.on(T.BaseSkill2a,this,this.baseSkill2),L.on(T.BaseSkill2b,this,this.baseSkill2),L.on(T.BaseSkill3,this,this.baseSkill3),L.on(T.BaseSkill4,this,this.baseSkill4),L.on(T.BaseSkill4a,this,this.baseSkill4),L.on(T.BaseSkill4b,this,this.baseSkill4),L.on(T.BaseSkill5,this,this.baseSkill5),L.on(T.BaseSkill5a,this,this.baseSkill5),L.on(T.BaseSkill5b,this,this.baseSkill5),L.on(T.BaseSkill6,this,this.baseSkill6),L.on(T.BaseSkill6a,this,this.baseSkill6),L.on(T.BaseSkill6b,this,this.baseSkill6),L.on(T.BaseSkill7,this,this.baseSkill7),L.on(T.BaseSkill9,this,this.baseSkill9),L.on(T.BaseSkill11,this,this.baseSkill11),L.on(T.BaseSkill13,this,this.baseSkill13),L.on(T.BaseSkill14,this,this.baseSkill14),L.on(T.BaseSkill15,this,this.baseSkill15),L.on(T.Shield,this,this.shield),L.on(T.TimeShield,this,this.timeShield),L.on(T.DieShot,this,this.dieShot),L.on(T.SuckBlood,this,this.suckBlood),L.on(T.DieBoom,this,this.dieBoom),L.on(T.BulSkill1,this,this.skill),L.on(T.BulSkill2,this,this.skill2),L.on(T.BulSkill3,this,this.skill3),L.on(T.BulSkill4,this,this.skill4),L.on(T.BulSkill5,this,this.skill5),L.on(T.BulSkill6,this,this.skill6),L.on(T.BulSkill7,this,this.skill7),L.on(T.BulSkill8,this,this.skill8),L.on(T.BulSkill9,this,this.skill9),L.on(T.BulSkill10,this,this.skill10),L.on(T.WingSkill1,this,this.wing1),L.on(T.WingSkill2,this,this.wing2),L.on(T.WingSkill3,this,this.wing3),L.on(T.WingSkill4,this,this.wing4),L.on(T.WingSkill5,this,this.wing5),L.on(T.WingSkill6,this,this.wing6),L.on(T.RobSkill1,this,this.robot1),L.on(T.RobSkill2,this,this.robot2),L.on(T.RobSkill3,this,this.robot3),L.on(T.Sup_HP,this,this.supSkill1),L.on(T.Sup_Att,this,this.supSkill2),L.on(T.Sup_HPRec1,this,this.supSkill3),L.on(T.Sup_HPRec2,this,this.supSkill4),L.on(T.Sup_Crit,this,this.supSkill5)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}playerMainBullet(t){switch(t){case 1:this.player1Bullet();break;case 2:this.player2Bullet()}}player1Bullet(){const t=1e3*this.ins.playerData.speed;Laya.timer.clear(this,this.player1BulletCall),Laya.timer.loop(t,this,this.player1BulletCall)}player1BulletCall(){const t=this.ins,e=t.playerV2;if(t.gameState!=E.START)return;const s=t.playerData;let i=1,l=s.mainNum*s.planeData.weapon,a=V[s.id][s.mainNum];l&&(i+=l);for(let l=0;l<i;l++){const n=this.open(u.battle.Player1Bullet,this.plaBul1Pre);n.getChildByName("boom").blendMode=Laya.BlendMode.LIGHTER;let o=n.getComponent(B);o||(o=n.addComponent(B));let r=s.attack*s.planeData.att/i;o.setData(Math.floor(r),s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);let h=n.getComponent(dt);h||(h=n.addComponent(dt)),h.norV3=this.getVec3(0,-1),h.state=E.START,h.tar=null,h.speed=s.fspeed,h.cross=s.cross,s.track&&(h.cross=!1,h.tar=t.getMinEnemy(e)),n.pos(e.x+a[l],e.y-30),this.ins.player2Node.addChild(n)}}player2Bullet(){const t=this.ins,e=t.playerData,s=this.open(u.battle.PlayerLaser,this.plaBulPre);let i=s.getComponent(B);i||(i=s.addComponent(B));let l=e.attack*e.planeData.att/(e.mainNum+1)/9;i.setData(Math.floor(l),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),s.pos(360,900),t.playerNode.addChild(s),t.plaLassV2.push(s)}baseSkill1(){const t=st.instance.playerData;let e=c.skills[x.HP1].value+1;t.hp=Math.floor(t.hp*e),t.currHP=Math.floor(t.currHP*e),t.setSkill2(x.HP1),L.event(T.PlayerMaxHP)}supSkill1(){const t=st.instance.playerData;let e=c.skills[x.Sup_HP].value+1;t.hp=Math.floor(t.hp*e),t.currHP=Math.floor(t.currHP*e),L.event(T.PlayerMaxHP)}baseSkill2(){const t=st.instance.playerData;let e=c.skills[x.Attack1].value+1;t.attack*=e,t.attack=Math.floor(t.attack),t.setSkill2(x.Attack1)}supSkill2(){const t=st.instance.playerData;let e=c.skills[x.Sup_Att].value+1;t.attack*=e,t.attack=Math.floor(t.attack)}baseSkill3(){const t=st.instance.playerData;let e=c.skills[x.HPRec1].value||.1,s=Math.floor(t.hp*e);t.currHP+s>t.hp?t.currHP=t.hp:t.currHP+=s,t.setSkill(x.HPRec1),L.event(T.PlayerHP)}supSkill3(){const t=st.instance.playerData;let e=c.skills[x.Sup_HPRec1].value||.1,s=Math.floor(t.hp*e);t.currHP+s>t.hp?t.currHP=t.hp:t.currHP+=s,L.event(T.PlayerHP)}supSkill4(){const t=st.instance.playerData;let e=c.skills[x.Sup_HPRec2].value||.1,s=Math.floor(t.hp*e);t.currHP+s>t.hp?t.currHP=t.hp:t.currHP+=s,L.event(T.PlayerHP)}baseSkill4(){const t=st.instance,e=t.playerData;let s=c.skills[x.Speed].value+1;if(e.speed/=s,e.setSkill2(x.Speed),1==e.id&&this.playerMainBullet(e.id),2==e.id){let s=t.plaLassV2.length,i=t.playerPosV2;for(let e=0;e<t.plaLassV2.length;e++){t.plaLassV2[e].removeSelf()}t.plaLassV2.length=0;let l=V[2][s-1];for(let a=0;a<s;a++){const s=this.open(u.battle.PlayerLaser,this.plaBulPre);let n=s.getComponent(B);n||(n=s.addComponent(B));let o=e.attack*e.planeData.att/(e.mainNum+1)/9;n.setData(Math.floor(o),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),s.getComponent(it).deltaX=l[a],s.pos(i.x+l[a],i.y),t.playerNode.addChild(s),t.plaLassV2.push(s)}}}baseSkill5(){const t=st.instance.playerData;let e=c.skills[x.Crit].value+1;t.crit*=e,t.critHurt*=e,t.setSkill2(x.Crit)}supSkill5(){const t=st.instance.playerData;let e=c.skills[x.Sup_Crit].value+1;t.crit*=e,t.critHurt*=e}baseSkill6(){const t=st.instance,e=t.playerData;switch(e.mainNum++,e.attack*=1.4,e.attack=Math.floor(e.attack),e.id){case 1:break;case 2:let s=t.plaLassV2.length;if(s>=4)return;let i=t.playerPosV2;for(let e=0;e<t.plaLassV2.length;e++){t.plaLassV2[e].removeSelf()}t.plaLassV2.length=0;let l=V[2][s];for(let a=0;a<s+1;a++){const s=this.open(u.battle.PlayerLaser,this.plaBulPre);let n=s.getComponent(B);n||(n=s.addComponent(B));let o=e.attack*e.planeData.att/(e.mainNum+1)/9;n.setData(Math.floor(o),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),s.getComponent(it).deltaX=l[a],s.pos(i.x+l[a],i.y),t.playerNode.addChild(s),t.plaLassV2.push(s)}}e.setSkill2(x.MainStr)}baseSkill7(){const t=st.instance,e=t.playerData;switch(t.playerData.id){case 1:t.playerData.cross=!0;break;case 2:t.playerData.laserSta||(t.playerData.laserSta=1,L.event(T.LaserCross))}e.setSkill(x.MainCross)}baseSkill9(){const t=st.instance,e=t.playerData;switch(t.playerData.id){case 1:t.playerData.track=!0;break;case 2:2!=t.playerData.laserSta&&(t.playerData.laserSta=2,L.event(T.LaserTrack))}e.setSkill(x.MainTrack)}shield(){const t=this.ins.playerV2,e=[this.getVec3(1,0),this.getVec3(-1,0)],s=this.getRes(u.battle.PlayerShield),i=c.skills[x.Shield];Laya.timer.once(1e3*i.speed,this,()=>{for(let l=0;l<2;l++){const a=this.open(u.battle.PlayerShield,s),n=a.getComponent(at);n.norV3=e[l].clone(),n.angle=l*Math.PI,n.speed=i.fspeed,a.rotation=-180-n.angle/Math.PI*180,a.pos(t.x+100*e[l].x,t.y+100*e[l].y),this.ins.playerNode.addChild(a)}}),this.ins.playerData.setSkill(x.Shield)}timeShield(){const t=this.getRes(u.battle.PlayerTimeShield),e=this.open(u.battle.PlayerTimeShield,t);let s=this.ins.playerV2;e.pos(s.x,s.y),this.ins.playerNode.addChild(e),this.ins.playerData.setSkill(x.TimeShield)}dieShot(){st.instance.playerData.setSkill(x.DieShot)}baseSkill11(){st.instance.playerData.setSkill(x.Back)}baseSkill13(){const t=st.instance,e=t.playerData;c.skills[x.Anger].value;let s=e.hp/e.currHP;s>1.5&&(s=1.5),e.attack*=s,e.attack=Math.floor(e.attack),t.playerData.setSkill(x.Anger)}baseSkill14(){st.instance.playerData.setSkill(x.Cri)}baseSkill15(){const t=st.instance.playerData;let e=t.hp/t.currHP;e>1.5&&(e=1.5),t.crit*=e,t.critHurt*=e,t.setSkill(x.Fearless)}suckBlood(){st.instance.playerData.setSkill(x.SuckBlood)}dieBoom(){st.instance.playerData.setSkill(x.DieBoom)}skill(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(.71,-.71),this.getVec3(1,0),this.getVec3(.71,.71),this.getVec3(0,1),this.getVec3(-.71,.71),this.getVec3(-1,0),this.getVec3(-.71,-.71)],i=c.skills[x.SwimShell];Laya.timer.loop(1e3*i.speed,this,()=>{if(this.ins.gameState==E.START)for(let l=0;l<8;l++){const a=this.open(u.battle.PlayerSkill1,this.skill1Pre);let n=a.getComponent(B);n||(n=a.addComponent(B));const o=c.skills[x.SwimShell].value||1;n.setData(Math.floor(e.attack*o),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=a.getComponent(N);a.__type__="fyp",r.speed=i.fspeed,r.norV3=s[l].clone(),r.state=E.READY,r.tar=null,a.pos(t.x,t.y),this.ins.player2Node.addChild(a),Laya.Tween.to(a,{x:t.x+150*s[l].x,y:t.y+150*s[l].y},100,null,Laya.Handler.create(this,()=>{const t=this.ins.getMinEnemy(a);r.tar=t,7==l&&Laya.timer.once(500,this,()=>{L.event(T.BulSkill1_Start)})}))}}),this.ins.playerData.setSkill(x.SwimShell)}skill2(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(-.53,-.85),this.getVec3(-.41,-.91),this.getVec3(-.28,-.96),this.getVec3(-.14,-.99),this.getVec3(0,-1),this.getVec3(.14,-.99),this.getVec3(.28,-.96),this.getVec3(.41,-.91),this.getVec3(.53,-.85)],i=[.8,.8,.9,.9,1,.9,.9,.8,.8],l=c.skills[x.ShockWave];Laya.timer.loop(1e3*l.speed,this,()=>{if(this.ins.gameState==E.START)for(let a=0;a<9;a++){const n=this.open(u.battle.PlayerSkill2,this.skill2Pre);n.alpha=i[a];let o=n.getComponent(B);o||(o=n.addComponent(B));const r=c.skills[x.ShockWave].value||1;o.setData(Math.floor(e.attack*r),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const h=n.getComponent(nt);h.speed=l.fspeed,h.norV3=s[a].clone(),n.pos(t.x+100*s[a].x,t.y+100*s[a].y),this.ins.player2Node.addChild(n)}}),this.ins.playerData.setSkill(x.ShockWave)}skill3(){const t=this.ins.playerData,e=this.open(u.battle.PlayerSkill3,this.skill3Pre);let s=e.getComponent(B);s||(s=e.addComponent(B));const i=c.skills[x.Laser].value||1;s.setData(t.attack*i,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr);let l=this.ins.playerV2;e.pos(l.x,l.y),this.ins.playerNode.addChild(e),this.ins.playerData.setSkill(x.Laser)}skill4(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(.1,-.99),this.getVec3(-.1,-.99),this.getVec3(.31,-.95),this.getVec3(-.31,-.95),this.getVec3(.5,-.87),this.getVec3(-.5,-.87)],i=c.skills[x.Shotgun];Laya.timer.loop(1e3*i.speed,this,()=>{this.ins.gameState==E.START&&this.schedule(200,()=>{for(let l=0;l<6;l++){const a=this.open(u.battle.PlayerSkill4,this.skill4Pre);let n=a.getComponent(B);n||(n=a.addComponent(B));const o=c.skills[x.Shotgun].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=a.getComponent(ot);r.speed=i.fspeed,r.norV3=s[l].clone(),a.pos(t.x,t.y-30),this.ins.player2Node.addChild(a)}},this,3)}),this.ins.playerData.setSkill(x.Shotgun)}skill5(){const t=this.ins.playerV2,e=this.ins.playerData,s=c.skills[x.RainbowMissile];Laya.timer.loop(1e3*s.speed,this,()=>{if(this.ins.gameState!=E.START)return;let i=Math.floor(2*Math.random()+3),l=[];l.push(Math.floor(26*Math.random()+20)/180*Math.PI),l.push(Math.floor(91*Math.random()+45)/180*Math.PI),4==i&&l.push(Math.floor(91*Math.random()+45)/180*Math.PI),l.push(Math.floor(26*Math.random()+135)/180*Math.PI);let a=0;this.schedule(500,()=>{const i=this.open(u.battle.PlayerSkill5,this.skill5Pre);let n=i.getComponent(B);n||(n=i.addComponent(B));const o=c.skills[x.RainbowMissile].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=i.getComponent(rt);i.pos(t.x,t.y),r.speed=s.fspeed,r.pangle=l[a],r.tar=null,this.ins.player2Node.addChild(i),Laya.timer.once(500,this,()=>{const t=this.ins.getMinEnemy(i);r.tar=t}),a++},this,i)}),this.ins.playerData.setSkill(x.RainbowMissile)}skill6(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(1,0),this.getVec3(-1,0)],i=c.skills[x.RotatePoison];Laya.timer.once(1e3*i.speed,this,()=>{for(let l=0;l<2;l++){const a=this.open(u.battle.PlayerSkill6,this.skill6Pre);let n=a.getComponent(B);n||(n=a.addComponent(B));const o=c.skills[x.RotatePoison].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=a.getComponent(ht);r.speed=i.fspeed,r.norV3=s[l].clone(),r.angle=l*Math.PI,r.type=_.POISON,a.pos(t.x+200*s[l].x,t.y+200*s[l].y),this.ins.playerNode.addChild(a)}}),this.ins.playerData.setSkill(x.RotatePoison)}skill7(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(-.71,-.71),this.getVec3(.71,-.71)],i=c.skills[x.NaughtyGhost];Laya.timer.loop(1e3*i.speed,this,()=>{if(this.ins.gameState==E.START)for(let l=0;l<3;l++){const a=this.open(u.battle.PlayerSkill7,this.skill7Pre);let n=a.getComponent(B);n||(n=a.addComponent(B));const o=c.skills[x.NaughtyGhost].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=a.getComponent(ct);r.speed=i.fspeed,r.norV3=s[l].clone(),a.pos(t.x,t.y),this.ins.player2Node.addChild(a),L.event(T.BulSkill7_Start)}}),this.ins.playerData.setSkill(x.NaughtyGhost)}skill8(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(1,0),this.getVec3(-1,0)],i=c.skills[x.RotateFire];Laya.timer.once(1e3*i.speed,this,()=>{for(let l=0;l<2;l++){const a=this.open(u.battle.PlayerSkill8,this.skill8Pre);let n=a.getComponent(B);n||(n=a.addComponent(B));const o=c.skills[x.RotateFire].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=a.getComponent(ht);r.speed=i.fspeed,r.norV3=s[l].clone(),r.angle=l*Math.PI,r.type=_.FIRE,a.pos(t.x+200*s[l].x,t.y+200*s[l].y),this.ins.playerNode.addChild(a)}}),this.ins.playerData.setSkill(x.RotateFire)}skill9(){const t=this.ins.playerData,e=this.open(u.battle.PlayerSkill9,this.skill9Pre);let s=e.getComponent(B);s||(s=e.addComponent(B));const i=c.skills[x.Magnet].value||1;s.setData(t.attack*i,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr);let l=this.ins.playerV2;e.pos(l.x,l.y),this.ins.bgTopNode.addChild(e),this.ins.playerData.setSkill(x.Magnet)}skill10(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(1,0),this.getVec3(-1,0)],i=c.skills[x.RotateIce];Laya.timer.once(1e3*i.speed,this,()=>{for(let l=0;l<2;l++){const a=this.open(u.battle.PlayerSkill10,this.skill10Pre);let n=a.getComponent(B);n||(n=a.addComponent(B));const o=c.skills[x.RotateIce].value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=a.getComponent(ht);r.speed=i.fspeed,r.norV3=s[l].clone(),r.angle=l*Math.PI,r.type=_.ICE,a.pos(t.x+200*s[l].x,t.y+200*s[l].y),this.ins.playerNode.addChild(a)}}),this.ins.playerData.setSkill(x.RotateIce)}wing1(){const t=this.ins;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=D[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing1,this.plaWing1Pre),a=l.getComponent(pt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(x.BlastWing)}wing2(){const t=st.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=D[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing2,this.plaWing2Pre),a=l.getComponent(pt),n=l.getComponent(ut);a.deltaX=i[e].dx,a.deltaY=i[e].dy,n.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(x.MissileWing)}wing3(){const t=st.instance;let e=t.plaWingsV2.length;if(e>=6)return;let s=t.playerV2,i=D[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing3,this.plaWing3Pre),a=l.getComponent(pt),n=l.getComponent(ft);a.deltaX=i[e].dx,a.deltaY=i[e].dy,n.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(x.LaserWing)}wing4(){const t=st.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=D[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing4,this.plaWing4Pre),a=l.getComponent(pt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(x.AutoWing)}wing5(){const t=st.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=D[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing5,this.plaWing5Pre),a=l.getComponent(pt),n=l.getComponent(bt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,n.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(x.ShotWing)}wing6(){const t=st.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=D[e/2];for(let e=0;e<2;e++){const l=this.open(u.battle.PlayerWing6,this.plaWing6Pre),a=l.getComponent(pt);l.getComponent(Ct);a.deltaX=i[e].dx,a.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(x.ShieldWing)}robot1(){const t=c.skills[x.BlastRobot],e=t.speed||5,s=t.robotsp||.2;Laya.timer.loop(1e3*e,this,()=>{if(this.ins.gameState!=E.START)return;const t=this.open(u.battle.PlayerRobot1,this.plaRob1Pre),e=t.getComponent(lt);e.norV3=this.getVec3(0,-1),e.speed=s,t.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(t)}),this.ins.playerData.setSkill(x.BlastRobot)}robot2(){const t=c.skills[x.ShieldRobot],e=t.speed||5,s=t.robotsp||.2;Laya.timer.loop(1e3*e,this,()=>{if(this.ins.gameState!=E.START)return;const t=this.open(u.battle.PlayerRobot2,this.plaRob2Pre),e=t.getComponent(lt);e.norV3=this.getVec3(0,-1),e.speed=s,t.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(t)}),this.ins.playerData.setSkill(x.ShieldRobot)}robot3(){const t=c.skills[x.LaserRobot],e=this.ins.playerData,s=t.speed||5,i=t.robotsp||.2;Laya.timer.loop(1e3*s,this,()=>{if(this.ins.gameState!=E.START)return;const s=this.open(u.battle.PlayerRobot3,this.plaRob3Pre);let l=s.getComponent(B);l||(l=s.addComponent(B));const a=t.value||1;l.setData(e.attack*a,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const n=s.getComponent(lt);n.norV3=this.getVec3(0,-1),n.speed=i,s.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(s)}),this.ins.playerData.setSkill(x.LaserRobot)}}var kt='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n#include "Lighting.glsl";\r\n#include "LayaUtile.glsl"\r\n#include "Shadow.glsl";\r\n\r\n\r\nattribute vec4 a_Position;\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_MvpMatrix;\r\n#else\r\n\tuniform mat4 u_MvpMatrix;\r\n#endif\r\n\r\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\r\n\tattribute vec2 a_Texcoord0;\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#if defined(LIGHTMAP)&&defined(UV1)\r\n\tattribute vec2 a_Texcoord1;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tuniform vec4 u_LightmapScaleOffset;\r\n\tvarying vec2 v_LightMapUV;\r\n#endif\r\n\r\n#ifdef COLOR\r\n\tattribute vec4 a_Color;\r\n\tvarying vec4 v_Color;\r\n#endif\r\n\r\n#ifdef BONE\r\n\tconst int c_MaxBoneCount = 24;\r\n\tattribute vec4 a_BoneIndices;\r\n\tattribute vec4 a_BoneWeights;\r\n\tuniform mat4 u_Bones[c_MaxBoneCount];\r\n#endif\r\n\r\nattribute vec3 a_Normal;\r\nvarying vec3 v_Normal; \r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\tuniform vec3 u_CameraPos;\r\n\tvarying vec3 v_ViewDir; \r\n#endif\r\n\r\n#if defined(NORMALMAP)\r\n\tattribute vec4 a_Tangent0;\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n#endif\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_WorldMat;\r\n#else\r\n\tuniform mat4 u_WorldMat;\r\n#endif\r\n\r\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\n#ifdef TILINGOFFSET\r\n\tuniform vec4 u_TilingOffset;\r\n#endif\r\n\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec4 position;\r\n\t#ifdef BONE\r\n\t\tmat4 skinTransform;\r\n\t \t#ifdef SIMPLEBONE\r\n\t\t\tfloat currentPixelPos;\r\n\t\t\t#ifdef GPU_INSTANCE\r\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\r\n\t\t\t#else\r\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\r\n\t\t\t#endif\r\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\r\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\r\n\t\t#else\r\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\r\n\t\t#endif\r\n\t\tposition=skinTransform*a_Position;\r\n\t #else\r\n\t\tposition=a_Position;\r\n\t#endif\r\n\r\n\t#ifdef GPU_INSTANCE\r\n\t\tgl_Position = a_MvpMatrix * position;\r\n\t#else\r\n\t\tgl_Position = u_MvpMatrix * position;\r\n\t#endif\r\n\t\r\n\tmat4 worldMat;\r\n\t#ifdef GPU_INSTANCE\r\n\t\tworldMat = a_WorldMat;\r\n\t#else\r\n\t\tworldMat = u_WorldMat;\r\n\t#endif\r\n\r\n\tmat3 worldInvMat;\r\n\t#ifdef BONE\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat*skinTransform));\r\n\t#else\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat));\r\n\t#endif  \r\n\tv_Normal=normalize(a_Normal*worldInvMat);\r\n\t#if defined(NORMALMAP)\r\n\t\tv_Tangent=normalize(a_Tangent0.xyz*worldInvMat);\r\n\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\r\n\t#endif\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\t\tvec3 positionWS=(worldMat*position).xyz;\r\n\t\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tv_ViewDir = u_CameraPos-positionWS;\r\n\t\t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\t\t\tv_PositionWorld = positionWS;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\r\n\t\t#ifdef TILINGOFFSET\r\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\r\n\t\t#else\r\n\t\t\tv_Texcoord0=a_Texcoord0;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#ifdef LIGHTMAP\r\n\t\t#ifdef UV1\r\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\r\n\t\t#else\r\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\r\n\t\t#endif \r\n\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\r\n\t#endif\r\n\r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tv_Color=a_Color;\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\t\tv_ShadowCoord =getShadowCoord(vec4(positionWS,1.0));\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\tv_SpotShadowCoord = u_SpotViewProjectMatrix*vec4(positionWS,1.0);\r\n\t#endif\r\n\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}',Et='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n\r\n#include "Lighting.glsl";\r\n#include "Shadow.glsl"\r\n\r\nuniform sampler2D u_NoiseTex;\r\nuniform float u_Time;\r\nuniform vec4 u_DiffuseColor;\r\n\r\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\tvarying vec4 v_Color;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n\tuniform float u_AlphaTestValue;\r\n#endif\r\n\r\n#ifdef DIFFUSEMAP\r\n\tuniform sampler2D u_DiffuseTexture;\r\n#endif\r\n\r\n\r\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tvarying vec2 v_LightMapUV;\r\n\tuniform sampler2D u_LightMap;\r\n#endif\r\n\r\nvarying vec3 v_Normal;\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\tvarying vec3 v_ViewDir; \r\n\r\n\tuniform vec3 u_MaterialSpecular;\r\n\tuniform float u_Shininess;\r\n\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tuniform DirectionLight u_DirectionLight;\r\n\t\t#endif\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tuniform PointLight u_PointLight;\r\n\t\t#endif\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tuniform SpotLight u_SpotLight;\r\n\t\t#endif\r\n\t#else\r\n\t\tuniform mat4 u_View;\r\n\t\tuniform vec4 u_ProjectionParams;\r\n\t\tuniform vec4 u_Viewport;\r\n\t\tuniform int u_DirationLightCount;\r\n\t\tuniform sampler2D u_LightBuffer;\r\n\t\tuniform sampler2D u_LightClusterBuffer;\r\n\t#endif\r\n\r\n\t#ifdef SPECULARMAP \r\n\t\tuniform sampler2D u_SpecularTexture;\r\n\t#endif\r\n#endif\r\n\r\n#ifdef NORMALMAP \r\n\tuniform sampler2D u_NormalTexture;\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n#endif\r\n\r\n#ifdef FOG\r\n\tuniform float u_FogStart;\r\n\tuniform float u_FogRange;\r\n\tuniform vec3 u_FogColor;\r\n#endif\r\n\r\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n\r\n#include "GlobalIllumination.glsl";//"GlobalIllumination.glsl use uniform should at front of this\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec3 normal;//light and SH maybe use normal\r\n\t#if defined(NORMALMAP)\r\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\r\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\r\n\t#else\r\n\t\tnormal = normalize(v_Normal);\r\n\t#endif\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tvec3 viewDir= normalize(v_ViewDir);\r\n\t#endif\r\n\r\n\tLayaGIInput giInput;\r\n\t#ifdef LIGHTMAP\t\r\n\t\tgiInput.lightmapUV=v_LightMapUV;\r\n\t#endif\r\n\tvec3 globalDiffuse=layaGIBase(giInput,1.0,normal);\r\n\t\r\n\tvec4 mainColor=u_DiffuseColor;\r\n\t#ifdef DIFFUSEMAP\r\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\r\n\t\tmainColor=mainColor*difTexColor;\r\n\t#endif \r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tmainColor=mainColor*v_Color;\r\n\t#endif \r\n    \r\n\t#ifdef ALPHATEST\r\n\t\tif(mainColor.a<u_AlphaTestValue)\r\n\t\t\tdiscard;\r\n\t#endif\r\n  \r\n\t\r\n\tvec3 diffuse = vec3(0.0);\r\n\tvec3 specular= vec3(0.0);\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tvec3 dif,spe;\r\n\t\t#ifdef SPECULARMAP\r\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\r\n\t\t#else\r\n\t\t\t#ifdef DIFFUSEMAP\r\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\r\n\t\t\t#else\r\n\t\t\t\tvec3 gloss=vec3(1.0);\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t\r\n\t\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\r\n\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t#else\r\n\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t#endif\r\n\t\t\t\tfloat shadowAttenuation=sampleShadowmap(shadowCoord);\r\n\t\t\t\tdif *= shadowAttenuation;\r\n\t\t\t\tspe *= shadowAttenuation;\r\n\t\t\t#endif\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\r\n\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\tfloat spotShadowAttenuation = sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t\tdif *= spotShadowAttenuation;\r\n\t\t\t\tspe *= spotShadowAttenuation;\r\n\t\t\t#endif\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t#else\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t{\r\n\t\t\t\tif(i >= u_DirationLightCount)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\r\n\t\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t\t\t#else\r\n\t\t\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t\t\t#endif\r\n\t\t\t\t\t\tdirectionLight.color *= sampleShadowmap(shadowCoord);\r\n\t\t\t\t\t}\r\n\t\t\t\t#endif\r\n\t\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,directionLight,dif,spe);\r\n\t\t\t\tdiffuse+=dif;\r\n\t\t\t\tspecular+=spe;\r\n\t\t\t}\r\n\t\t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\r\n\t\t\t#ifdef POINTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,pointLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t\t#ifdef SPOTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\t\t\t\tspotLight.color *= sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t#endif\r\n\t\t\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,spotLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n\r\n\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tgl_FragColor.rgb+=specular;\r\n\t#endif\r\n\t  \r\n\t#ifdef FOG\r\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\r\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\r\n\t#endif\r\n\r\n\tvec3 nor = texture2D(u_NoiseTex, vec2(v_Texcoord0.x - u_Time * 0.5, v_Texcoord0.y)).rgb;\r\n\tvec4 fra = gl_FragColor;\r\n\tgl_FragColor = vec4(nor.r + fra.r * 0.8, nor.g + fra.g * 0.8, nor.b + fra.b * 0.8, gl_FragColor.a);\r\n}\r\n\r\n';const _t=Laya.Shader3D,Tt=Laya.Material,Pt=Laya.RenderState;class xt extends Tt{constructor(){super(),this.NOISE_TEX=_t.propertyNameToID("u_NoiseTex"),this._enableVertexColor=!1,this.setShaderName("MYShaderMaterial"),this._albedoIntensity=1,this._albedoColor=new Laya.Vector4(1,1,1,1);var t=this._shaderValues;t.setVector(xt.ALBEDOCOLOR,new Laya.Vector4(1,1,1,1)),t.setVector(xt.MATERIALSPECULAR,new Laya.Vector4(1,1,1,1)),t.setNumber(xt.SHININESS,.078125),t.setNumber(Tt.ALPHATESTVALUE,.5),t.setVector(xt.TILINGOFFSET,new Laya.Vector4(1,1,0,0)),this._enableLighting=!0,this.renderMode=xt.RENDERMODE_OPAQUE}static __initDefine__(){xt.SHADERDEFINE_DIFFUSEMAP=_t.getDefineByName("DIFFUSEMAP"),xt.SHADERDEFINE_NORMALMAP=_t.getDefineByName("NORMALMAP"),xt.SHADERDEFINE_SPECULARMAP=_t.getDefineByName("SPECULARMAP"),xt.SHADERDEFINE_TILINGOFFSET=_t.getDefineByName("TILINGOFFSET"),xt.SHADERDEFINE_ENABLEVERTEXCOLOR=_t.getDefineByName("ENABLEVERTEXCOLOR")}get _ColorR(){return this._albedoColor.x}set _ColorR(t){this._albedoColor.x=t,this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(t){this._albedoColor.y=t,this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(t){this._albedoColor.z=t,this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(t){this._albedoColor.w=t,this.albedoColor=this._albedoColor}get _Color(){return this._shaderValues.getVector(xt.ALBEDOCOLOR)}set _Color(t){this.albedoColor=t}get _SpecColorR(){return this._shaderValues.getVector(xt.MATERIALSPECULAR).x}set _SpecColorR(t){this._shaderValues.getVector(xt.MATERIALSPECULAR).x=t}get _SpecColorG(){return this._shaderValues.getVector(xt.MATERIALSPECULAR).y}set _SpecColorG(t){this._shaderValues.getVector(xt.MATERIALSPECULAR).y=t}get _SpecColorB(){return this._shaderValues.getVector(xt.MATERIALSPECULAR).z}set _SpecColorB(t){this._shaderValues.getVector(xt.MATERIALSPECULAR).z=t}get _SpecColorA(){return this._shaderValues.getVector(xt.MATERIALSPECULAR).w}set _SpecColorA(t){this._shaderValues.getVector(xt.MATERIALSPECULAR).w=t}get _SpecColor(){return this._shaderValues.getVector(xt.MATERIALSPECULAR)}set _SpecColor(t){this.specularColor=t}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(xt.ALBEDOCOLOR);Laya.Vector4.scale(this._albedoColor,t,e),this._albedoIntensity=t,this._shaderValues.setVector(xt.ALBEDOCOLOR,e)}}get _Shininess(){return this._shaderValues.getNumber(xt.SHININESS)}set _Shininess(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(xt.SHININESS,t)}get _MainTex_STX(){return this._shaderValues.getVector(xt.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(xt.TILINGOFFSET);e.x=t,this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(xt.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(xt.TILINGOFFSET);e.y=t,this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(xt.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(xt.TILINGOFFSET);e.z=t,this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(xt.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(xt.TILINGOFFSET);e.w=t,this.tilingOffset=e}get _MainTex_ST(){return this._shaderValues.getVector(xt.TILINGOFFSET)}set _MainTex_ST(t){this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(t){this.alphaTestValue=t}set renderMode(t){switch(t){case xt.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=Tt.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=Pt.CULL_BACK,this.blend=Pt.BLEND_DISABLE,this.depthTest=Pt.DEPTHTEST_LESS;break;case xt.RENDERMODE_CUTOUT:this.renderQueue=Tt.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=Pt.CULL_BACK,this.blend=Pt.BLEND_DISABLE,this.depthTest=Pt.DEPTHTEST_LESS;break;case xt.RENDERMODE_TRANSPARENT:this.renderQueue=Tt.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=Pt.CULL_BACK,this.blend=Pt.BLEND_ENABLE_ALL,this.blendSrc=Pt.BLENDPARAM_SRC_ALPHA,this.blendDst=Pt.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=Pt.DEPTHTEST_LESS;break;default:throw new Error("Material:renderMode value error.")}}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(t){this._enableVertexColor=t,t?this._shaderValues.addDefine(xt.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine(xt.SHADERDEFINE_ENABLEVERTEXCOLOR)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(xt.TILINGOFFSET)}set tilingOffset(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._shaderValues.addDefine(xt.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(xt.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(xt.TILINGOFFSET,t)}get albedoColorR(){return this._ColorR}set albedoColorR(t){this._ColorR=t}get albedoColorG(){return this._ColorG}set albedoColorG(t){this._ColorG=t}get albedoColorB(){return this._ColorB}set albedoColorB(t){this._ColorB=t}get albedoColorA(){return this._ColorA}set albedoColorA(t){this._ColorA=t}get albedoColor(){return this._albedoColor}set albedoColor(t){var e=this._shaderValues.getVector(xt.ALBEDOCOLOR);Laya.Vector4.scale(t,this._albedoIntensity,e),this._albedoColor=t,this._shaderValues.setVector(xt.ALBEDOCOLOR,e)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(t){this._AlbedoIntensity=t}get specularColorR(){return this._SpecColorR}set specularColorR(t){this._SpecColorR=t}get specularColorG(){return this._SpecColorG}set specularColorG(t){this._SpecColorG=t}get specularColorB(){return this._SpecColorB}set specularColorB(t){this._SpecColorB=t}get specularColorA(){return this._SpecColorA}set specularColorA(t){this._SpecColorA=t}get specularColor(){return this._shaderValues.getVector(xt.MATERIALSPECULAR)}set specularColor(t){this._shaderValues.setVector(xt.MATERIALSPECULAR,t)}get shininess(){return this._Shininess}set shininess(t){this._Shininess=t}get albedoTexture(){return this._shaderValues.getTexture(xt.ALBEDOTEXTURE)}set albedoTexture(t){t?this._shaderValues.addDefine(xt.SHADERDEFINE_DIFFUSEMAP):this._shaderValues.removeDefine(xt.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(xt.ALBEDOTEXTURE,t)}get normalTexture(){return this._shaderValues.getTexture(xt.NORMALTEXTURE)}set normalTexture(t){t?this._shaderValues.addDefine(xt.SHADERDEFINE_NORMALMAP):this._shaderValues.removeDefine(xt.SHADERDEFINE_NORMALMAP),this._shaderValues.setTexture(xt.NORMALTEXTURE,t)}get specularTexture(){return this._shaderValues.getTexture(xt.SPECULARTEXTURE)}set specularTexture(t){t?this._shaderValues.addDefine(xt.SHADERDEFINE_SPECULARMAP):this._shaderValues.removeDefine(xt.SHADERDEFINE_SPECULARMAP),this._shaderValues.setTexture(xt.SPECULARTEXTURE,t)}get depthWrite(){return this._shaderValues.getBool(xt.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(xt.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(xt.CULL)}set cull(t){this._shaderValues.setInt(xt.CULL,t)}get blend(){return this._shaderValues.getInt(xt.BLEND)}set blend(t){this._shaderValues.setInt(xt.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(xt.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(xt.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(xt.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(xt.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(xt.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(xt.DEPTH_TEST,t)}static initShader(){const t=Laya.VertexMesh;var e={a_Position:t.MESH_POSITION0,a_Color:t.MESH_COLOR0,a_Normal:t.MESH_NORMAL0,a_Texcoord0:t.MESH_TEXTURECOORDINATE0,a_Texcoord1:t.MESH_TEXTURECOORDINATE1,a_BoneWeights:t.MESH_BLENDWEIGHT0,a_BoneIndices:t.MESH_BLENDINDICES0,a_Tangent0:t.MESH_TANGENT0,a_MvpMatrix:t.MESH_MVPMATRIX_ROW0,a_WorldMat:t.MESH_WORLDMATRIX_ROW0},s={u_Bones:_t.PERIOD_CUSTOM,u_DiffuseTexture:_t.PERIOD_MATERIAL,u_NoiseTex:_t.PERIOD_MATERIAL,u_SpecularTexture:_t.PERIOD_MATERIAL,u_NormalTexture:_t.PERIOD_MATERIAL,u_AlphaTestValue:_t.PERIOD_MATERIAL,u_DiffuseColor:_t.PERIOD_MATERIAL,u_MaterialSpecular:_t.PERIOD_MATERIAL,u_Shininess:_t.PERIOD_MATERIAL,u_WaterScale:_t.PERIOD_MATERIAL,u_TilingOffset:_t.PERIOD_MATERIAL,u_WorldMat:_t.PERIOD_SPRITE,u_MvpMatrix:_t.PERIOD_SPRITE,u_LightmapScaleOffset:_t.PERIOD_SPRITE,u_LightMap:_t.PERIOD_SPRITE,u_LightMapDirection:_t.PERIOD_SPRITE,u_SimpleAnimatorTexture:_t.PERIOD_SPRITE,u_SimpleAnimatorParams:_t.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:_t.PERIOD_SPRITE,u_CameraPos:_t.PERIOD_CAMERA,u_Viewport:_t.PERIOD_CAMERA,u_ProjectionParams:_t.PERIOD_CAMERA,u_View:_t.PERIOD_CAMERA,u_ViewProjection:_t.PERIOD_CAMERA,u_ReflectTexture:_t.PERIOD_SCENE,u_ReflectIntensity:_t.PERIOD_SCENE,u_FogStart:_t.PERIOD_SCENE,u_FogRange:_t.PERIOD_SCENE,u_FogColor:_t.PERIOD_SCENE,u_DirationLightCount:_t.PERIOD_SCENE,u_LightBuffer:_t.PERIOD_SCENE,u_LightClusterBuffer:_t.PERIOD_SCENE,u_AmbientColor:_t.PERIOD_SCENE,u_ShadowBias:_t.PERIOD_SCENE,u_ShadowLightDirection:_t.PERIOD_SCENE,u_ShadowMap:_t.PERIOD_SCENE,u_ShadowParams:_t.PERIOD_SCENE,u_ShadowSplitSpheres:_t.PERIOD_SCENE,u_ShadowMatrices:_t.PERIOD_SCENE,u_ShadowMapSize:_t.PERIOD_SCENE,u_SpotShadowMap:_t.PERIOD_SCENE,u_SpotViewProjectMatrix:_t.PERIOD_SCENE,u_ShadowLightPosition:_t.PERIOD_SCENE,u_AmbientSHAr:_t.PERIOD_SCENE,u_AmbientSHAg:_t.PERIOD_SCENE,u_AmbientSHAb:_t.PERIOD_SCENE,u_AmbientSHBr:_t.PERIOD_SCENE,u_AmbientSHBg:_t.PERIOD_SCENE,u_AmbientSHBb:_t.PERIOD_SCENE,u_AmbientSHC:_t.PERIOD_SCENE,"u_DirectionLight.color":_t.PERIOD_SCENE,"u_DirectionLight.direction":_t.PERIOD_SCENE,"u_PointLight.position":_t.PERIOD_SCENE,"u_PointLight.range":_t.PERIOD_SCENE,"u_PointLight.color":_t.PERIOD_SCENE,"u_SpotLight.position":_t.PERIOD_SCENE,"u_SpotLight.direction":_t.PERIOD_SCENE,"u_SpotLight.range":_t.PERIOD_SCENE,"u_SpotLight.spot":_t.PERIOD_SCENE,"u_SpotLight.color":_t.PERIOD_SCENE,u_Time:_t.PERIOD_SCENE},i={s_Cull:_t.RENDER_STATE_CULL,s_Blend:_t.RENDER_STATE_BLEND,s_BlendSrc:_t.RENDER_STATE_BLEND_SRC,s_BlendDst:_t.RENDER_STATE_BLEND_DST,s_DepthTest:_t.RENDER_STATE_DEPTH_TEST,s_DepthWrite:_t.RENDER_STATE_DEPTH_WRITE},l=_t.add("MYShaderMaterial",null,null,!0),a=new Laya.SubShader(e,s);l.addSubShader(a),a.addShaderPass(kt,Et,i)}clone(){var t=new xt;return this.cloneTo(t),t}cloneTo(t){super.cloneTo(t);var e=t;e._enableLighting=this._enableLighting,e._albedoIntensity=this._albedoIntensity,e._enableVertexColor=this._enableVertexColor,this._albedoColor.cloneTo(e._albedoColor)}set noiseTex(t){this._shaderValues.setTexture(this.NOISE_TEX,t)}}xt.RENDERMODE_OPAQUE=0,xt.RENDERMODE_CUTOUT=1,xt.RENDERMODE_TRANSPARENT=2,xt.ALBEDOTEXTURE=_t.propertyNameToID("u_DiffuseTexture"),xt.NORMALTEXTURE=_t.propertyNameToID("u_NormalTexture"),xt.SPECULARTEXTURE=_t.propertyNameToID("u_SpecularTexture"),xt.ALBEDOCOLOR=_t.propertyNameToID("u_DiffuseColor"),xt.MATERIALSPECULAR=_t.propertyNameToID("u_MaterialSpecular"),xt.SHININESS=_t.propertyNameToID("u_Shininess"),xt.TILINGOFFSET=_t.propertyNameToID("u_TilingOffset"),xt.CULL=_t.propertyNameToID("s_Cull"),xt.BLEND=_t.propertyNameToID("s_Blend"),xt.BLEND_SRC=_t.propertyNameToID("s_BlendSrc"),xt.BLEND_DST=_t.propertyNameToID("s_BlendDst"),xt.DEPTH_TEST=_t.propertyNameToID("s_DepthTest"),xt.DEPTH_WRITE=_t.propertyNameToID("s_DepthWrite");class Vt extends k{constructor(){super(),this.ins=null,this.playerPre=null,this.playerPre1=null,this.plaHPPre=null,this.playerMods={},this.playerPre=this.getRes(u.battle.Player),this.playerPre1=this.getRes(u.battle.Player1),this.plaHPPre=this.getRes(u.battle.PlayerHP);for(const t in b){const e=b[t];this.playerMods[t]=this.getRes(e)}}onEnable(){this.ins=st.instance,this.initPlayerModel()}initPlayerModel(){const t=this.ins,e=t.playerData.id;let s=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,1280),s);const i=Laya.Sprite3D.instantiate(this.playerMods[e]);i.transform.position=s,i.transform.localScale=this.getVec3(1.55,1.55,1.55);const l=new xt;l.albedoIntensity=1.4,l.shininess=.25;const a=i.getChildAt(0),n=this.getRes({1:"unity/plane1/Assets/Plane_3.jpg",2:"unity/plane2/Assets/Plane_2.jpg",3:"unity/plane3/Assets/Plane_1.jpg"}[e]);l.albedoTexture=n,Laya.Texture2D.load("res/lg.png",Laya.Handler.create(null,function(t){l.noiseTex=t,a.meshRenderer.material=l})),t.playerV3=i,t.modSceneV3.addChild(i);const o=this.getRes(g.PlaneTrackModel);o.transform.position=this.getVec3(0,0,.1),i.addChild(o);const r=this.open(u.battle.Player,this.playerPre);r.pos(360,1280),t.playerNode.addChild(r),t.playerV2=r,t.playerCols.push(r.getComponent(w));const h=this.open(u.battle.Player1,this.playerPre1);h.pos(360,1280),t.bgTopNode.addChild(h);const c=this.open(u.battle.PlayerHP,this.plaHPPre);c.pos(400,1240),t.effectNode.addChild(c),t.playerHPV2=c,t.modCameraV3.convertScreenCoordToOrthographicCoord(t.playerPosV2,s),t.playerPosV3=s,Laya.Tween.to(r,{y:t.playerPosV2.y},500,Laya.Ease.cubicOut),Laya.Tween.to(h,{y:t.playerPosV2.y},500,Laya.Ease.cubicOut),Laya.Tween.to(c,{y:t.playerPosV2.y-40},500,Laya.Ease.cubicOut),Laya.Tween.to(i.transform,{localPositionZ:s.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{t.gameState=E.START,L.event(T.LevelEnemy),L.event(T.PlayerBullet,e)}));let d=this.getVec3(),p=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,640),d),t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,641),p),t.ratio3D=1/(p.z-d.z)}onDisable(){}}class Dt extends k{constructor(){super(),this.qhBtn=null,this.gcBtn=null,this.zzBtn=null,this.fypBtn=null,this.cjbBtn=null,this.jgBtn=null,this.sdBtn=null,this.chddBtn=null,this.ddgBtn=null,this.xzdqBtn=null,this.xzhqBtn=null,this.cbdcBtn=null,this.xzbqBtn=null,this.sdljBtn=null,this.ddljBtn=null,this.jgljBtn=null,this.bpljBtn=null,this.hdljBtn=null,this.zzpljBtn=null,this.bpjqrBtn=null,this.hdjqrBtn=null,this.jgjqrBtn=null}onEnable(){this.setClick(this.qhBtn,this.baseSkill6.bind(this),this),this.setClick(this.gcBtn,this.baseSkill7.bind(this),this),this.setClick(this.zzBtn,this.baseSkill9.bind(this),this),this.setClick(this.fypBtn,this.skill1.bind(this),this),this.setClick(this.cjbBtn,this.skill2.bind(this),this),this.setClick(this.jgBtn,this.skill3.bind(this),this),this.setClick(this.sdBtn,this.skill4.bind(this),this),this.setClick(this.chddBtn,this.skill5.bind(this),this),this.setClick(this.xzdqBtn,this.skill6.bind(this),this),this.setClick(this.ddgBtn,this.skill7.bind(this),this),this.setClick(this.xzhqBtn,this.skill8.bind(this),this),this.setClick(this.cbdcBtn,this.skill9.bind(this),this),this.setClick(this.xzbqBtn,this.skill10.bind(this),this),this.setClick(this.sdljBtn,this.wing5.bind(this),this),this.setClick(this.ddljBtn,this.wing2.bind(this),this),this.setClick(this.jgljBtn,this.wing3.bind(this),this),this.setClick(this.bpljBtn,this.wing1.bind(this),this),this.setClick(this.hdljBtn,this.wing6.bind(this),this),this.setClick(this.zzpljBtn,this.wing4.bind(this),this),this.setClick(this.bpjqrBtn,this.robot1.bind(this),this),this.setClick(this.hdjqrBtn,this.robot2.bind(this),this),this.setClick(this.jgjqrBtn,this.robot3.bind(this),this),Laya.timer.once(1e4,this,()=>{this.owner.visible=!1})}baseSkill6(){L.event(T.BaseSkill6),L.event(T.TimeShield)}baseSkill7(){L.event(T.BaseSkill7)}baseSkill9(){L.event(T.BaseSkill9)}skill1(){L.event(T.BulSkill1)}skill2(){L.event(T.BulSkill2)}skill3(){L.event(T.BulSkill3)}skill4(){L.event(T.BulSkill4)}skill5(){L.event(T.BulSkill5)}skill6(){L.event(T.BulSkill6)}skill7(){L.event(T.BulSkill7)}skill8(){L.event(T.BulSkill8)}skill9(){L.event(T.BulSkill9)}skill10(){L.event(T.BulSkill10)}wing1(){L.event(T.WingSkill1)}wing2(){L.event(T.WingSkill2)}wing3(){L.event(T.WingSkill3)}wing4(){L.event(T.WingSkill4)}wing5(){L.event(T.WingSkill5)}wing6(){L.event(T.WingSkill6)}robot1(){L.event(T.RobSkill1)}robot2(){L.event(T.RobSkill2)}robot3(){L.event(T.RobSkill3)}onDisable(){}}var At,wt=Laya.Scene,Rt=Laya.ClassUtils.regClass;!function(t){class e extends wt{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("BattleScene")}}t.BattleSceneUI=e,Rt("ui.BattleSceneUI",e);class s extends wt{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("LobbyScene")}}t.LobbySceneUI=s,Rt("ui.LobbySceneUI",s)}(At||(At={}));class vt extends At.LobbySceneUI{constructor(){super(),vt.instance=this}onEnable(){}onDisable(){}}vt.instance=null;class It extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}}class Mt extends Laya.Script{constructor(){super(),this.interactable=!0,this.isChecked=!0,this.checkMark=null,this.clickHandle=null,this.cantHandle=null}onClick(){if(this.interactable){if(this.isChecked=!this.isChecked,this.checkMark&&(this.checkMark.visible=this.isChecked),this.clickHandle&&this.clickHandle(this.isChecked),this.owner&&this.owner.parent&&this.owner.parent.getComponent(It)){let t=this.owner.parent.numChildren,e=this.owner.parent.getChildIndex(this.owner);for(let s=0;s<t;s++){const t=this.owner.parent.getChildAt(s).getComponent(Mt);if(!t)return;s==e?t.isChecked||(t.isChecked=!0):t.isChecked=!1,t.checkMark&&(t.checkMark.visible=t.isChecked)}}}else this.cantHandle&&this.cantHandle()}onEnable(){this.checkMark&&(this.checkMark.visible=this.isChecked)}onDisable(){}}class Bt extends k{constructor(){super(),this.startBtn=null,this.chaHorSel=null,this.midNode=null,this.tabIndex=0}onEnable(){let t=!1;this.setClick(this.startBtn,()=>{t||(t=!0,this.loadBatPre().then(()=>{Laya.Scene.open("BattleScene.scene")}))},this),L.on(Ut.OpenPage,this,this.onOpen)}onDisable(){L.offAllCaller(this)}onOpen(t){const e=this.owner;t==this.tabIndex?(e.visible=!0,this.midNode.x=-360,Laya.Tween.to(this.midNode,{x:360},300)):e.visible=!1}loadBatPre(){const t=[],e=u.battle;for(const s in e){const i=e[s];t.push(i)}const s=[];for(const t in g){const e=g[t];this.getRes(e)||s.push(e)}return new Promise((e,i)=>{let l=0,a=0;s.length&&a++,t.length&&a++,Laya.loader.create(s,Laya.Handler.create(this,()=>{console.log("load model complete..."),++l==a&&e()}),Laya.Handler.create(this,t=>{})),Laya.loader.create(t,Laya.Handler.create(this,()=>{console.log("load prefab complete..."),++l==a&&e()}),Laya.Handler.create(this,t=>{}),Laya.Loader.PREFAB)})}onDestroy(){}}class Ht extends Laya.Image{constructor(){super(),this.size(203,143)}onEnable(){}onDisable(){}}const Nt={1:"lobby/planes/Plane1.png",2:"lobby/planes/Plane2.png",3:"lobby/planes/Plane3.png"};class Ot extends k{constructor(){super(),this.newNode=null,this.planeSpr=null,this.selNode=null,this.lockNode=null,this.pid=0,this.cid=1}onEnable(){this.setClick(this.owner,()=>{this.pid!=this.cid&&L.event(Ut.HangarItemSel,this.pid)},this,null,!0),L.on(Ut.HangarItemSel,this,t=>{this.selNode.visible=t==this.pid,this.cid=t})}setData(t,e){this.pid=t,this.cid=e,this.newNode.visible=!1,this.planeSpr.skin=Nt[t],this.selNode.visible=t==e;const s=d.planes.indexOf(t);this.lockNode.visible=s<0}onDisable(){L.offAllCaller(this)}}class Wt extends k{constructor(){super(),this.levLab=null,this.powLab=null,this.plaNameLab=null,this.propNode=null,this.attLab=null,this.hpLab=null,this.upLevelBtn=null,this.goldLab=null,this.chooseBtn=null,this.planeSpr=null,this.planeList=null,this.tabIndex=0,this.selid=0}onEnable(){let t=a.id;this.selid=t,this.setPlane(t),L.on(Ut.OpenPage,this,this.onOpen);const e=[1,2,3];this.planeList.itemRender=Ht,this.planeList.vScrollBarSkin="",this.planeList.renderHandler=Laya.Handler.create(this,(s,i)=>{const l=s.getChildAt(0);if(l){l.getComponent(Ot).setData(e[i],t)}else this.loadPrefab(u.lobby.HangarPlaneItem).then(l=>{const a=this.open(u.lobby.HangarPlaneItem,l);s.addChild(a),a.getComponent(Ot).setData(e[i],t)})},null,!1),this.planeList.array=e,L.on(Ut.HangarItemSel,this,t=>{this.selid=t,this.setPlane(t)}),this.setClick(this.upLevelBtn,()=>{if(d.level++,this.setPlane(this.selid),t==this.selid){const e=p.getAttHp(d.level,t);a.setAttHp(e.att,e.hp)}},this),this.setClick(this.chooseBtn,()=>{const t=p.getAttHp(d.level,this.selid);a.setAttHp(t.att,t.hp),a.id=this.selid,this.setPlane(this.selid)},this)}onDisable(){L.offAllCaller(this)}setPlane(t){const e=y.planes[t],s=y.planesUI[t],i=a.id,l=d.planes.indexOf(t);if(l<0)this.plaNameLab.text="???",this.powLab.text="???",this.attLab.text="???",this.hpLab.text="???",this.levLab.text="LV.???";else{this.plaNameLab.text=e.name,this.powLab.text="19.05M";let s=d.level||1;const i=p.getAttHp(s,t);this.attLab.text=i.att+"",this.hpLab.text=i.hp+"",this.goldLab.text=p.getGold(s)+"",this.levLab.text=`LV.${s}`}this.upLevelBtn.visible=l>-1,this.chooseBtn.visible=l>-1&&i!=t;let n=this.propNode.numChildren;for(let t=0;t<n;t++){const e=this.propNode.getChildAt(t),i=e.getChildAt(2);let l=s[t]/10,a=27+203*l;Laya.Tween.to(e,{value:l},200),Laya.Tween.to(i,{x:a},200)}L.event(Ut.HangarPage,[t,this.planeSpr])}onOpen(t){const e=this.owner;t==this.tabIndex?e.visible=!0:e.visible=!1}onDestroy(){}}var Ut;!function(t){t.OpenPage="lobby.openpage",t.HangarPage="lobby.hangar",t.HangarItemSel="lobby.hangar.item.sel"}(Ut||(Ut={}));class jt extends k{constructor(){super(),this.ins=null,this.scene3D=null,this.camera=null,this.battlePage=null,this.batTog=null,this.hangarPage=null,this.hanTog=null,this.planes3D={};const t=Laya.stage.addChild(new Laya.Scene3D);t.zOrder=-1,this.scene3D=t;const e=t.addChild(new Laya.Camera(0,.1,1e3));e.clearFlag=Laya.CameraClearFlags.DepthOnly,e.clearColor=new Laya.Vector4(0,0,0,0),e.transform.translate(this.getVec3(-1.8,2,2)),e.transform.rotate(new Laya.Vector3(-45,-45,0),!1,!1),this.camera=e,e.renderTarget=new Laya.RenderTexture(720,600,Laya.RenderTextureFormat.R16G16B16A16,Laya.RenderTextureDepthFormat.DEPTH_16),e.renderingOrder=-1,e.clearFlag=Laya.CameraClearFlags.SolidColor,e.clearColor=this.getVec4(0,0,0,0);const s=t.addChild(new Laya.DirectionLight);s.color=new Laya.Vector3(1,1,1),s.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0))}onEnable(){this.clearBattlePool(),this.ins=vt.instance,console.log("stage -> ",Laya.stage);const t=this.ins;this.loadPrefab(u.lobby.BattlePage).then(e=>{const s=this.open(u.lobby.BattlePage,e);t.content.addChild(s),this.battlePage=s.getComponent(Bt),this.battlePage.tabIndex=3}),this.loadPrefab(u.lobby.HangarPage).then(e=>{const s=this.open(u.lobby.HangarPage,e);s.visible=!1,t.content.addChild(s),this.hangarPage=s.getComponent(Wt),this.hangarPage.tabIndex=2}),this.batTog=t.batTog.getComponent(Mt),this.batTog.clickHandle=(()=>{this.battlePage&&(L.event(Ut.OpenPage,this.battlePage.tabIndex),this.clickAnim())}),this.hanTog=t.hanTog.getComponent(Mt),this.hanTog.clickHandle=(()=>{this.hangarPage&&(L.event(Ut.OpenPage,this.hangarPage.tabIndex),this.clickAnim())}),L.on(Ut.HangarPage,this,this.onHangarPage)}onDisable(){this.scene3D.destroy(!0),Laya.timer.clearAll(this),L.offAllCaller(this)}clickAnim(){const t=this.ins;t.bottom.y=1178+t.bottom.height,Laya.Tween.to(t.bottom,{y:1178},500,Laya.Ease.quadInOut),t.top.y=0-t.top.height,Laya.Tween.to(t.top,{y:0},500,Laya.Ease.quadInOut)}clearBattlePool(){for(let t=0;t<P.length;t++){const e=P[t];Laya.Pool.clearBySign(e)}P.length=0}onHangarPage(t,e){const s=this.planes3D;for(const t in s){s[t].active=!1}const i=s[t];if(e.graphics.clear(),i){i.active=!0;let t=new Laya.Texture(this.camera.renderTarget,Laya.Texture.DEF_UV);e.graphics.drawTexture(t)}else this.loadRes(g["PlaneModel"+t]).then(i=>{const l=Laya.Sprite3D.instantiate(i);l.transform.localScale=new Laya.Vector3(3.5,3.5,3.5),this.scene3D.addChild(l),Laya.timer.frameLoop(1,this,()=>{l.transform.rotate(this.getVec3(0,.005,0))}),s[t]=l;let a=new Laya.Texture(this.camera.renderTarget,Laya.Texture.DEF_UV);e.graphics.drawTexture(a)})}}class Gt extends k{constructor(){super()}onEnable(){const t=this.owner,e=t.getChildAt(0),s=t.getChildAt(1),i=Laya.LocalStorage.getItem("test_rate");i&&(e.text=i);const l=Laya.LocalStorage.getItem("test_chap");l&&(s.text=l);(t=>{const e=t.getChildAt(0),s=Laya.LocalStorage.getItem("test_php");s&&(e.text=s)})(t.getChildAt(3));(t=>{const e=t.getChildAt(0),s=t.getChildAt(1),i=t.getChildAt(2),l=t.getChildAt(3),a=Laya.LocalStorage.getItem("test_eid");a&&(e.text=a);const n=Laya.LocalStorage.getItem("test_ehp");n&&(s.text=n);const o=Laya.LocalStorage.getItem("test_eat");o&&(i.text=o);const r=Laya.LocalStorage.getItem("test_esp");r&&(l.text=r)})(t.getChildAt(2))}onDisable(){const t=this.owner;if(!t.visible)return;const e=t.getChildAt(0),s=t.getChildAt(1),l=parseInt(e.text),n=parseInt(s.text);l&&(a.rate=l,Laya.LocalStorage.setItem("test_rate",l+"")),n&&(a.chapter=n,Laya.LocalStorage.setItem("test_chap",n+""));(t=>{const e=t.getChildAt(0),s=parseInt(e.text);s&&(a.hp=s,Laya.LocalStorage.setItem("test_php",s+""))})(t.getChildAt(3));(t=>{const e=t.getChildAt(0),s=t.getChildAt(1),l=t.getChildAt(2),a=t.getChildAt(3),n=(t.getChildAt(4),t.getChildAt(5),t.getChildAt(6),t.getChildAt(7),t.getChildAt(8),parseInt(e.text)),o=parseInt(s.text),r=parseInt(l.text),c=parseFloat(a.text),d=i.enemys1,p=h.enemys;if(n&&o&&r&&c){p[n]&&(p[n].shooting=c);for(const t in d){const e=d[t];for(let t=0;t<e.length;t++){const s=e[t];s.type==n&&(s.hp=o,s.att=r)}}Laya.LocalStorage.setItem("test_eid",n+""),Laya.LocalStorage.setItem("test_ehp",o+""),Laya.LocalStorage.setItem("test_eat",r+""),Laya.LocalStorage.setItem("test_esp",c+"")}})(t.getChildAt(2))}}class Ft extends Laya.Script{constructor(){super(),this.speed=.1,this.bg1=null,this.bg2=null}onEnable(){}onDisable(){}onUpdate(){let t=Laya.timer.delta;if(this.bg1&&this.bg2){this.bg1.y>=1920&&(this.bg1.y=this.bg1.y-1920-640),this.bg2.y>=1920&&(this.bg2.y=this.bg2.y-1920-640);let e=t*this.speed;this.bg1.y+=e,this.bg2.y+=e}}}class qt extends Laya.Image{constructor(){super(),this.size(128,150),this.loadPrefab(u.battleUI.PlayerSkillItem).then(t=>{const e=Laya.Pool.getItemByCreateFun(u.battleUI.PlayerSkillItem,t.create,t);this.addChild(e)})}onEnable(){}onDisable(){}loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)})}}class Xt extends k{constructor(){super(),this.ins=st.instance,this.sucNode=null,this.failNode=null,this.levelLab=null,this.rewList=null,this.unLockNode=null,this.lockList=null,this.closeBtn=null,this.rewBtn=null}onEnable(){this.setClick(this.closeBtn,this.onCloseClick,this);const t=this.ins.playerData;let e=!!(t.currHP>0);this.sucNode.visible=e,this.rewBtn.visible=e,this.unLockNode.visible=e,this.failNode.visible=!e,this.levelLab.text=t.level+" ";if(e){const e=r.comChapters[t.chapter-1].unlockskill;this.lockList.itemRender=qt,this.lockList.hScrollBarSkin="",this.lockList.renderHandler=Laya.Handler.create(this,(t,s)=>{const i=t.getChildAt(0);if(!i)return;const l=i.getChildByName("desc"),a=(i.getChildByName("icon"),e[s]),n=c.skills[a];n&&(l.text=n.nameCN)},null,!1),this.lockList.array=e}else this.closeBtn.x=360}onCloseClick(){this.owner.removeSelf(),Laya.Scene.open("LobbyScene.scene")}onDisable(){}}class zt extends k{constructor(){super(),this.ins=st.instance,this.closeBtn=null,this.returnBtn=null,this.contBtn=null,this.currAtt=null,this.currHp=null,this.skills=null}onEnable(){this.setClick(this.closeBtn,this.onCloseClick,this),this.setClick(this.contBtn,this.onCloseClick,this),this.setClick(this.returnBtn,this.onReturnClick,this);const t=this.ins.playerData;this.currAtt.text=t.attack+" ",this.currHp.text=t.currHP+" ";const e=[];for(const s in t.skills)e.push(parseInt(s));this.skills.itemRender=qt,this.skills.vScrollBarSkin="",this.skills.renderHandler=Laya.Handler.create(this,(t,s)=>{const i=t.getChildAt(0);if(!i)return;const l=i.getChildByName("desc"),a=(i.getChildByName("icon"),e[s]),n=c.skills[a];n&&(l.text=n.nameCN)},null,!1),this.skills.array=e}onCloseClick(){Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{this.ins.gameState==E.PAUSE&&(this.ins.gameState=E.START),this.owner.removeSelf()}))}onReturnClick(){Laya.Scene.open("LobbyScene.scene")}onDisable(){}}class Yt extends k{constructor(){super(),this.lighter1=null,this.lighter2=null}onEnable(){for(let t=1;t<3;t++){const e=this["lighter"+t];e&&(e.blendMode=Laya.BlendMode.LIGHTER)}}onDisable(){}}class Qt extends k{constructor(){super()}onEnable(){const t=this.owner;t.alpha=1,Laya.timer.once(300,this,()=>{Laya.Tween.to(t,{alpha:0},100,null,Laya.Handler.create(this,()=>{this.owner.removeSelf()}))})}onDisable(){Laya.timer.clearAll(this),this.recover(this.owner)}}class Zt extends k{constructor(){super(),this.ins=st.instance,this.skin=null,this.speed=5}onEnable(){}onUpdate(){this.ins.gameState==E.START&&this.skin&&(this.skin.rotation+=this.speed)}}class $t extends k{constructor(){super(),this.ins=st.instance,this.enemyCom=null,this.eskillCom=null,this.skePath="",this.skeCon=null,this.templet=null,this.ske=null}onEnable(){if(this.enemyCom=this.owner.getComponent(z),this.eskillCom=this.owner.getComponent(q),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata,e=new Laya.Templet;this.templet=e,e.on(Laya.Event.COMPLETE,this,this.parseComplete),e.loadAni(m[this.skePath]),L.on(T.EnemyHit,this,(e,s,i)=>{s==this.enemyCom.eid&&e==t.type&&this.ske&&this.ske.play(0,!1)})}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop(),this.ske.removeSelf()),this.templet&&(this.templet.offAllCaller(this),this.templet.destroy())}parseComplete(){this.ske=this.templet.buildArmature(0);const t=this.ske,e=A[this.skePath];t.pos(e.self.x,e.self.y),t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t.play(1,!0),this.skeCon.addChild(t)}completeHandler(){this.ske.play(1,!0)}onEvent(t){this.ins.gameState,E.START}onUpdate(){}}class Jt extends k{constructor(){super(),this.ins=st.instance,this.enemyCom=null,this.eskillCom=null,this.ske=null}onEnable(){if(this.enemyCom=this.owner.getComponent(z),this.eskillCom=this.owner.getComponent(q),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata;Laya.timer.once(100,this,this.parseComplete),this.ske.on(Laya.Event.LABEL,this,this.onEvent),this.ske.on(Laya.Event.STOPPED,this,this.completeHandler),L.on(T.EnemyHit,this,(e,s,i)=>{s==this.enemyCom.eid&&e==t.type&&this.ske&&this.ske.templet&&this.ske.play(0,!1)})}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop())}parseComplete(){this.ske&&this.ske.templet&&this.ske.play(1,!0)}completeHandler(){this.ske&&this.ske.templet&&this.ske.play(1,!0)}onEvent(t){}onUpdate(){}}class Kt extends k{constructor(){super(),this.ins=st.instance,this.enemyCom=null,this.currSkill=null,this.eskillCom=null,this.skeCon=null,this.templet=null,this.ske=null,this.skill2001Pre=null,this.currAtt=0,this.currBsp=0,this.skill2001Pre=this.getRes(u.battle.EnemySkill2001)}onEnable(){if(this.enemyCom=this.owner.getComponent(z),this.eskillCom=this.owner.getComponent(q),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata,e=new Laya.Templet;this.templet=e,e.on(Laya.Event.COMPLETE,this,this.parseComplete),e.loadAni(m[2001]);const s=t.att.split("|"),i=t.bulletsp.split("|");L.on(T.EnemyHit,this,(e,l,a)=>{if(l==this.enemyCom.eid&&e==t.type){if(this.ske){let t=0;1001==a&&(t=1),1002==a&&(t=0),1003==a&&(t=2),this.ske.play(t,!1)}this.currSkill=a,this.currAtt=parseInt(s[a-1001]),this.currBsp=parseInt(i[a-1001])}})}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop(),this.ske.removeSelf()),this.templet&&(this.templet.offAllCaller(this),this.templet.destroy())}parseComplete(){this.ske=this.templet.buildArmature(0);const t=this.ske,e=A[2001];t.pos(e.self.x,e.self.y),t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t.play(3,!0),this.skeCon.addChild(t)}completeHandler(){this.ske.play(3,!0)}onEvent(t){this.ins.gameState==E.START&&("b2"==t.stringValue?this.skill1001():"b1"==t.stringValue?this.skill1002():"b3"==t.stringValue&&this.skill1003())}skill1001(){const t=this.owner,e=(this.enemyCom.edata,[-30,-20,-10,0,10,20,30]),s=A[2001].b1,i=i=>{for(let l=0;l<e.length;l++){const a=this.open(u.battle.EnemySkill1,this.eskillCom.skill1Pre);let n=a.getComponent(B);n||(n=a.addComponent(B)),n.setData(this.currAtt,0,0,0,0);const o=a.getComponent(U);o.norV3=this.getVec3(0,1),o.speed=this.currBsp,o.state=E.START,a.pos(t.x+s[i].x+e[l],t.y+s[i].y),this.ins.eneBulNode.addChild(a)}};for(let t=0;t<2;t++)i(t),this.schedule(100,()=>{i(t)},this,3)}skill1002(){const t=this.owner,e=(this.enemyCom.edata,A[2001].b2),s=[this.getVec3(-.34,.94),this.getVec3(-.17,.98),this.getVec3(0,1),this.getVec3(.17,.98),this.getVec3(.34,.94)],i=i=>{for(let l=0;l<s.length;l++)for(let l=0;l<s.length;l++){const a=this.open(u.battle.EnemySkill2001,this.skill2001Pre);let n=a.getComponent(B);n||(n=a.addComponent(B)),n.setData(this.currAtt,0,0,0,0);const o=a.getComponent(U);o.speed=this.currBsp,o.norV3=s[l].clone(),o.state=E.START,a.pos(t.x+e[i].x,t.y+e[i].y),this.ins.eneBulNode.addChild(a)}};for(let t=0;t<2;t++)i(t),this.schedule(100,()=>{i(t)},this,5)}skill1003(){const t=this.owner,e=(this.enemyCom.edata,[-60,-30,0,30,60]),s=[-10,-5,0,-5,-10],i=A[2001].b3,l=this.getVec2(t.x,t.y),a=t=>{for(let a=0;a<e.length;a++){const n=this.open(u.battle.EnemySkill2001,this.skill2001Pre);let o=n.getComponent(B);o||(o=n.addComponent(B)),o.setData(this.currAtt,0,0,0,0);const r=n.getComponent(U);r.speed=this.currBsp,r.norV3=this.getVec3(0,1),r.state=E.START,n.pos(l.x+i[t].x+e[a],l.y+i[t].y+s[a]),this.ins.eneBulNode.addChild(n)}};for(let t=0;t<2;t++)a(t),this.schedule(100,()=>{a(t)},this,5)}onUpdate(){}}class te extends k{constructor(){super()}onEnable(){const t=this.owner;let e=Math.floor(151*Math.random()+50);t.color=e>=1e3?"#ff0300":"#ffffff",t.scale(0,0);let s=Math.floor(6*Math.random()+15),i=Math.floor(16*Math.random()+45),l=Math.floor(6*Math.random()+5),a=Math.floor(6*Math.random()+5);Laya.Tween.to(t,{x:t.x+s,y:t.y-i,scaleX:1,scaleY:1},300,Laya.Ease.quintOut,Laya.Handler.create(this,()=>{Laya.timer.once(100,this,()=>{Laya.Tween.to(t,{x:t.x-l,y:t.y-a,scaleX:0,scaleY:0},100,null,Laya.Handler.create(this,()=>{t.removeSelf()}))})}))}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this),this.recover(this.owner)}onUpdate(){}}class ee extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this.timer=0}onEnable(){this.timer=0,this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280}))}onDisable(){L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){this.ins.gameState==E.START&&(this.quadTree.check(this.ins.playerCols,this.selfCol),this.timer+=Laya.timer.delta,this.timer>=2e3&&this.owner.removeSelf())}}class se extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null}onEnable(){this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280}))}onCollisionEnter(t,e){const s=t.owner;if(!s||!s.parent)return;const i=s.getComponent(B);if(!i||!i.data)return;const l=this.ins.playerData;L.event(T.PlayerHP),l.currHP<=0&&(this.makeBoom(1004),L.event(T.GameOver))}onCollisionExit(t,e){}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}makeBoom(t){const e=this.getRes(u.battle.EnemyBoom),s=this.open(u.battle.EnemyBoom,e);s.__$type$__=t;const i=this.owner;s.x=i.x,s.y=i.y,this.ins.effectNode.addChild(s)}onLateUpdate(){this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class ie extends k{constructor(){super(),this.bgIma=null,this.ins=st.instance}onEnable(){const t=this.ins.playerData;this.bgIma.skin="battle/player/plane/p"+t.id+".png"}onDisable(){}onLateUpdate(){const t=this.owner;let e=this.ins.playerV2;t.pos(e.x,e.y)}}class le extends k{constructor(){super(),this.ins=st.instance,this.line=null,this.bgBar=null,this.bar=null,this.hpLab=null,this.baseWidth=12,this.currBarWidth=60,this.currBaseNum=5}onEnable(){const t=this.ins.playerData;let e=this.currBaseNum*this.baseWidth;this.bgBar.width=e,this.currBarWidth=e,L.on(T.PlayerHP,this,()=>{let s=t.currHP/t.hp*e;this.currBarWidth=s,this.hpLab.text=Math.round(t.currHP/t.hp*100)+"%"}),L.on(T.PlayerMaxHP,this,()=>{this.currBaseNum++,e=this.currBaseNum*this.baseWidth,this.bgBar.width=e;let s=t.currHP/t.hp*e;this.currBarWidth=s,this.hpLab.text=Math.round(t.currHP/t.hp*100)+"%"})}onDisable(){L.offAllCaller(this)}onLateUpdate(){const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),i=this.getVec3(this.ins.playerPosV2.x+40,this.ins.playerPosV2.y-40),l=this.getVec3();Laya.Vector3.lerp(s,i,8*e,l),t.pos(l.x,l.y);let a=this.ins.playerV2,n=l.x-a.x,o=l.y-a.y;this.line.height=Math.sqrt(n*n+o*o),this.line.rotation=Math.atan2(n,-o)/Math.PI*180;let r=this.getVec3();Laya.Vector3.lerp(this.getVec3(this.bar.width),this.getVec3(this.currBarWidth),.01*Laya.timer.delta,r),this.bar.width=r.x}}class ae extends k{constructor(){super(),this.ins=st.instance,this.robot1BPre=null,this.robot1BPre=this.getRes(u.battle.PlayerRobot1b)}onEnable(){const t=this.owner,e=[this.getVec3(.87,-.5),this.getVec3(.98,-.17),this.getVec3(.98,.17),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-.98,-.17),this.getVec3(-.98,.17),this.getVec3(-.87,.5)],s=this.ins.playerData,i=c.skills[x.BlastRobot],l=i.robotbullet||5,a=i.fspeed||.2;Laya.timer.loop(1e3*l,this,()=>{if(this.ins.gameState==E.START)for(let l=0;l<8;l++){const n=this.open(u.battle.PlayerRobot1b,this.robot1BPre);let o=n.getComponent(B);o||(o=n.addComponent(B));const r=i.value||1;o.setData(s.attack*r,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);let h=n.getComponent(ot);h||(h=n.addComponent(ot)),h.speed=a,h.delta=294,h.norV3=e[l].clone(),n.pos(t.x,t.y),this.ins.player2Node.addChild(n);const c=n.getChildByName("bi");c.height=0,Laya.Tween.clearAll(c),Laya.Tween.to(c,{height:294},300)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){}}class ne extends k{constructor(){super(),this.ins=st.instance,this.robot2BPre=null,this.robot2BPre=this.getRes(u.battle.PlayerWing6b)}onEnable(){const t=this.owner,e=[this.getVec3(.87,-.5),this.getVec3(1,0),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-1,0),this.getVec3(-.87,.5)],s=c.skills[x.ShieldRobot],i=s.robotbullet||5,l=s.fspeed||.2;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState==E.START)for(let s=0;s<6;s++){const i=this.open(u.battle.PlayerWing6b,this.robot2BPre),a=i.getComponent(St);a.speed=l,a.norV3=e[s].clone(),i.pos(t.x,t.y),this.ins.player2Node.addChild(i)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){}}class oe extends k{constructor(){super(),this.ins=st.instance,this.left=null,this.right=null,this.vec=0,this.tar=null,this.im=null,this.point=null}onEnable(){const t=this.owner,e=c.skills[x.LaserRobot],s=e.robotbullet||5;e.fspeed;this.left.alpha=0,this.right.alpha=0;const i=[this.right,this.left],l=this.ins;Laya.timer.loop(1e3*s,this,()=>{if(l.gameState!=E.START)return;const e=i[this.vec],s=e.getChildByName("point");if(e){let l=this.ins.getMinEnemy(t),a=this.vec?90:-90,n=730;if(l&&l.parent){let s=t.x+(e.x-25)-l.x,i=t.y-l.y;n=Math.sqrt(s*s+i*i),a=Math.atan2(s,-i)/Math.PI*180;const o=l.getComponent(Y);o.onCollisionEnter(this,o,!0)}e.height=n,e.rotation=a,s.y=n/730*713,Laya.Tween.to(e,{alpha:1},100,null,Laya.Handler.create(this,()=>{if(l&&l.parent){const t=l.getComponent(Y);t.onCollisionEnter(this,t,!0)}})),Laya.timer.once(200,this,()=>{Laya.Tween.to(e,{alpha:0},100)}),this.tar=l,this.im=e,this.point=s,this.vec++,this.vec>=i.length&&(this.vec=0)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){if(this.ins.gameState==E.START&&this.im&&this.point){const t=this.owner;let e=1500,s=this.vec?90:-90,i=this.tar;if(i&&i.parent){let l=t.x+(this.im.x-25)-i.x,a=t.y-i.y;e=Math.sqrt(l*l+a*a),s=Math.atan2(l,-a)/Math.PI*180}this.im.height=e,this.im.rotation=s,this.point.y=e/730*713}}}class re extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this.boomSke=null}onEnable(){const t=this.owner;this.ins;this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.boomSke&&(this.boomSke.blendMode=Laya.BlendMode.LIGHTER),Laya.timer.once(265,this,()=>{this.quadTree.check(this.ins.enemyCols,this.selfCol),t.removeSelf()})}onDisable(){this.selfCol.bids=[],L.event(T.LaserHide,this.selfCol),L.offAllCaller(this),Laya.timer.clearAll(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){}}class he extends k{constructor(){super(),this.laser=null,this.ins=st.instance,this.selfCol=null,this.quadTree=null,this.target=null,this.startH=1500}set currH(t){this.laser.scaleY=t/1e3}onEnable(){const t=st.instance,e=this.owner;e.__type__=_.LASER,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(w),this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.target=null,this.currH=this.startH,e.alpha=1;let s=t.playerData,i=1e3*(s.fspeed+s.speed+1),l=1e3*s.speed+500;Laya.timer.loop(i,this,()=>{Laya.Tween.to(e,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids()})),Laya.timer.once(l,this,()=>{if(2==t.playerData.laserSta&&t.playerData.trackBox&&t.playerData.trackBox.owner&&t.playerData.trackBox.owner.parent){const e=t.playerData.trackBox;e.bids.indexOf(this.selfCol.bid)<0&&(e.bids.push(this.selfCol.bid),t.playerData.trackCol.onCollisionEnter(this.selfCol,t.playerData.trackBox,!0))}Laya.Tween.to(e,{alpha:1},500,null,Laya.Handler.create(this,()=>{}))})}),L.on(T.GameStateChange,this,()=>{t.gameState==E.START?e.visible=!0:e.visible=!1}),L.on(T.LaserCross,this,()=>{this.target=null,this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2}),L.on(T.LaserTrack,this,()=>{this.selfCol.bids=[],this.target=null}),L.on(T.LaserTrackTar,this,()=>{if(L.event(T.LaserHide,this.selfCol),t.playerData.trackTar&&t.playerData.trackBox&&t.playerData.trackCol&&e.visible&&1==e.alpha){const e=t.playerData.trackBox;e.bids.indexOf(this.selfCol.bid)<0&&(e.bids.push(this.selfCol.bid),t.playerData.trackCol.onCollisionEnter(this.selfCol,t.playerData.trackBox,!0))}})}onDisable(){this.clearBids(),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}clearBids(){this.owner;this.selfCol.bids=[],this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null,this.currH=this.startH,L.event(T.LaserHide,this.selfCol)}onCollisionEnter(t,e){const s=t.owner,i=e.owner;if(s&&i&&!st.instance.playerData.laserSta){let t=Math.abs(s.y-i.y);this.selfCol.height2>t&&(this.currH=t,this.selfCol.height2=t,this.selfCol.deltaY=-t/2,this.target=s)}}onCollisionExit(t,e){const s=t.owner,i=e.owner;s&&i&&!st.instance.playerData.laserSta&&(this.selfCol.bids.length||(this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null))}onLateUpdate(){const t=this.owner,e=st.instance;if(2==e.playerData.laserSta)if(e.playerData.trackTar){const s=e.playerData.trackTar;if(s.x>=0&&s.x<=720&&s.y>=0&&s.y<=1280){let s=e.playerData.trackTar.x-t.x,i=e.playerData.trackTar.y-t.y,l=Math.sqrt(s*s+i*i);this.currH=l,t.rotation=Math.atan2(s,-i)/Math.PI*180}}else t.rotation=0,this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2;if(2!=e.playerData.laserSta&&t.visible&&t.alpha>=.1&&this.quadTree.check(st.instance.enemyCols,this.selfCol),!e.playerData.laserSta&&this.target){const t=this.owner;let e=Math.abs(this.target.y-t.y);this.currH=e,this.selfCol.height2=e,this.selfCol.deltaY=-e/2}}}class ce extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this.skeNode=null,this.state=E.READY}onEnable(){const t=this.owner;t.__type__=_.MAGNET,this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),t.visible=!1,this.skeNode&&(this.skeNode.blendMode=Laya.BlendMode.LIGHTER),this.state=E.START;const e=c.skills[x.Magnet];Laya.timer.loop(1e3*e.speed,this,()=>{this.ins.gameState==E.START&&(this.skeNode.templet&&(this.skeNode.play(0,!0),this.skeNode.playbackRate(.8)),t.visible=!0,this.schedule(250,()=>{this.quadTree.check(st.instance.enemyCols,this.selfCol),this.selfCol.bids=[],L.event(T.LaserHide,this.selfCol)},this,2,null,!0,()=>{t.visible=!1}))})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;t.x=this.ins.playerV2.x,t.y=this.ins.playerV2.y}}class de extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.state=E.READY,this.shield1=null,this.shield2=null}onEnable(){this.owner;this.state=E.START,this.selfCol=this.owner.getComponent(w);const t=this.ins.playerCols;this.shield1.blendMode=Laya.BlendMode.LIGHTER,this.shield2.blendMode=Laya.BlendMode.LIGHTER,this.shield1.playbackRate(.2);const e=c.skills[x.TimeShield];let s=1e3*(e.fspeed+e.speed+1),i=1e3*e.fspeed;this.shield2.alpha=0,this.shield1.alpha=0,Laya.timer.loop(s,this,()=>{this.shield1.templet&&(this.shield1.playbackRate(.5),this.shield1.play(0,!1)),this.shield2.templet&&this.shield2.playbackRate(.5),this.shield1.alpha=1,Laya.timer.once(600,this,()=>{this.shield1.alpha=0}),this.shield2.scaleX=this.shield2.scaleY=0,Laya.Tween.to(this.shield2,{alpha:1,scaleX:1,scaleY:1},600,null,Laya.Handler.create(this,()=>{t.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol)})),Laya.timer.once(i,this,()=>{let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),Laya.Tween.to(this.shield2,{alpha:0},500)})})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins;this.owner.pos(t.playerV2.x,t.playerV2.y)}}class pe extends k{constructor(){super(),this.ins=st.instance,this.selfCol=null,this.quadTree=null,this.state=E.READY,this._norV3=null,this.speed=.6}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){const t=this.owner,e=this.ins;t.__type__=_.MAGNET,this.selfCol=this.owner.getComponent(w),this.quadTree||(this.quadTree=new H({x:0,y:0,width:720,height:1280})),this.state=E.START;const s=this.getRes(u.battle.PlayerBlast);Laya.timer.loop(100,this,()=>{if(this.ins.gameState!=E.START)return;this.quadTree.check(this.ins.enemyCols,this.selfCol);const i=this.open(u.battle.PlayerBlast,s);i.pos(t.x,t.y),e.effectNode.addChild(i),this.selfCol.bids=[],L.event(T.LaserHide,this.selfCol)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=E.START)return;if(this.state!=E.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class ye extends k{constructor(){super(),this.ins=st.instance,this.wing1BPre=null,this.wing1BPre=this.getRes(u.battle.PlayerWing1b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=c.skills[x.BlastWing],i=s.speed||5,l=s.fspeed||.2;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=E.START)return;const i=this.open(u.battle.PlayerWing1b,this.wing1BPre);let a=i.getComponent(B);a||(a=i.addComponent(B));const n=s.value||1;let o=e.attack*n;e.skills[x.BlastWing]&&(o+=e.attack*n*(e.skills[x.BlastWing]-1)*2.4),a.setData(o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=i.getComponent(pe);r.speed=l,r.norV3=this.getVec3(0,-1),i.pos(t.x,t.y),this.ins.player2Node.addChild(i)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}onLateUpdate(){}}class ue extends k{constructor(){super(),this.ins=st.instance,this.wing4BPre=null,this.wing4BPre=this.getRes(u.battle.PlayerWing4b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=c.skills[x.AutoWing],i=s.speed||.2,l=s.fspeed||.2;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=E.START)return;const i=this.open(u.battle.PlayerWing4b,this.wing4BPre);let a=i.getComponent(B);a||(a=i.addComponent(B));const n=s.value||1;let o=e.attack*n;e.skills[x.AutoWing]&&(o+=e.attack*n*(e.skills[x.AutoWing]-1)*2.4),a.setData(o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=i.getComponent(N);r.speed=l,r.state=E.START,r.norV3=this.getVec3(0,-1);let h=this.ins.getMinEnemy(t),c=0;if(h&&h.parent){r.tar=h;let e=this.getVec3(0,-1),s=this.getVec3();Laya.Vector3.subtract(this.getVec3(h.x,h.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,e),r.norV3=e,c=i.rotation}const d=(90-i.rotation)/180*Math.PI;t.rotation=c,i.pos(t.x-30*Math.cos(d),t.y+30*Math.sin(d)),this.ins.player2Node.addChild(i)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),L.offAllCaller(this)}onLateUpdate(){}}class ge extends Laya.Script{constructor(){super(),this.selectIndex=0,this.itemScale=1,this.space=25,this.startY=0,this.selectDistance=0,this.itemX=[],this.dragRegion=null}onEnable(){const t=this.owner;this.startY=t.y;const e=t.getChildAt(0),s=t.x,i=this.space,l=e.width,a=e.x;this.selectDistance=(l+i)/2;let n=this.owner.numChildren;const o=l*n+i*(n-1);t.width=o;for(let e=0;e<n;e++){let n=-e*(l+i)+s;this.itemX[e]=n;const o=t.getChildAt(e);o.x=a+e*(l+i);let r=e==this.selectIndex?1:this.itemScale;o.scaleX=r,o.scaleY=r}this.dragRegion=new Laya.Rectangle(t.x-o+l,t.y,o-l,0),t.on(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.on(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.on(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.on(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd),t.x=this.itemX[this.selectIndex]}onBoxMove(){this.owner.startDrag(this.dragRegion,!1,100)}onBoxMoving(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);let s=1-Math.abs(t.x-this.itemX[0])/100*.15;return e.scaleX=s,void(e.scaleY=s)}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);let s=1-Math.abs(this.itemX[this.itemX.length-1]-t.x)/100*.15;return e.scaleX=s,void(e.scaleY=s)}for(let e=0;e<this.itemX.length;e++){let s=t.getChildAt(e),i=t.getChildAt(e+1),l=this.itemX[e],a=this.itemX[e+1];if(t.x>=a&&t.x<=l){let n=1-Math.abs(t.x-l)/Math.abs(l-a)*(1-this.itemScale),o=this.itemScale+1-n;s.scaleX=n,s.scaleY=n,i.scaleX=o,i.scaleY=o,e++}else s.scaleX=this.itemScale,s.scaleY=this.itemScale}}onBoxMoveEnd(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);return void Laya.Tween.to(e,{scaleX:1,scaleY:1},100)}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);return void Laya.Tween.to(e,{scaleX:1,scaleY:1},100)}t.stopDrag();for(let e=0;e<this.itemX.length;e++){const s=this.itemX[e];if(t.x!=s&&Math.abs(t.x-s)<=this.selectDistance){Laya.Tween.to(t,{x:s},100),this.selectIndex=e;break}}let e=this.owner.numChildren;for(let s=0;s<e;s++){const e=t.getChildAt(s);let i=s==this.selectIndex?1:this.itemScale;Laya.Tween.to(e,{scaleX:i,scaleY:i},100)}}onDisable(){const t=this.owner;t.off(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.off(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.off(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.off(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd)}onUpdate(){const t=this.owner;t.y!=this.startY&&(t.y=this.startY)}}class me{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("app/battle/SkillManager.ts",Lt),t("app/battle/EnemyManager.ts",K),t("app/battle/PlayerManager.ts",Vt),t("app/battle/SkillDialog.ts",Dt),t("app/battle/BattleScene.ts",st),t("app/battle/bg/BattleSceneUI.ts",J),t("app/lobby/LobbySceneUI.ts",vt),t("core/component/Toggle.ts",Mt),t("core/component/ToggleContainer.ts",It),t("app/lobby/LobbyScene.ts",jt),t("app/lobby/TestUI.ts",Gt),t("app/battle/bg/BgNode.ts",Ft),t("app/battle/bg/ChooseSkillDialog.ts",$),t("app/battle/bg/GameOverDialog.ts",Xt),t("app/battle/bg/GamePauseDialog.ts",zt),t("app/battle/bg/SupplySkillDialog.ts",Q),t("app/battle/effect/EnemyBoom.ts",R),t("app/battle/effect/LighterSkeleton.ts",Yt),t("app/battle/effect/PlayerBlast.ts",Qt),t("app/battle/effect/PlayerLaserHit.ts",I),t("core/utils/BoxCollision.ts",w),t("app/battle/enemy/Enemy.ts",z),t("app/battle/enemy/EnemyCollision.ts",Y),t("app/battle/enemy/EnemySkill.ts",q),t("app/battle/enemy/Enemy1001.ts",Zt),t("app/battle/enemy/Enemy1002.ts",$t),t("app/battle/enemy/Enemy1008.ts",Jt),t("app/battle/enemy/Enemy2001.ts",Kt),t("app/battle/enemy/Enemy3002.ts",Z),t("app/battle/enemy/EnemyHPTip.ts",te),t("app/battle/enemySkill/EnemyLine.ts",W),t("app/battle/enemySkill/EnemySkill1.ts",U),t("app/battle/enemySkill/EnemySkill13.ts",ee),t("app/battle/enemySkill/EnemySkill3.ts",F),t("app/battle/enemySkill/EnemySkill16.ts",j),t("app/battle/enemySkill/EnemySkill18.ts",G),t("app/battle/player/Player.ts",et),t("app/battle/player/PlayerCollision.ts",se),t("app/battle/player/Player1.ts",ie),t("app/battle/player/PlayerHP.ts",le),t("app/battle/robot/PlayerRobot.ts",lt),t("app/battle/robot/PlayerRobot1.ts",ae),t("app/battle/robot/PlayerRobot2.ts",ne),t("app/battle/robot/PlayerRobot3.ts",oe),t("app/battle/skill/PlayerDieBoom.ts",re),t("app/battle/skill/PlayerSkill1.ts",N),t("app/battle/player/PlayerLaser.ts",it),t("app/battle/player/PlayerLaserCollision.ts",he),t("app/battle/skill/PlayerShield.ts",at),t("app/battle/skill/PlayerSkill6.ts",ht),t("app/battle/skill/PlayerSkill2.ts",nt),t("app/battle/skill/PlayerSkill3.ts",gt),t("app/battle/skill/PlayerSkill4.ts",ot),t("app/battle/skill/PlayerSkill5.ts",rt),t("app/battle/skill/PlayerSkill7.ts",ct),t("app/battle/skill/PlayerSkill9.ts",ce),t("app/battle/skill/PlayerTimeShield.ts",de),t("app/battle/wing/PlayerWing.ts",pt),t("app/battle/wing/PlayerWing1.ts",ye),t("app/battle/skill/PlayerSkill11.ts",pe),t("app/battle/wing/PlayerWing2.ts",ut),t("app/battle/skill/PlayerSkill10.ts",yt),t("app/battle/wing/PlayerWing3.ts",ft),t("app/battle/wing/PlayerWingLaser.ts",mt),t("app/battle/wing/PlayerWing4.ts",ue),t("app/battle/wing/PlayerWing5.ts",bt),t("app/battle/wing/PlayerWing6.ts",Ct),t("app/battle/skill/PlayerSkill12.ts",St),t("core/component/HorizontalSelect.ts",ge),t("app/lobby/BattlePage.ts",Bt),t("app/lobby/hangar/HangarPage.ts",Wt),t("app/lobby/hangar/HangarPlaneItem2.ts",Ot)}}me.width=720,me.height=1280,me.scaleMode="fixedwidth",me.screenMode="none",me.alignV="top",me.alignH="center",me.startScene="LobbyScene.scene",me.sceneRoot="",me.debug=!1,me.stat=!1,me.physicsDebug=!1,me.exportSceneToJson=!0,me.init();new class{constructor(){window.Laya3D?Laya3D.init(me.width,me.height):Laya.init(me.width,me.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=me.scaleMode,Laya.stage.screenMode=me.screenMode,Laya.stage.alignV=me.alignV,Laya.stage.alignH=me.alignH,Laya.URL.exportSceneToJson=me.exportSceneToJson,(me.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),me.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),me.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.ClassUtils.regClass("laya.effect.ColorFilterSetter",Laya.ColorFilterSetter),Laya.ClassUtils.regClass("laya.effect.GlowFilterSetter",Laya.GlowFilterSetter),Laya.ClassUtils.regClass("laya.effect.BlurFilterSetter",Laya.BlurFilterSetter)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){const t=()=>{me.startScene&&Laya.Scene.open(me.startScene)};xt.__initDefine__(),xt.initShader();const e=[];for(const t in S){const s=S[t];e.push(s)}const s=[];for(const t in C){const e=C[t];s.push(e)}let a=0;Laya.loader.load(e,Laya.Handler.create(this,()=>{2==++a&&t()})),Laya.loader.load(s,Laya.Handler.create(this,()=>{a++;const e=Laya.loader.getRes(C.Chapter);r.setChatpers(e);const s=Laya.loader.getRes(C.Skill);c.setSkills(s);const n=Laya.loader.getRes(C.Enaircraft);h.setEnemys(n);for(let t=1;t<6;t++){const e=Laya.loader.getRes(C["Level"+t]);i.setEnemys1(e,t)}const o=Laya.loader.getRes(C.Exp);l.setExps(o);const d=Laya.loader.getRes(C.Upaircraft);p.setPlanes(d);const u=Laya.loader.getRes(C.Upgold);p.setGolds(u);const g=Laya.loader.getRes(C.Aircraft);y.setPlanes(g),2==a&&t()}),null,Laya.Loader.JSON)}}}();