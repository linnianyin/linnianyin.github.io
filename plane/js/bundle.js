!function(){"use strict";var t,e,s;!function(t){t[t.Line=1]="Line",t[t.DownCurve=2]="DownCurve",t[t.UpCurve=3]="UpCurve"}(t||(t={})),function(t){t[t.Return=1]="Return",t[t.Repeat=2]="Repeat"}(e||(e={})),function(t){t[t.Top=1]="Top",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Bottom=4]="Bottom"}(s||(s={}));class i{static setEnemys1(t){const e=this.enemys1;for(let s=1;s<t.length;s++){const i=t[s];let l=e[i[2]];l||(e[i[2]]=[],l=e[i[2]]),l.push({id:i[0],chapter:i[1],level:i[2],difficulty:i[3],type:i[4],direntry:i[5],entry:i[6],direxit:i[7],exit:i[8],distance:i[9],time:i[10],return:i[11],route:i[12],speed:i[13],att:i[14],hp:i[15],def:i[16],in:this.getPos(i[5],i[6]),out:this.getPos(i[7],i[8])})}}static getPos(t,e){if("number"!=typeof t||"number"!=typeof e)return null;const i=new Laya.Vector2;return t==s.Top?(i.x=e,i.y=0):t==s.Left?(i.x=0,i.y=e):t==s.Right?(i.x=720,i.y=e):t==s.Bottom&&(i.x=e,i.y=1280),i}}i.enemys1={};class l{static setExps(t){for(let e=1;e<t.length;e++){const s=t[e];1==s[1]?this.upLevExps[s[2]]=s[4]:2==s[1]&&(this.levelExps[s[3]]=s[4])}}}var a,n;l.levelExps={},l.upLevExps={},function(t){t[t.Common=1]="Common",t[t.Hard=2]="Hard",t[t.Hell=3]="Hell"}(a||(a={}));class o{static setChatpers(t){const e=t[1];this.basChapter={id:e[0],nameCN:e[1],name:e[2],chapter:e[3],level:e[4],maxair:e[5],fight:e[6],fightatt:e[7],fighthp:e[8],difficulty:e[9],drop:e[10],unlockskill:[]};for(let e=2;e<t.length;e+=2){const s=t[e];this.comChapters.push({id:s[0],nameCN:s[1],name:s[2],chapter:s[3],level:s[4],maxair:s[5],fight:s[6],fightatt:s[7],fighthp:s[8],difficulty:s[9],drop:s[10],unlockskill:[]})}}}o.basChapter=null,o.comChapters=[];class r{static setEnemys(t){const e=this.enemys;for(let s=1;s<t.length;s++){const i=t[s];e[i[0]]={id:i[0],nameCN:i[1],icon:i[2],shooting:i[3],bullettype:i[4],skill:i[5]}}}}r.enemys={},function(t){t[t.Once=1]="Once",t[t.Add=2]="Add",t[t.Always=3]="Always",t[t.Supply=4]="Supply"}(n||(n={}));class h{static setSkills(t){for(let e=1;e<t.length;e++){const s=t[e];this.skills[s[0]]={id:s[0],nameCN:s[1],name:s[2],describeCN:s[3],describe:s[4],skilltype:s[5],fightadd:s[6],value:s[7],bullettype:s[8],buff:s[9],bufftime:s[10],add:s[11],speed:"number"==typeof s[13]?s[13]:0,fspeed:"number"==typeof s[14]?s[14]:0};const i=(s[12]+"").split("|"),l=i[0]?parseInt(i[0]):0,a=i[1]?parseInt(i[1]):0;l?o.comChapters[a-1].unlockskill.push(s[0]):s[11]!=n.Add&&1e3!=s[0]&&o.basChapter.unlockskill.push(s[0])}o.basChapter.unlockskill.push(1001,1005,1009,1016,1020)}}h.skills={};const c=new class{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.speed=0,this.fspeed=0,this.eneHurtStr=0,this.bosHurtStr=0,this.hp=0,this.currHP=0,this.defense=0,this.subHurt=0,this.id=0,this.chapter=1,this.rate=1,this.exp=0,this.level=1,this.skills={},this.rewards={},this.track=!1,this.cross=!1,this.unlock=[]}};class y{static setPlanes(t){this.plane1={id:1,att:t[1][5],hp:t[1][6]},this.plane2={id:2,att:t[1][7],hp:t[1][8]},c.id=this.plane1.id,c.hp=this.plane1.hp,c.attack=this.plane1.att}}y.plane1=null,y.plane2=null;const p={lobby:{BattlePage:"prefab/lobby/BattlePage.json",HangarPage:"prefab/lobby/HangarPage.json",HangarPlaneItem:"prefab/lobby/HangarPlaneItem.json"},battle:{BgNode:"prefab/battle/bg/BgNode.json",Player:"prefab/battle/player/Player.json",PlayerHP:"prefab/battle/player/PlayerHP.json",Player1Bullet:"prefab/battle/skill/Player1Bullet.json",PlayerLaser:"prefab/battle/skill/PlayerLaser.json",PlayerShield:"prefab/battle/skill/PlayerShield.json",PlayerTimeShield:"prefab/battle/skill/PlayerTimeShield.json",PlayerDieShot:"prefab/battle/skill/PlayerDieShot.json",PlayerDieBoom:"prefab/battle/skill/PlayerDieBoom.json",PlayerSkill1:"prefab/battle/skill/PlayerSkill1.json",PlayerSkill2:"prefab/battle/skill/PlayerSkill2.json",PlayerSkill3:"prefab/battle/skill/PlayerSkill3.json",PlayerSkill4:"prefab/battle/skill/PlayerSkill4.json",PlayerSkill5:"prefab/battle/skill/PlayerSkill5.json",PlayerSkill6:"prefab/battle/skill/PlayerSkill6.json",PlayerSkill7:"prefab/battle/skill/PlayerSkill7.json",PlayerSkill8:"prefab/battle/skill/PlayerSkill8.json",PlayerSkill9:"prefab/battle/skill/PlayerSkill9.json",PlayerSkill10:"prefab/battle/skill/PlayerSkill10.json",PlayerWing1:"prefab/battle/wing/PlayerWing1.json",PlayerWing1b:"prefab/battle/wing/PlayerWing1b.json",PlayerWing2:"prefab/battle/wing/PlayerWing2.json",PlayerWing2b:"prefab/battle/wing/PlayerWing2b.json",PlayerWing3:"prefab/battle/wing/PlayerWing3.json",PlayerWing3b:"prefab/battle/wing/PlayerWing3b.json",PlayerWing4:"prefab/battle/wing/PlayerWing4.json",PlayerWing4b:"prefab/battle/wing/PlayerWing4b.json",PlayerWing5:"prefab/battle/wing/PlayerWing5.json",PlayerWing5b:"prefab/battle/wing/PlayerWing5b.json",PlayerWing6:"prefab/battle/wing/PlayerWing6.json",PlayerWing6b:"prefab/battle/wing/PlayerWing6b.json",PlayerRobot1:"prefab/battle/robot/PlayerRobot1.json",PlayerRobot1b:"prefab/battle/robot/PlayerRobot1b.json",PlayerRobot2:"prefab/battle/robot/PlayerRobot2.json",PlayerRobot3:"prefab/battle/robot/PlayerRobot3.json",Enemy1001:"prefab/battle/enemy/Enemy1001.json",Enemy1002:"prefab/battle/enemy/Enemy1002.json",Enemy1004:"prefab/battle/enemy/Enemy1004.json",Enemy1006:"prefab/battle/enemy/Enemy1006.json",Enemy1008:"prefab/battle/enemy/Enemy1008.json",Enemy1010:"prefab/battle/enemy/Enemy1010.json",Enemy1012:"prefab/battle/enemy/Enemy1012.json",Enemy1014:"prefab/battle/enemy/Enemy1014.json",Enemy1016:"prefab/battle/enemy/Enemy1016.json",Enemy2001:"prefab/battle/enemy/Enemy2001.json",Enemy3001:"prefab/battle/enemy/Enemy3001.json",Enemy3002:"prefab/battle/enemy/Enemy3002.json",EnemyHPTip:"prefab/battle/enemy/EnemyHPTip.json",EnemyLine:"prefab/battle/enemySkill/EnemyLine.json",EnemySkill1:"prefab/battle/enemySkill/EnemySkill1.json",EnemySkill3:"prefab/battle/enemySkill/EnemySkill3.json",EnemySkill5:"prefab/battle/enemySkill/EnemySkill5.json",EnemySkill9:"prefab/battle/enemySkill/EnemySkill9.json",EnemySkill10:"prefab/battle/enemySkill/EnemySkill10.json",EnemySkill11:"prefab/battle/enemySkill/EnemySkill11.json",EnemySkill13:"prefab/battle/enemySkill/EnemySkill13.json",EnemySkill2001:"prefab/battle/enemySkill/EnemySkill2001.json",EnemyBoom:"prefab/battle/effect/EnemyBoom.json",PlayerLaserHit:"prefab/battle/effect/PlayerLaserHit.json",PlayerBlast:"prefab/battle/effect/PlayerBlast.json"},battleUI:{ChooseSkillDialog:"prefab/battle/bg/ChooseSkillDialog.json",GamePauseDialog:"prefab/battle/bg/GamePauseDialog.json",PlayerSkillItem:"prefab/battle/bg/PlayerSkillItem.json"}},d={PlaneTrackModel:"unity/lizi/plane.lh",PlaneModel1:"unity/plane1/plane.lh",PlaneModel2:"unity/plane2/plane.lh",PlaneModel3:"unity/plane3/plane.lh",Coin:"unity/coin/plane.lh",Track:"unity/tuowei/plane.lh"},g={Boos2001:"battle/enemy/plane/2001/boss01.sk"},u={1001:"prefab/battle/enemy/Enemy1001.json",1002:"prefab/battle/enemy/Enemy1002.json",1003:"prefab/battle/enemy/Enemy1002.json",1004:"prefab/battle/enemy/Enemy1004.json",1005:"prefab/battle/enemy/Enemy1004.json",1006:"prefab/battle/enemy/Enemy1006.json",1007:"prefab/battle/enemy/Enemy1006.json",1008:"prefab/battle/enemy/Enemy1008.json",1009:"prefab/battle/enemy/Enemy1008.json",1010:"prefab/battle/enemy/Enemy1010.json",1011:"prefab/battle/enemy/Enemy1010.json",1012:"prefab/battle/enemy/Enemy1012.json",1013:"prefab/battle/enemy/Enemy1012.json",1014:"prefab/battle/enemy/Enemy1014.json",1015:"prefab/battle/enemy/Enemy1014.json",1016:"prefab/battle/enemy/Enemy1016.json",2001:"prefab/battle/enemy/Enemy2001.json",3001:"prefab/battle/enemy/Enemy3001.json",3002:"prefab/battle/enemy/Enemy3002.json"},m={1:"unity/plane1/plane.lh",2:"unity/plane2/plane.lh",3:"unity/plane3/plane.lh"},b={BlackItalic:"font/DIN-BlackItalic.ttf"},k={Chapter:"json/battle/chapter.json",Skill:"json/battle/skill.json",Level1:"json/battle/level1.json",Enaircraft:"json/battle/enaircraft.json",Exp:"json/battle/exp.json",Upaircraft:"json/lobby/upaircraft.json"},S=new Laya.EventDispatcher;class f extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)})}loadRes(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}))})}getRes(t){return Laya.loader.getRes(t)}open(t,e){const s=Laya.Pool.getItemByCreateFun(t,e.create,e);return s.__sign__=t,s}recover(t){let e=t.__sign__;e&&Laya.Pool.recover(e,t);let s=window.__PoolSigns__;s&&s.indexOf&&s.indexOf(e)<0&&s.push(e)}openDialog(t,e,s){this.loadPrefab(t).then(i=>{const l=this.open(t,i);l.pos(360,640),l.scale(0,0),l.alpha=0,e.addChild(l),s&&s(l),Laya.Tween.to(l,{scaleX:1,scaleY:1,alpha:1},200,Laya.Ease.quadInOut)})}setClick(t,e,s,i,l){t.on(Laya.Event.MOUSE_DOWN,s,()=>{l||Laya.Tween.to(t,{scaleX:.9,scaleY:.9},100)});const a=()=>{Laya.Tween.to(t,{scaleX:1,scaleY:1},100)};if(!l){const t=e;e=(()=>{a(),t.call(s,i)})}t.on(Laya.Event.MOUSE_OUT,s,a),t.on(Laya.Event.CLICK,s,e,i)}schedule(t,e,s,i,l,a,n){const o=e;let r=0;e=(()=>{if(r>=i)return Laya.timer.clear(s,e),void(n&&n.call(s));r++,o.call(s,l)}),a&&Laya.timer.clear(s,e),Laya.timer.loop(t,s,e,l)}getVec2(t=0,e=0){return new Laya.Vector2(t,e)}getVec3(t=0,e=0,s=0){return t instanceof Laya.Vector2&&(e=t.y,t=t.x),new Laya.Vector3(t,e,s)}getVec4(t=0,e=0,s=0,i=0){return new Laya.Vector4(t,e,s,i)}}var C,x,V;!function(t){t[t.READY=0]="READY",t[t.START=1]="START",t[t.PAUSE=2]="PAUSE",t[t.END=3]="END"}(C||(C={})),function(t){t.LASER="laser",t.POISON="poison",t.ICE="ice",t.MAGNET="magnet"}(x||(x={})),function(t){t.GameStateChange="gamestate_change",t.RateStart="battle_rate_start",t.RateEnd="battle_rate_end",t.GameOver="game_over",t.LevelEnemy="make_level_enemy",t.LevelEnemyEnd="make_level_enemy_end",t.PlayerBullet="player_main_bullet",t.PlayerHP="player_hp",t.PlayerMaxHP="player_max_hp",t.PlayerSpeed="player_speed",t.LaserHide="player_laser_hide",t.LaserCross="player_laser_cross",t.LaserTrack="player_laser_track",t.LaserTrackTar="player_laser_track_tar",t.BaseSkill1="player_1001_baseskill",t.BaseSkill1a="player_1002_baseskill",t.BaseSkill1b="player_1003_baseskill",t.BaseSkill2="player_1005_baseskill",t.BaseSkill2a="player_1006_baseskill",t.BaseSkill2b="player_1007_baseskill",t.BaseSkill3="player_1013_baseskill",t.BaseSkill4="player_1009_baseskill",t.BaseSkill4a="player_1010_baseskill",t.BaseSkill4b="player_1011_baseskill",t.BaseSkill5="player_1016_baseskill",t.BaseSkill5a="player_1017_baseskill",t.BaseSkill5b="player_1018_baseskill",t.BaseSkill6="player_1020_baseskill",t.BaseSkill6a="player_1021_baseskill",t.BaseSkill6b="player_1022_baseskill",t.BaseSkill7="player_1024_baseskill",t.BaseSkill9="player_1023_baseskill",t.Shield="player_1025_baseskill",t.TimeShield="player_1027_baseskill",t.DieShot="player_1028_baseskill",t.BaseSkill11="player_1029_baseskill",t.BaseSkill13="player_1030_baseskill",t.BaseSkill14="player_1031_baseskill",t.BaseSkill15="player_1032_baseskill",t.SuckBlood="player_1033_baseskill",t.DieBoom="player_1034_baseskill",t.BulSkill1="player_2004_bulskill",t.BulSkill1_Start="player_2004_bulskill_start",t.BulSkill2="player_2005_bulskill",t.BulSkill3="player_2003_bulskill",t.BulSkill4="player_2001_bulskill",t.BulSkill5="player_2006_bulskill",t.BulSkill6="player_2007_bulskill",t.BulSkill7="player_2010_bulskill",t.BulSkill7_Start="player_2010_bulskill_start",t.BulSkill8="player_2009_bulskill",t.BulSkill9="player_2011_bulskill",t.BulSkill10="player_2008_bulskill",t.WingSkill1="player_3005_wingskill",t.WingSkill2="player_3002_wingskill",t.WingSkill3="player_3003_wingskill",t.WingSkill4="player_3004_wingskill",t.WingSkill5="player_3001_wingskill",t.WingSkill6="player_3006_wingskill",t.RobSkill1="player_4001_robskill",t.RobSkill2="player_4003_robskill",t.RobSkill3="player_4002_robskill",t.EnemyDead="enemy_dead",t.EnemyPause="enemy_pause",t.EnemyHit="enemy_hit"}(V||(V={}));const L=[];var P;window.__PoolSigns__=L,function(t){t[t.HP1=1001]="HP1",t[t.Attack1=1005]="Attack1",t[t.HPRec1=1013]="HPRec1",t[t.Speed=1009]="Speed",t[t.Crit=1016]="Crit",t[t.MainStr=1020]="MainStr",t[t.MainCross=1024]="MainCross",t[t.MainTrack=1023]="MainTrack",t[t.Shield=1025]="Shield",t[t.TimeShield=1027]="TimeShield",t[t.DieShot=1028]="DieShot",t[t.Back=1029]="Back",t[t.Anger=1030]="Anger",t[t.Cri=1031]="Cri",t[t.Fearless=1032]="Fearless",t[t.SuckBlood=1033]="SuckBlood",t[t.DieBoom=1034]="DieBoom",t[t.Shotgun=2001]="Shotgun",t[t.Laser=2003]="Laser",t[t.SwimShell=2004]="SwimShell",t[t.ShockWave=2005]="ShockWave",t[t.RainbowMissile=2006]="RainbowMissile",t[t.RotatePoison=2007]="RotatePoison",t[t.RotateIce=2008]="RotateIce",t[t.RotateFire=2009]="RotateFire",t[t.NaughtyGhost=2010]="NaughtyGhost",t[t.Magnet=2011]="Magnet",t[t.ShotWing=3001]="ShotWing",t[t.MissileWing=3002]="MissileWing",t[t.LaserWing=3003]="LaserWing",t[t.AutoWing=3004]="AutoWing",t[t.BlastWing=3005]="BlastWing",t[t.ShieldWing=3006]="ShieldWing",t[t.BlastRobot=4001]="BlastRobot",t[t.LaserRobot=4002]="LaserRobot",t[t.ShieldRobot=4003]="ShieldRobot"}(P||(P={}));const w={1:[[0],[-15,15],[-30,0,30]],2:[[0],[-30,30],[-5,0,5]]},T=[[{dx:-80,dy:40,v:-1},{dx:80,dy:40,v:1}],[{dx:-160,dy:40,v:-1},{dx:160,dy:40,v:1}],[{dx:-240,dy:40,v:-1},{dx:240,dy:40,v:1}]],E={2001:{self:{x:50,y:75},b1:[{x:-221,y:271},{x:221,y:271}],b2:[{x:-130,y:250},{x:130,y:250}],b3:[{x:-83,y:185},{x:83,y:185}]}};class v extends f{constructor(){super(),this.width2=50,this.height2=50,this.deltaY=0,this.aabb=null,this.bid=null,this.bids=[],v.__bid__++,this.bid=v.__bid__}onEnable(){this.aabb={x:0,y:0,width:this.width2,height:this.height2}}onDisable(){this.bids.length=0}onLateUpdate(){const t=this.owner;t&&(this.aabb.x=t.x-this.width2/2,this.aabb.y=t.y-this.height2/2+this.deltaY)}}v.__bid__=0;class B extends f{constructor(){super(),this.ins=X.instance,this.move=!0}onEnable(){this.move=!0}onDisable(){}moveCoin(){const t=this.owner,e=this.ins.playerPosV3;Laya.Tween.to(t.transform,{localPositionX:e.x,localPositionY:e.y,localPositionZ:e.z,localScaleX:3,localScaleY:3,localScaleZ:3},300,null,Laya.Handler.create(this,()=>{t.removeSelf()}))}onUpdate(){const t=this.ins;if(t.gameState!=C.START)return;const e=this.owner;e.transform.rotate(this.getVec3(0,.1,0)),this.move&&(e.transform.translate(this.getVec3(0,-.04,0)),Math.abs(e.transform.position.z-t.playerPosV3.z)<=2&&(this.move=!1,this.moveCoin()))}}class R extends f{constructor(){super(),this.xp=null,this.yp=null}onEnable(){this.owner.blendMode=Laya.BlendMode.LIGHTER}onDisable(){this.xp=null,this.yp=null,this.recover(this.owner)}onLateUpdate(){if(this.xp&&this.yp){const t=this.owner;t.x=this.xp.x,t.y=this.yp.y}}}class D{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.eneHurtStr=0,this.bosHurtStr=0}}class _ extends f{constructor(){super(),this.data=new D}onEnable(){}onDisable(){}setData(t,e,s,i,l){this.data.attack=t,this.data.crit=e,this.data.critHurt=s,this.data.eneHurtStr=i,this.data.bosHurtStr=l}}class A{constructor(t){this._tree=new Quadtree(t)}check(t,e){let s=[];if(this._tree){this._tree.clear();for(let e=0,s=t.length;e<s;e++){const s=t[e],i=s.aabb,l={x:i.x,y:i.y,height:i.height,width:i.width,collider:s};this._tree.insert(l)}if(this._tree.retrieve(e.aabb).forEach(t=>{(function(t,e){const s=t.owner,i=e.owner,l=s.y+t.deltaY,a=i.y+e.deltaY;return Math.abs(s.x-i.x)<=(t.width2+e.width2)/2&&Math.abs(l-a)<=(t.height2+e.height2)/2})(t.collider,e)&&s.push(t.collider)}),this._collisions)for(let t=0;t<this._collisions.length;t++){const i=this._collisions[t];if(s.indexOf(i)<0){let t=i.bids.indexOf(e.bid);if(t>-1&&(i.bids.splice(t,1),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionExit){l.onCollisionExit(e,i);break}}}let s=e.bids.indexOf(i.bid);if(s>-1&&(e.bids.splice(s,1),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionExit){l.onCollisionExit(i,e);break}}}}}for(let t=0;t<s.length;t++){const i=s[t];if(i.bids.indexOf(e.bid)<0&&(i.bids.push(e.bid),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionEnter){l.onCollisionEnter(e,i);break}}}if(e.bids.indexOf(i.bid)<0&&(e.bids.push(i.bid),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const l=t[s];if(l&&l.onCollisionEnter){l.onCollisionEnter(i,e);break}}}}this._collisions=s}}}function Quadtree(t,e,s,i){this.max_objects=e||10,this.max_levels=s||4,this.level=i||0,this.bounds=t,this.objects=[],this.nodes=[]}Quadtree.prototype.split=function(){var t=this.level+1,e=this.bounds.width/2,s=this.bounds.height/2,i=this.bounds.x,l=this.bounds.y;this.nodes[0]=new Quadtree({x:i+e,y:l,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[1]=new Quadtree({x:i,y:l,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[2]=new Quadtree({x:i,y:l+s,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[3]=new Quadtree({x:i+e,y:l+s,width:e,height:s},this.max_objects,this.max_levels,t)},Quadtree.prototype.getIndex=function(t){var e=[],s=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,l=t.y<i,a=t.x<s,n=t.x+t.width>s,o=t.y+t.height>i;return l&&n&&e.push(0),a&&l&&e.push(1),a&&o&&e.push(2),n&&o&&e.push(3),e},Quadtree.prototype.insert=function(t){var e,s=0;if(this.nodes.length)for(e=this.getIndex(t),s=0;s<e.length;s++)this.nodes[e[s]].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){for(this.nodes.length||this.split(),s=0;s<this.objects.length;s++){e=this.getIndex(this.objects[s]);for(var i=0;i<e.length;i++)this.nodes[e[i]].insert(this.objects[s])}this.objects=[]}},Quadtree.prototype.retrieve=function(t){var e=this.getIndex(t),s=this.objects;if(this.nodes.length)for(var i=0;i<e.length;i++)s=s.concat(this.nodes[e[i]].retrieve(t));return s=s.filter(function(t,e){return s.indexOf(t)>=e})},Quadtree.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]};class M extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=C.READY,this.tar=null,this.speed=1.5,this.cross=!1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),S.on(V.BulSkill1_Start,this,()=>{this.state=C.START})}onDisable(){S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.cross||this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;if(this.tar&&!this.tar.parent&&(this.tar=null),this.tar&&this.tar.parent){let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class H extends f{constructor(){super(),this.ins=X.instance,this.tar=null}onEnable(){}onDisable(){const t=this.owner;t.height=0,t.rotation=0,this.recover(this.owner)}onLateUpdate(){if(this.ins.gameState!=C.START)return;const t=this.owner,e=this.tar;t.pos(e.x,e.y);let s=this.ins.playerV2,i=e.x-s.x,l=e.y-s.y;t.height=Math.sqrt(i*i+l*l),t.rotation=Math.atan2(i,-l)/Math.PI*180}}class W extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=C.READY,this.speed=.5}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280}))}onDisable(){S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class j extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.circle=!0,this.state=C.READY,this.tar=null,this.angle=0,this.xv=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.state=C.START,this.circle=!0;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(d.Track),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s}onDisable(){this.s3d.removeSelf(),S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=.5*Laya.timer.delta;if(this.tar&&this.circle){let s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x)-Math.atan2(-this.norV3.y,this.norV3.x);if(l<0&&(l+=2*Math.PI),l<=.2){this.circle=!1;let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3),this.tar=null}else{this.angle-=this.xv*e/2;let t=Math.tan(this.angle/180*Math.PI),s=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-t,0),s),(this.angle>90&&this.angle<270||this.angle<-90&&this.angle>-270)&&(s.x=-s.x,s.y=-s.y),this.norV3.x=s.x,this.norV3.y=s.y}}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/128*e,0,this.norV3.y/128*e)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class I extends f{constructor(){super(),this.ins=X.instance,this.enemyCom=null,this.skill1Pre=null,this.skill3Pre=null,this.skill5Pre=null,this.skillLinePre=null,this.skillRotatePre=null,this.skill10Pre=null,this.skill11Pre=null,this.skill13Pre=null,this.lines=[],this.skill1Pre=this.getRes(p.battle.EnemySkill1),this.skill3Pre=this.getRes(p.battle.EnemySkill3),this.skill5Pre=this.getRes(p.battle.EnemySkill5),this.skillLinePre=this.getRes(p.battle.EnemyLine),this.skillRotatePre=this.getRes(p.battle.EnemySkill9),this.skill10Pre=this.getRes(p.battle.EnemySkill10),this.skill11Pre=this.getRes(p.battle.EnemySkill11),this.skill13Pre=this.getRes(p.battle.EnemySkill13)}onEnable(){this.enemyCom=this.owner.getComponent(U),this.enemyCom&&this.enemyCom.edata}initSkill(){const t=this.enemyCom.edata,e=r.enemys[t.type];if(e.skill){const s=e.skill,i=e.shooting;if("number"==typeof s)7==s&&(this.enemyCom.isRotate=!0),13==s?(this.enemyCom.isRotSelf=!0,this.enemyCom.isPauseSelf=!0,S.on(V.EnemyPause,this,this.skill13)):Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState==C.START)if(t.type>2e3)S.event(V.EnemyHit,t.type);else{this["skill"+s]&&this["skill"+s]()}});else if("string"==typeof s){const e=s.split("|"),l=i.split("|");const a=s=>{Laya.timer.once(1e3*parseInt(l[s]),this,()=>{if(this.ins.gameState==C.START){if(t.type>2e3)S.event(V.EnemyHit,[t.type,e[s]]);else{this["skill"+e[s]]&&this["skill"+e[s]]()}++s>=e.length&&(s=0),a(s)}})};a(0)}}}onDisable(){for(let t=0;t<this.lines.length;t++){this.lines[t].removeSelf()}this.lines.length=0,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}skill1(){const t=this.owner,e=this.enemyCom.edata,s=[-10,10];for(let i=0;i<s.length;i++){const l=this.open(p.battle.EnemySkill1,this.skill1Pre);let a=l.getComponent(_);a||(a=l.addComponent(_)),a.setData(e.att,0,0,0,0);const n=l.getComponent(W);n.norV3=this.getVec3(0,1),n.state=C.START,l.pos(t.x+s[i],t.y),this.ins.eneBulNode.addChild(l)}}skill2(){this.ins;const t=this.enemyCom.edata,e=this.owner,s=[-20,20];let i=0;this.schedule(50,()=>{const l=this.open(p.battle.EnemySkill1,this.skill1Pre);let a=l.getComponent(_);a||(a=l.addComponent(_)),a.setData(t.att,0,0,0,0);const n=l.getComponent(W);n.norV3=this.getVec3(0,1),n.state=C.START,l.pos(e.x+s[i],e.y),this.ins.eneBulNode.addChild(l),++i>1&&(i=0)},this,10)}skill3(){const t=this.ins,e=this.enemyCom.edata,s=this.owner,i=[110,70,100,80];let l=0;this.schedule(200,()=>{const a=this.open(p.battle.EnemySkill3,this.skill3Pre);let n=a.getComponent(_);n||(n=a.addComponent(_)),n.setData(e.att,0,0,0,0);const o=a.getComponent(j);o.norV3=this.getVec3(0,-1),o.angle=i[l],o.xv=i[l]>90?-1:1,o.tar=this.getVec2(t.playerV2.x,t.playerV2.y),a.pos(s.x,s.y),this.ins.playerNode.addChild(a),l++},this,4)}skill4(){this.ins;const t=this.enemyCom.edata,e=this.owner,s=[this.getVec3(-.34,.94),this.getVec3(-.17,.98),this.getVec3(.17,.98),this.getVec3(.34,.94)];let i=0;this.schedule(200,()=>{const l=this.open(p.battle.EnemySkill3,this.skill3Pre);let a=l.getComponent(_);a||(a=l.addComponent(_)),a.setData(t.att,0,0,0,0);const n=l.getComponent(j);n.norV3=s[i].clone(),n.angle=0,n.xv=1,n.tar=null,l.pos(e.x,e.y),this.ins.playerNode.addChild(l),i++},this,4)}skill5(){const t=this.owner,e=this.enemyCom.edata,s=[-40,-20,20,40];for(let i=0;i<s.length;i++){const l=this.open(p.battle.EnemySkill5,this.skill5Pre);let a=l.getComponent(_);a||(a=l.addComponent(_)),a.setData(e.att,0,0,0,0);const n=l.getComponent(W);n.norV3=this.getVec3(0,1),n.state=C.READY,l.pos(t.x+s[i],t.y),this.ins.eneBulNode.addChild(l),Laya.Tween.to(l,{y:t.y+100},500,null,Laya.Handler.create(this,()=>{const t=this.ins.playerV2;Laya.timer.once(1e3,this,()=>{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(t.x+s[i],t.y),this.getVec3(l.x,l.y),e),Laya.Vector3.normalize(e,n.norV3),n.state=C.START})}))}}skill6(){const t=this.owner,e=this.enemyCom.edata,s=[this.getVec3(-.17,.98),this.getVec3(0,1),this.getVec3(.17,.98)];this.schedule(100,()=>{for(let i=0;i<s.length;i++){const l=this.open(p.battle.EnemySkill1,this.skill1Pre);let a=l.getComponent(_);a||(a=l.addComponent(_)),a.setData(e.att,0,0,0,0);const n=l.getComponent(W);n.norV3=s[i].clone(),n.state=C.START,l.pos(t.x,t.y+20),this.ins.eneBulNode.addChild(l)}},this,5)}skill7(){const t=this.owner,e=this.enemyCom.edata,s=[[0,0],[-1,1],[1,1],[-2,2],[0,2],[2,2]],i=this.open(p.battle.EnemyLine,this.skillLinePre);i.getComponent(H).tar=t,i.pos(t.x,t.y),this.ins.bgTopNode.addChild(i),this.lines.push(i),Laya.timer.once(1e3,this,()=>{if(i.removeSelf(),this.lines.splice(this.lines.indexOf(i),1),this.ins.gameState==C.START)for(let i=0;i<s.length;i++){const l=this.open(p.battle.EnemySkill1,this.skill1Pre);let a=l.getComponent(_);a||(a=l.addComponent(_)),a.setData(e.att,0,0,0,0);const n=l.getComponent(W);n.norV3=this.getVec3(0,1);let o=this.getVec3();const r=this.ins.playerV2;let h=10*s[i][0],c=20*s[i][1];l.pos(t.x+h,t.y+c),Laya.Vector3.subtract(this.getVec3(r.x+h,r.y+c),this.getVec3(l.x,l.y),o),Laya.Vector3.normalize(o,n.norV3),n.state=C.START,this.ins.eneBulNode.addChild(l)}})}skill8(){const t=this.owner,e=this.enemyCom.edata,s=[[0,0],[-1,1],[1,1],[-2,2],[2,2],[-3,3],[3,3],[-2,4],[2,4],[-1,5],[1,5],[0,6]];for(let i=0;i<s.length;i++){const l=this.open(p.battle.EnemySkill1,this.skill1Pre);let a=l.getComponent(_);a||(a=l.addComponent(_)),a.setData(e.att,0,0,0,0);const n=l.getComponent(W);n.norV3=this.getVec3(0,1);let o=20*s[i][0],r=20*s[i][1];l.pos(t.x+o,t.y+r),n.state=C.START,this.ins.eneBulNode.addChild(l)}}skill9(){const t=this.owner,e=this.enemyCom.edata,s=[this.getVec3(0,-1),this.getVec3(.03,-1),this.getVec3(.07,-1),this.getVec3(.1,-.99),this.getVec3(.14,-.99),this.getVec3(.17,-.98),this.getVec3(.98,-.17),this.getVec3(.99,-.14),this.getVec3(.99,-.1),this.getVec3(.99,-.07),this.getVec3(1,-.03),this.getVec3(1,0),this.getVec3(.5,.87),this.getVec3(.47,.88),this.getVec3(.44,.9),this.getVec3(.41,.91),this.getVec3(.37,.93),this.getVec3(.34,.94),this.getVec3(-.5,.87),this.getVec3(-.53,.85),this.getVec3(-.56,.83),this.getVec3(-.59,.81),this.getVec3(-.62,.79),this.getVec3(-.64,.77),this.getVec3(-.98,-.17),this.getVec3(-.98,-.21),this.getVec3(-.97,-.24),this.getVec3(-.96,-.28),this.getVec3(-.95,-.31),this.getVec3(-.94,-.34)],i=this.open(p.battle.EnemySkill9,this.skillRotatePre);i.pos(t.x,t.y+30),this.ins.eneBulNode.addChild(i),Laya.Tween.to(i,{y:t.y+230},3e3),Laya.timer.once(4e3,this,()=>{if(i.removeSelf(),this.ins.gameState==C.START)for(let t=0;t<s.length;t++){const l=this.open(p.battle.EnemySkill1,this.skill1Pre);let a=l.getComponent(_);a||(a=l.addComponent(_)),a.setData(e.att,0,0,0,0);const n=l.getComponent(W);let o,r;if(n.norV3=s[t],t<=5){let e=25*s[0].x,i=25*s[0].y;o=e+=10*(t-0),r=i-=10*(t-0)}else if(t>5&&t<=11){let e=25*s[6].x,i=25*s[6].y;o=e+=10*(t-6),r=i+=5*(t-6)}else if(t>11&&t<=17){let e=25*s[12].x,i=25*s[12].y;o=e-=5*(t-12),r=i+=10*(t-12)}else if(t>17&&t<=23){let e=25*s[18].x,i=25*s[18].y;o=e-=10*(t-18),r=i-=2*(t-18)}else if(t>23&&t<=29){let e=25*s[24].x,i=25*s[24].y;o=e-=5*(t-24),r=i-=10*(t-24)}l.pos(i.x+o,i.y+r),n.state=C.START,this.ins.eneBulNode.addChild(l)}})}skill10(){const t=this.owner,e=this.enemyCom.edata,s=[[-100,50],[-50,75],[0,100],[50,75],[100,50]];for(let i=0;i<s.length;i++){const l=this.open(p.battle.EnemySkill10,this.skill10Pre);let a=l.getComponent(_);a||(a=l.addComponent(_)),a.setData(e.att,0,0,0,0);const n=l.getComponent(W);n.norV3=this.getVec3(0,1),n.state=C.READY,l.pos(t.x+s[i][0],t.y),this.ins.eneBulNode.addChild(l),Laya.Tween.to(l,{y:t.y+s[i][1]},500,null,Laya.Handler.create(this,()=>{this.ins.playerV2;Laya.timer.once(1e3,this,()=>{let t=this.getVec3(),e=this.ins.playerV2;Laya.Vector3.subtract(this.getVec3(e.x,e.y),this.getVec3(l.x,l.y),t),Laya.Vector3.normalize(t,n.norV3),n.state=C.START})}))}}skill11(){const t=this.owner,e=this.enemyCom.edata,s=[this.getVec3(.87,-.5),this.getVec3(-.5,-.87),this.getVec3(-.87,.5),this.getVec3(.5,.87)],i=[-200,200];for(let l=0;l<i.length;l++){const a=this.open(p.battle.EnemySkill11,this.skill11Pre);a.pos(t.x,t.y+30),this.ins.eneBulNode.addChild(a),Laya.Tween.to(a,{x:t.x+i[l],y:t.y+230},3e3),Laya.timer.once(6e3,this,()=>{a.removeSelf()}),Laya.timer.once(3e3,this,()=>{let t=0;this.schedule(250,()=>{if(this.ins.gameState!=C.START)return;const i=this.open(p.battle.EnemySkill1,this.skill1Pre);let n=i.getComponent(_);n||(n=i.addComponent(_)),n.setData(e.att,0,0,0,0);const o=i.getComponent(W);o.norV3=s[t].clone(),l&&(o.norV3.x*=-1),i.pos(a.x,a.y),o.state=C.START,this.ins.eneBulNode.addChild(i),++t>=s.length&&(t=0)},this,12)})}}skill13(t){if(t!=this.enemyCom.eid)return;const e=this.owner,s=this.enemyCom.edata,i=this.enemyCom.norV3;let l=Math.atan2(-i.y,i.x);for(let t=0;t<2;t++){const i=this.open(p.battle.EnemySkill13,this.skill13Pre);let a=i.getComponent(_);a||(a=i.addComponent(_)),a.setData(s.att,0,0,0,0);let n=l+(t?Math.PI/2:-Math.PI/2),o=e.x+100*Math.cos(n),r=e.y-100*Math.sin(n);i.pos(o,r),this.ins.eneBulNode.addChild(i)}}}var N;!function(t){t[t.Move=0]="Move",t[t.Pause=1]="Pause",t[t.End=2]="End"}(N||(N={}));class U extends f{constructor(){super(),this.ins=X.instance,this.timer=0,this._norV3=null,this.btimer=0,this.start=null,this.end=null,this.pt=null,this.bspeed=.02,this.endMsg=!1,this.moveTime=0,this.pauseTime=0,this.pauseMsg=!1,this.eskillCom=null,this.eid=null,this.state=C.START,this.moveState=N.Move,this.edata=null,this.isRotate=!1,this.isRotSelf=!1,this.isPauseSelf=!1,U.__eid__++,this.eid=U.__eid__}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&this.isRotSelf&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){if(this.state=C.START,this.moveState=N.Move,this.timer=0,this.btimer=0,this.moveTime=0,this.pauseTime=0,this.pauseMsg=!1,this.endMsg=!1,!this.edata)return;this.eskillCom=this.owner.getComponent(I);const i=this.edata,l=this.owner;this.start=i.in.clone(),i.direntry==s.Top?this.start.y-=l.height:i.direntry==s.Left?this.start.x-=l.width:i.direntry==s.Right?this.start.x+=l.width:i.direntry==s.Top&&(this.start.y+=l.height);const a=this.start;if(l.pos(a.x,a.y),i.out){this.end=i.out.clone(),i.return==e.Repeat&&(i.direxit==s.Top?this.end.y-=l.height:i.direxit==s.Left?this.end.x-=l.width:i.direxit==s.Right?this.end.x+=l.width:i.direxit==s.Top&&(this.end.y+=l.height));const n=this.end;if(i.route==t.Line){let t=this.getVec3(),e=this.getVec3();Laya.Vector3.subtract(this.getVec3(n.x,n.y),this.getVec3(a.x,a.y),t),Laya.Vector3.normalize(t,e),this.norV3=e}else if(i.route==t.DownCurve){let t=2*(a.x+(n.x-a.x)/4)-(a.x+n.x)/2,e=2*(a.y+(n.y-a.y)/4*3)-(a.y+n.y)/2,s=this.getVec2(t,e);this.pt=s}else if(i.route==t.UpCurve){let t=2*(n.x-(n.x-a.x)/4)-(a.x+n.x)/2,e=2*(n.y-(n.y-a.y)/4*3)-(a.y+n.y)/2,s=this.getVec2(t,e);this.pt=s}}else{this.end=this.getVec2(a.x,i.in.y+i.distance);let t=this.end,e=this.getVec3(),s=this.getVec3();Laya.Vector3.subtract(this.getVec3(t.x,t.y),this.getVec3(a.x,a.y),e),Laya.Vector3.normalize(e,s),this.norV3=s}let n=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.end.x,this.end.y),this.getVec3(a.x,a.y),n);let o=Math.sqrt(n.x*n.x+n.y*n.y);this.bspeed=.02/(o/300)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.recover(this.owner)}bezier(t,e,s,i,l){l?(t.x=(1-e)*(1-e)*s.x+2*e*(1-e)*l.x+e*e*i.x,t.y=(1-e)*(1-e)*s.y+2*e*(1-e)*l.y+e*e*i.y):(t.x=s.x+(i.x-s.x)*e,t.y=s.y+(i.y-s.y)*e)}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;if(!this.edata)return;const s=this.owner,i=this.edata;let l=Laya.timer.delta;if(this.moveState==N.Move){if(this.btimer>=1){if(this.endMsg||(this.endMsg=!0,this.eskillCom&&this.eskillCom.initSkill()),"number"==typeof i.return){const t=i.return;if(t==e.Return){const t=this.start.clone();this.start=this.end.clone(),this.end=t,this.norV3&&(this.norV3=this.getVec3(-this.norV3.x,-this.norV3.y))}else e.Repeat;this.btimer=0}else this.moveState=N.End;return}if(this.moveTime>=1e3)return this.moveState=N.Pause,void(this.moveTime=0);const a=this.start,n=this.end;i.route==t.Line?(this.btimer+=this.bspeed,s.x=a.x+(n.x-a.x)*this.btimer,s.y=a.y+(n.y-a.y)*this.btimer,this.isPauseSelf&&(this.moveTime+=l)):(this.btimer+=this.bspeed,this.bezier(s,this.btimer,this.start,this.end,this.pt))}if(this.moveState==N.Pause){if(this.pauseTime>=500)return this.moveState=N.Move,this.pauseTime=0,void(this.pauseMsg=!1);this.pauseMsg||(this.pauseMsg=!0,S.event(V.EnemyPause,this.eid)),this.pauseTime+=l}if(this.moveState==N.End){this.timer+=Laya.timer.delta/1e3;let t=Math.cos(this.timer);s.x+=t}if(this.isRotate){let t=this.ins.playerV2,e=s.x-t.x,i=s.y-t.y;s.rotation=Math.atan2(e,-i)/Math.PI*180}}}U.__eid__=0;class q extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.enemyCom=null,this.hpBar=null,this.barPor=1,this.hp=0,this.timers={}}onEnable(){const t=this.owner;this.hpBar=t.getChildByName("hpBar"),this.selfCol=this.owner.getComponent(v),this.enemyCom=this.owner.getComponent(U),this.hp=this.enemyCom.edata.hp,this.hpBar.value=1,this.barPor=1,S.on(V.LaserHide,this,t=>{let e=this.selfCol.bids.indexOf(t.bid);e>-1&&(this.selfCol.bids.splice(e,1),this.onCollisionExit(t,this.selfCol))}),S.on(V.GameStateChange,this,()=>{if(this.ins.gameState==C.PAUSE)for(const t in this.timers){const e=this.timers[t];e&&e.hit&&e.hit.removeSelf()}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this);for(const t in this.timers){const e=this.timers[t];e&&e.timer&&clearInterval(e.timer),e&&e.hit&&e.hit.removeSelf()}this.timers={}}onCollision(t,e){if(this.ins.gameState!=C.START)return;const s=this.owner;if(!s||!s.parent)return void this.onDisable();if(s.x<=-10||s.x>=730||s.y<=-10||s.y>=1290)return;if(!e||!e.owner||!e.owner.getComponent(_))return;const i=e.owner.getComponent(_).data,l=this.ins.playerData.skills;if(l[P.Cri]){h.skills[P.Cri].value}if(this.hp-=i.attack,console.log("hp -> ",this.hp),this.barPor=this.hp/this.enemyCom.edata.hp,l[P.SuckBlood]){h.skills[P.SuckBlood].value}const a=this.open(p.battle.EnemyHPTip,this.ins.eneHPTipPre);a.text=`-${i.attack}`,a.pos(t.x,this.owner.y),this.ins.effectNode.addChild(a),this.hp<=0&&(this.onDisable(),this.owner.removeSelf(),S.event(V.EnemyDead,this.selfCol),this.makeBoom(this.enemyCom.edata.type),this.makeCoin(),l[P.DieBoom]&&this.makeDieBoom(),l[P.DieShot]&&this.makeDieShot())}makeBoom(t){const e=this.getRes(p.battle.EnemyBoom),s=this.open(p.battle.EnemyBoom,e);s.__$type$__=t;const i=this.owner;s.x=i.x,s.y=i.y,this.ins.effectNode.addChild(s)}makeCoin(){const t=this.getRes(d.Coin),e=Laya.Sprite3D.instantiate(t),s=this.ins,i=this.owner;let l=this.getVec3();s.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(i.x,i.y),l),e.transform.position=l,e.transform.localScale=this.getVec3(10,10,10),e.transform.rotationEuler=this.getVec3(-90,0,0),e.addComponent(B),s.modSceneV3.addChild(e)}makeDieBoom(){const t=this.ins.playerData,e=this.getRes(p.battle.PlayerDieBoom),s=this.open(p.battle.PlayerDieBoom,e),i=this.owner;s.x=i.x,s.y=i.y;let l=s.getComponent(_);l||(l=s.addComponent(_));const a=h.skills[P.DieBoom].value||1;l.setData(t.attack*a,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr),this.ins.effectNode.addChild(s)}makeDieShot(){const t=this.owner,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(.71,-.71),this.getVec3(1,0),this.getVec3(.71,.71),this.getVec3(0,1),this.getVec3(-.71,.71),this.getVec3(-1,0),this.getVec3(-.71,-.71)],i=this.getRes(p.battle.PlayerDieShot);for(let l=0;l<8;l++){const a=this.open(p.battle.PlayerDieShot,i),n=a.getComponent(M);let o=a.getComponent(_);o||(o=a.addComponent(_));const r=h.skills[P.DieShot].value||1;o.setData(e.attack*r,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),n.speed=.8,n.norV3=s[l].clone(),n.state=C.START,n.tar=null,a.pos(t.x,t.y),this.ins.playerNode.addChild(a)}}onCollisionEnter(t,e,s){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;let i=t.owner.__type__,l=t.owner;if((s||i&&i==x.MAGNET)&&(l=e.owner),this.onCollision(l,t),i&&i==x.POISON&&this.schedule(1e3,()=>{this.onCollision(e.owner,t)},this,4,null,!0),i&&i==x.ICE&&(this.enemyCom.state=C.PAUSE,Laya.timer.once(3e3,this,()=>{this.enemyCom.state=C.START})),this.timers&&i&&i==x.LASER){let e=setInterval(()=>{this.onCollision(l,t)},200);const s=()=>{if(this.ins.gameState!=C.START)return;const t=this.getRes(p.battle.PlayerLaserHit),e=this.open(p.battle.PlayerLaserHit,t);e.x=l.x,e.y=this.owner.y;const s=e.getComponent(R);return s.xp=l,s.yp=this.owner,this.ins.effectNode.addChild(e),e},i=this.timers[t.bid];if(i)if(i.timer&&clearInterval(i.timer),this.timers[t.bid].timer=e,i.hit){const t=i.hit.getComponent(R);t.xp=l,t.yp=this.owner}else{const e=s();this.timers[t.bid].hit=e}else{const i=s();this.timers[t.bid]={timer:e,hit:i}}}}onCollisionExit(t,e){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;let s=t.owner.__type__;if(s&&s==x.LASER){if(!this.timers)return;const e=this.timers[t.bid];e&&(e.timer&&clearInterval(e.timer),e&&e.hit&&e.hit.removeSelf(),this.timers[t.bid]=null)}}onLateUpdate(){let t=this.getVec3();Laya.Vector3.lerp(this.getVec3(this.hpBar.value),this.getVec3(this.barPor),.01*Laya.timer.delta,t),this.hpBar.value=t.x}}class O{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.speed=0,this.fspeed=0,this.eneHurtStr=0,this.bosHurtStr=0,this.hp=0,this.currHP=0,this.defense=0,this.subHurt=0,this.id=0,this.chapter=1,this.rate=1,this.exp=0,this.level=1,this.skills={},this.rewards={},this.track=!1,this.cross=!1,this.unlock=[],this.laserSta=0,this.trackTar=null,this.trackBox=null,this.trackCol=null}init(){this.attack=c.attack,this.crit=30,this.critHurt=1,this.speed=1,this.fspeed=1,this.eneHurtStr=1,this.bosHurtStr=1,this.hp=c.hp,this.currHP=c.hp,this.defense=0,this.subHurt=0,this.id=1,this.exp=0,this.level=1,this.rate=1,this.skills={},this.rewards={};const t=o.basChapter.unlockskill;for(let e=0;e<t.length;e++){h.skills[t[e]].add!=n.Supply&&this.unlock.push(t[e])}}setSkill(t){this.skills[t]?this.skills[t]++:this.skills[t]=1}}class Y extends f{constructor(){super(),this.ins=X.instance}onEnable(){}onDisable(){}onLateUpdate(){if(this.ins.gameState!=C.START)return;const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),i=this.getVec3();Laya.Vector3.lerp(s,this.ins.playerPosV2,15*e,i),t.pos(i.x,i.y)}}class X extends f{constructor(){super(),this.bgPre=null,this.eneHPTipPre=null,this.enemyNode=null,this.bgTopNode=null,this.eneBulNode=null,this.playerNode=null,this.effectNode=null,this.dialogNode=null,this.bgSceneV2=null,this.modSceneV3=null,this.modCameraV3=null,this.playerV3=null,this.playerV2=null,this.playerHPV2=null,this.plaLassV2=[],this.plaWingsV2=[],this.playerPosV3=new Laya.Vector3(0,0,0),this.playerPosV2=new Laya.Vector3(360,900,0),this.touchX=0,this.touchY=0,this.rotationZ=0,this.lastX=0,this.playerData=null,this._gameState=C.READY,this.enemyCols=[],this.playerCols=[],X.instance=this;const t=Laya.stage.addChild(new Laya.Scene);t.zOrder=-2,this.bgSceneV2=t;const e=Laya.stage.addChild(new Laya.Scene3D);e.zOrder=-1,this.modSceneV3=e;const s=e.addChild(new Laya.Camera(0,.1,1e3));this.modCameraV3=s,s.clearFlag=Laya.CameraClearFlags.Nothing,s.clearColor=new Laya.Vector4(0,0,0,0),s.transform.rotate(new Laya.Vector3(-90,0,0),!1,!1),s.orthographic=!0,s.orthographicVerticalSize=10;const i=e.addChild(new Laya.DirectionLight);i.color=new Laya.Vector3(1,1,1),i.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0)),this.bgPre=this.getRes(p.battle.BgNode),this.eneHPTipPre=this.getRes(p.battle.EnemyHPTip)}set gameState(t){this._gameState=t,S.event(V.GameStateChange)}get gameState(){return this._gameState}onEnable(){const t=this.open(p.battle.BgNode,this.bgPre);this.bgSceneV2.addChild(t),this.enemyNode=this.bgSceneV2.addChild(new Laya.Sprite),this.bgTopNode=this.bgSceneV2.addChild(new Laya.Sprite),this.gameState=C.READY,this.playerData=new O,this.playerData.init(),S.on(V.LaserTrack,this,this.getTrackEnemy),S.on(V.EnemyDead,this,t=>{this.enemyCols.splice(this.enemyCols.indexOf(t),1);this.playerData;this.enemyCols.length||Laya.timer.once(2e3,this,()=>{S.event(V.RateEnd)}),2==this.playerData.laserSta&&this.playerData.trackBox&&t.bid==this.playerData.trackBox.bid&&this.getTrackEnemy()}),S.on(V.LevelEnemyEnd,this,()=>{2==this.playerData.laserSta&&this.getTrackEnemy()}),S.on(V.GameOver,this,()=>{this.playerV3.removeSelf(),this.playerV3=null,this.playerV2.removeSelf(),this.playerV2=null,this.playerHPV2.removeSelf(),this.playerHPV2=null;for(let t=0;t<this.plaLassV2.length;t++)this.plaLassV2[t].removeSelf();for(let t=0;t<this.plaWingsV2.length;t++)this.plaWingsV2[t].removeSelf()})}onDisable(){this.bgSceneV2.destroy(!0),this.modSceneV3.destroy(!0),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}getTrackEnemy(){let t=this.getMinEnemy(this.playerV2);t?(this.playerData.trackTar=t,this.playerData.trackBox=t.getComponent(v),this.playerData.trackCol=t.getComponent(q)):(this.playerData.trackTar=null,this.playerData.trackBox=null,this.playerData.trackCol=null),S.event(V.LaserTrackTar)}getMinEnemy(t){let e=null,s=null;for(let i=0;i<this.enemyCols.length;i++){const l=this.enemyCols[i].owner;if(!l||!l.parent)continue;let a=l.x-t.x,n=l.y-t.y,o=a*a+n*n;(!e||o<e)&&(e=o,s=l)}return s}onStageMouseDown(t){this.gameState==C.START&&(this.touchX=t.stageX,this.touchY=t.stageY)}onStageMouseMove(t){if(this.gameState!=C.START)return;let e=t.stageX-this.touchX,s=t.stageY-this.touchY;this.rotationZ-=e/8,Math.abs(this.rotationZ)>45&&(this.rotationZ*=.7),this.touchX=t.stageX,this.touchY=t.stageY;let i=this.playerPosV2.x+e,l=this.playerPosV2.y+s;i>=0&&i<=720&&(this.playerPosV2.x=i),l>=0&&l<=1280&&(this.playerPosV2.y=l),this.modCameraV3.convertScreenCoordToOrthographicCoord(this.playerPosV2,this.playerPosV3)}onStageMouseUp(t){this.gameState==C.START&&(this.touchX=0,this.touchY=0,this.rotationZ=0,this.playerV3.transform.localRotationEulerZ=0)}onLateUpdate(){if(this.gameState!=C.START)return;let t=Laya.timer.delta/1e3;if(this.playerV3){let e=this.playerV3.transform.position,s=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(e,this.playerPosV3,15*t,s),this.playerV3.transform.position=s,Math.abs(this.playerV3.transform.position.x-this.lastX)<=.02&&(this.rotationZ=0);let i=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(this.playerV3.transform.localRotationEuler,this.getVec3(0,0,this.rotationZ),15*t,i),this.playerV3.transform.localRotationEuler=i,this.lastX=this.playerV3.transform.position.x}}}class z extends f{constructor(){super(),this.ins=X.instance,this.laser=null,this.laser2=null,this.deltaX=0,this.deltaY=0}onEnable(){this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER),this.laser2&&(this.laser2.blendMode=Laya.BlendMode.LIGHTER)}onDisable(){}onLateUpdate(){if(this.ins.gameState!=C.START)return;const t=this.owner;let e=this.ins.playerV2;t.pos(e.x+this.deltaX,e.y+this.deltaY)}}class G extends f{constructor(){super(),this.ins=X.instance,this._norV3=null,this.speed=.1}get norV3(){return this._norV3}set norV3(t){this._norV3=t}onEnable(){}onDisable(){}onLateUpdate(){if(this.ins.gameState!=C.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class F extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this._norV3=null,this.state=C.READY,this.radius=100,this.angle=0}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner;this.selfCol=this.owner.getComponent(v),this.ins.playerCols.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol),this.state=C.START}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins;if(t.gameState!=C.START)return;if(this.state!=C.START)return;const e=this.owner;let s=Laya.timer.delta/200;this.angle+=s,e.rotation=-180-this.angle/Math.PI*180,e.x=t.playerV2.x+this.radius*Math.cos(this.angle),e.y=t.playerV2.y-this.radius*Math.sin(this.angle)}}class Q extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=C.READY,this.speed=.8}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.state=C.START}onDisable(){S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(X.instance.enemyCols,this.selfCol)}}class $ extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.speed=2.5,this.state=C.READY,this.delta=0}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.state=C.START}onDisable(){S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0-this.delta||t.x>=720+this.delta||t.y<=0-this.delta||t.y>=1280+this.delta)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class Z extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.angle=0,this.state=C.READY,this.js=!1,this.tar=null,this.pangle=0,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.angle=0,this.js=!1,this.state=C.START;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(d.Track),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s}onDisable(){this.s3d.removeSelf(),S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=.5*Laya.timer.delta;if(this.js){if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i),Laya.Vector3.lerp(this.norV3,i,e/50,l),this.norV3=l,e*=2}}else{if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let a=Math.atan2(-i.y,i.x);Laya.Vector3.lerp(this.getVec3(this.pangle),this.getVec3(a),e/100,l),this.pangle=l.x;let n=this.tar.x-t.x,o=this.tar.y-t.y;n*n+o*o<=9e4&&(this.js=!0)}this.angle+=5;let s=Math.atan(Math.cos(this.angle/180*Math.PI)),i=.7*Math.tan(s),l=new Laya.Vector3(0,0,0),a=this.pangle,n=1*Math.cos(a)+i*Math.sin(a),o=i*Math.cos(a)-1*Math.sin(a);Laya.Vector3.normalize(this.getVec3(n,o),l),this.norV3=l}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/128*e,0,this.norV3.y/128*e)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class J extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=C.READY,this.angle=0,this.type=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner.__type__=this.type?this.type:x.POISON,this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.state=C.START}onDisable(){S.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=Laya.timer.delta/200;this.angle+=e,t.rotation=-180-this.angle/Math.PI*180,t.x=this.ins.playerV2.x+200*Math.cos(this.angle),t.y=this.ins.playerV2.y-200*Math.sin(this.angle),this.quadTree.check(X.instance.enemyCols,this.selfCol)}}class K extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=C.READY,this.move=!0,this.getTar=!1,this.timer=0,this.deltaY=0,this.startGet=0,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.move=!0,this.getTar=!1,this.timer=0,this.deltaY=0,this.startGet=0,this.state=C.READY,S.on(V.BulSkill7_Start,this,()=>{this.state=C.START})}onDisable(){S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=.5*Laya.timer.delta;if(this.move)if(this.deltaY>=200)this.move=!1,this.deltaY=0,this.startGet++;else{t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180);let s=e*this.norV3.x;t.x+=s;let i=e*this.norV3.y;t.y+=i,this.deltaY+=Math.abs(i)}else if(this.timer>=300)this.move=!0,this.getTar=!1,this.timer=0;else{if(!this.getTar){this.getTar=!0;let e=this.ins.getMinEnemy(this.owner);if(this.startGet>=2&&e&&e.parent){let s=this.getVec3();Laya.Vector3.subtract(this.getVec3(e.x,e.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,this.norV3)}else this.norV3.x=-this.norV3.x}this.timer+=Laya.timer.delta}(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class tt extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.t=0,this.circle=!1,this.bezierd=!1,this.start=null,this.pt=null,this.state=C.START,this.tar=null,this.speed=1,this.cross=!1}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.t=0,this.circle=!1,this.bezierd=!1}onDisable(){this.recover(this.owner)}bezier(t,e,s,i,l){t.x=(1-e)*(1-e)*s.x+2*e*(1-e)*l.x+e*e*i.x,t.y=(1-e)*(1-e)*s.y+2*e*(1-e)*l.y+e*e*i.y;let a=2*((1-e)*(l.x-s.x)+e*(i.x-l.x)),n=2*((1-e)*(l.y-s.y)+e*(i.y-l.y)),o=this.getVec3();Laya.Vector3.normalize(this.getVec3(a,n,0),o),this.norV3=o}onCollisionEnter(t,e){this.cross||this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;if(this.tar&&this.tar.parent)if(t.y>=this.tar.y||this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.t=1,this.tar=null;else if(Math.abs(t.y-this.tar.y)<=500&&!this.bezierd){this.bezierd=!0,this.start=this.getVec3(t.x,t.y);let e=this.start,s=this.tar,i=2*(e.x+(s.x-e.x)/4)-(e.x+s.x)/2,l=2*(e.y+(s.y-e.y)/4*3)-(e.y+s.y)/2;this.pt=this.getVec3(i,l),this.circle=!0}if(this.circle&&this.tar&&this.tar.parent){if(this.t>=1)return void(this.circle=!1);this.t+=.021,this.bezier(t,this.t,this.start,this.getVec3(this.tar.x,this.tar.y),this.pt)}this.circle&&this.tar&&this.tar.parent||(t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class et extends f{constructor(){super(),this.ins=X.instance,this.deltaX=0,this.deltaY=0}onEnable(){}onDisable(){}onLateUpdate(){if(this.ins.gameState!=C.START)return;const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),i=this.getVec3(this.ins.playerPosV2.x+this.deltaX,this.ins.playerPosV2.y+this.deltaY),l=this.getVec3();Laya.Vector3.lerp(s,i,8*e,l),t.pos(l.x,l.y)}}class st extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this._norV3=null,this.circle=!0,this.state=C.READY,this.tar=null,this.angle=0,this.xv=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.state=C.START,this.circle=!0;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(d.Track),l=Laya.Sprite3D.instantiate(i);s.addChild(l),t.modSceneV3.addChild(s);let a=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),a),s.transform.position=a,this.s3d=s}onDisable(){this.s3d.removeSelf(),S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=1*Laya.timer.delta;if(this.tar&&this.tar.parent)if(this.circle){let s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x)-Math.atan2(-this.norV3.y,this.norV3.x);if(l<0&&(l+=2*Math.PI),l<=.2)this.circle=!1;else{this.angle+=this.xv*e/2;let t=Math.tan(this.angle/180*Math.PI),s=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-t,0),s),this.angle>90&&(s.x=-s.x,s.y=-s.y),this.norV3.x=s.x,this.norV3.y=s.y}}else{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/128*e,0,this.norV3.y/128*e)),(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class it extends f{constructor(){super(),this.ins=X.instance,this.wing2BPre=null,this.xv=1,this.wing2BPre=this.getRes(p.battle.PlayerWing2b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=h.skills[P.MissileWing];s.speed,s.fspeed;Laya.timer.loop(5e3,this,()=>{if(this.ins.gameState!=C.START)return;let i=0;for(let l=0;l<6;l++){let l=Math.floor(89*Math.random()+1),a=Math.tan(l/180*Math.PI),n=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,a,0),n),n.x*=this.xv,i+=Math.floor(251*Math.random()+50),Laya.timer.once(i,this,()=>{const i=this.open(p.battle.PlayerWing2b,this.wing2BPre);let a=i.getComponent(_);a||(a=i.addComponent(_));const o=s.value||1;a.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=i.getComponent(st);r.norV3=n,r.angle=this.xv>0?-l:l+180,r.xv=this.xv,r.tar=this.ins.getMinEnemy(t),i.pos(t.x,t.y),this.ins.playerNode.addChild(i)})}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}onLateUpdate(){}}class lt extends f{constructor(){super(),this.ins=X.instance,this.laser=null,this.tar=null,this.deltaX=0,this.deltaY=0}onEnable(){this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER)}onDisable(){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(!this.tar)return;const t=this.owner;let e=this.tar;t.pos(e.x+this.deltaX,e.y+this.deltaY)}}class at extends f{constructor(){super(),this.ins=X.instance,this.wing3BPre=null,this.xv=1,this.wing3BPre=this.getRes(p.battle.PlayerWing3b)}onEnable(){const t=this.ins.playerData,e=this.open(p.battle.PlayerWing3b,this.wing3BPre);let s=e.getComponent(_);s||(s=e.addComponent(_));const i=h.skills[P.LaserWing].value||1;s.setData(t.attack*i,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr);let l=this.owner;e.getComponent(lt).tar=l,e.pos(l.x,l.y),this.ins.playerNode.addChild(e)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}onLateUpdate(){}}class nt extends f{constructor(){super(),this.ins=X.instance,this.wing5BPre=null,this.xv=1,this.wing5BPre=this.getRes(p.battle.PlayerWing5b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=h.skills[P.ShotWing],i=[this.getVec3(.03,-1),this.getVec3(.07,-1),this.getVec3(.1,-.99),this.getVec3(.14,-.99),this.getVec3(.17,-.98),this.getVec3(.21,-.98)];let l=0;Laya.timer.loop(50,this,()=>{if(this.ins.gameState!=C.START)return;l>=6&&(l=0);const a=this.open(p.battle.PlayerWing5b,this.wing5BPre);let n=a.getComponent(_);n||(n=a.addComponent(_));const o=s.value||1;n.setData(e.attack*o,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const r=a.getComponent($);let h=i[l];r.norV3=this.getVec3(h.x*this.xv,h.y),r.speed=1,a.pos(t.x,t.y),this.ins.playerNode.addChild(a);const c=a.getChildByName("bi");c.height=0,Laya.Tween.clearAll(c),Laya.Tween.to(c,{height:66},100),l++})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}onLateUpdate(){}}class ot extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.state=C.READY,this._norV3=null,this.speed=.2}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.owner;this.state=C.START,this.selfCol=this.owner.getComponent(v),this.ins.playerCols.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class rt extends f{constructor(){super(),this.ins=X.instance,this.wing6BPre=null,this.wing6BPre=this.getRes(p.battle.PlayerWing6b)}onEnable(){const t=this.owner,e=h.skills[P.ShieldWing],s=e.speed||5,i=e.fspeed||.2;Laya.timer.loop(1e3*s,this,()=>{if(this.ins.gameState!=C.START)return;const e=this.open(p.battle.PlayerWing6b,this.wing6BPre),s=e.getComponent(ot);s.norV3=this.getVec3(0,-1),s.speed=i/5,e.pos(t.x,t.y),this.ins.playerNode.addChild(e)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}onLateUpdate(){}}class ht extends f{constructor(){super(),this.ins=null,this.plaBul1Pre=null,this.plaBulPre=null,this.skill1Pre=null,this.skill2Pre=null,this.skill3Pre=null,this.skill4Pre=null,this.skill5Pre=null,this.skill6Pre=null,this.skill7Pre=null,this.skill8Pre=null,this.skill9Pre=null,this.skill10Pre=null,this.plaWing1Pre=null,this.plaWing2Pre=null,this.plaWing3Pre=null,this.plaWing4Pre=null,this.plaWing5Pre=null,this.plaWing6Pre=null,this.plaRob1Pre=null,this.plaRob2Pre=null,this.plaRob3Pre=null,this.plaBul1Pre=this.getRes(p.battle.Player1Bullet),this.plaBulPre=this.getRes(p.battle.PlayerLaser),this.skill1Pre=this.getRes(p.battle.PlayerSkill1),this.skill2Pre=this.getRes(p.battle.PlayerSkill2),this.skill3Pre=this.getRes(p.battle.PlayerSkill3),this.skill4Pre=this.getRes(p.battle.PlayerSkill4),this.skill5Pre=this.getRes(p.battle.PlayerSkill5),this.skill6Pre=this.getRes(p.battle.PlayerSkill6),this.skill7Pre=this.getRes(p.battle.PlayerSkill7),this.skill8Pre=this.getRes(p.battle.PlayerSkill8),this.skill9Pre=this.getRes(p.battle.PlayerSkill9),this.skill10Pre=this.getRes(p.battle.PlayerSkill10),this.plaWing1Pre=this.getRes(p.battle.PlayerWing1),this.plaWing2Pre=this.getRes(p.battle.PlayerWing2),this.plaWing3Pre=this.getRes(p.battle.PlayerWing3),this.plaWing4Pre=this.getRes(p.battle.PlayerWing4),this.plaWing5Pre=this.getRes(p.battle.PlayerWing5),this.plaWing6Pre=this.getRes(p.battle.PlayerWing6),this.plaRob1Pre=this.getRes(p.battle.PlayerRobot1),this.plaRob2Pre=this.getRes(p.battle.PlayerRobot2),this.plaRob3Pre=this.getRes(p.battle.PlayerRobot3)}onEnable(){this.ins=X.instance,S.on(V.PlayerBullet,this,this.playerMainBullet),S.on(V.BaseSkill1,this,this.baseSkill1),S.on(V.BaseSkill1a,this,this.baseSkill1),S.on(V.BaseSkill1b,this,this.baseSkill1),S.on(V.BaseSkill2,this,this.baseSkill2),S.on(V.BaseSkill2a,this,this.baseSkill2),S.on(V.BaseSkill2b,this,this.baseSkill2),S.on(V.BaseSkill3,this,this.baseSkill3),S.on(V.BaseSkill4,this,this.baseSkill4),S.on(V.BaseSkill4a,this,this.baseSkill4),S.on(V.BaseSkill4b,this,this.baseSkill4),S.on(V.BaseSkill5,this,this.baseSkill5),S.on(V.BaseSkill5a,this,this.baseSkill5),S.on(V.BaseSkill5b,this,this.baseSkill5),S.on(V.BaseSkill6,this,this.baseSkill6),S.on(V.BaseSkill6a,this,this.baseSkill6),S.on(V.BaseSkill6b,this,this.baseSkill6),S.on(V.BaseSkill7,this,this.baseSkill7),S.on(V.BaseSkill9,this,this.baseSkill9),S.on(V.BaseSkill11,this,this.baseSkill11),S.on(V.BaseSkill13,this,this.baseSkill13),S.on(V.BaseSkill14,this,this.baseSkill14),S.on(V.BaseSkill15,this,this.baseSkill15),S.on(V.Shield,this,this.shield),S.on(V.TimeShield,this,this.timeShield),S.on(V.DieShot,this,this.dieShot),S.on(V.SuckBlood,this,this.suckBlood),S.on(V.DieBoom,this,this.dieBoom),S.on(V.BulSkill1,this,this.skill),S.on(V.BulSkill2,this,this.skill2),S.on(V.BulSkill3,this,this.skill3),S.on(V.BulSkill4,this,this.skill4),S.on(V.BulSkill5,this,this.skill5),S.on(V.BulSkill6,this,this.skill6),S.on(V.BulSkill7,this,this.skill7),S.on(V.BulSkill8,this,this.skill8),S.on(V.BulSkill9,this,this.skill9),S.on(V.BulSkill10,this,this.skill10),S.on(V.WingSkill1,this,this.wing1),S.on(V.WingSkill2,this,this.wing2),S.on(V.WingSkill3,this,this.wing3),S.on(V.WingSkill4,this,this.wing4),S.on(V.WingSkill5,this,this.wing5),S.on(V.WingSkill6,this,this.wing6),S.on(V.RobSkill1,this,this.robot1),S.on(V.RobSkill2,this,this.robot2),S.on(V.RobSkill3,this,this.robot3),window.__$4$__=this.skill4.bind(this)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}playerMainBullet(t){switch(t){case 1:this.player1Bullet();break;case 2:this.player2Bullet()}}player1Bullet(){const t=1e3*this.ins.playerData.speed;Laya.timer.clear(this,this.player1BulletCall),Laya.timer.loop(t,this,this.player1BulletCall)}player1BulletCall(){const t=this.ins,e=t.playerV2;if(t.gameState!=C.START)return;const s=t.playerData;let i=1,l=s.skills[P.MainStr]||0,a=w[s.id][l];l&&(i+=l);for(let l=0;l<i;l++){const i=this.open(p.battle.Player1Bullet,this.plaBul1Pre);i.getChildByName("boom").blendMode=Laya.BlendMode.LIGHTER;let n=i.getComponent(_);n||(n=i.addComponent(_)),n.setData(.18*s.attack,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);let o=i.getComponent(tt);o||(o=i.addComponent(tt)),o.norV3=this.getVec3(0,-1),o.state=C.START,o.tar=null,o.speed=s.fspeed,o.cross=s.cross,s.track&&(o.cross=!1,o.tar=t.getMinEnemy(e)),i.pos(e.x+a[l],e.y),this.ins.playerNode.addChild(i)}}player2Bullet(){const t=this.ins,e=t.playerData,s=this.open(p.battle.PlayerLaser,this.plaBulPre);let i=s.getComponent(_);i||(i=s.addComponent(_)),i.setData(.18*e.attack,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),s.pos(360,900),t.playerNode.addChild(s),t.plaLassV2.push(s)}baseSkill1(){const t=X.instance.playerData;let e=h.skills[P.HP1].value||1;t.hp*=e,t.currHP*=e,t.skills[P.HP1]?(t.setSkill(P.HP1+1),delete t.skills[P.HP1]):t.setSkill(P.HP1),S.event(V.PlayerMaxHP)}baseSkill2(){const t=X.instance.playerData;let e=h.skills[P.Attack1].value||1;t.attack*=e,t.skills[P.Attack1]?(t.setSkill(P.Attack1+1),delete t.skills[P.Attack1]):t.setSkill(P.Attack1)}baseSkill3(){const t=X.instance.playerData;let e=h.skills[P.HPRec1].value||.1,s=t.hp*e;t.currHP+s>t.hp?t.currHP=t.hp:t.currHP+=s,t.setSkill(P.HPRec1),S.event(V.PlayerHP)}baseSkill4(){const t=X.instance,e=t.playerData;let s=h.skills[P.Speed].value||1;if(e.speed/=s,e.skills[P.Speed]?(e.setSkill(P.Speed+1),delete e.skills[P.Speed]):e.setSkill(P.Speed),1==e.id&&this.playerMainBullet(e.id),2==e.id){let s=t.plaLassV2.length,i=t.playerPosV2;for(let e=0;e<t.plaLassV2.length;e++){t.plaLassV2[e].removeSelf()}t.plaLassV2.length=0;let l=w[2][s-1];for(let a=0;a<s;a++){const s=this.open(p.battle.PlayerLaser,this.plaBulPre);let n=s.getComponent(_);n||(n=s.addComponent(_)),n.setData(e.attack,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),s.getComponent(z).deltaX=l[a],s.pos(i.x+l[a],i.y),t.playerNode.addChild(s),t.plaLassV2.push(s)}}}baseSkill5(){const t=X.instance.playerData;let e=h.skills[P.Crit].value||1;t.crit*=e,t.critHurt*=e,t.skills[P.Crit]?(t.setSkill(P.Crit+1),delete t.skills[P.Crit]):t.setSkill(P.Crit)}baseSkill6(){const t=X.instance,e=t.playerData;switch(e.id){case 1:if(e.skills[P.MainStr]&&e.skills[P.MainStr]>1)return;break;case 2:let s=t.plaLassV2.length;if(s>=3)return;let i=t.playerPosV2;for(let e=0;e<t.plaLassV2.length;e++){t.plaLassV2[e].removeSelf()}t.plaLassV2.length=0;let l=w[2][s];for(let a=0;a<s+1;a++){const s=this.open(p.battle.PlayerLaser,this.plaBulPre);let n=s.getComponent(_);n||(n=s.addComponent(_)),n.setData(e.attack,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),s.getComponent(z).deltaX=l[a],s.pos(i.x+l[a],i.y),t.playerNode.addChild(s),t.plaLassV2.push(s)}}e.skills[P.MainStr]?(e.setSkill(P.MainStr+1),delete e.skills[P.MainStr]):e.setSkill(P.MainStr)}baseSkill7(){const t=X.instance,e=t.playerData;switch(t.playerData.id){case 1:t.playerData.cross=!0;break;case 2:t.playerData.laserSta||(t.playerData.laserSta=1,S.event(V.LaserCross))}e.setSkill(P.MainCross)}baseSkill9(){const t=X.instance,e=t.playerData;switch(t.playerData.id){case 1:t.playerData.track=!0;break;case 2:2!=t.playerData.laserSta&&(t.playerData.laserSta=2,S.event(V.LaserTrack))}e.setSkill(P.MainTrack)}shield(){const t=this.ins.playerV2,e=[this.getVec3(1,0),this.getVec3(-1,0)],s=this.getRes(p.battle.PlayerShield);Laya.timer.once(3e3,this,()=>{for(let i=0;i<2;i++){const l=this.open(p.battle.PlayerShield,s),a=l.getComponent(F);a.norV3=e[i].clone(),a.angle=i*Math.PI,l.pos(t.x+100*e[i].x,t.y+100*e[i].y),this.ins.playerNode.addChild(l)}}),this.ins.playerData.setSkill(P.Shield)}timeShield(){const t=this.getRes(p.battle.PlayerTimeShield),e=this.open(p.battle.PlayerTimeShield,t);let s=this.ins.playerV2;e.pos(s.x,s.y),this.ins.playerNode.addChild(e),this.ins.playerData.setSkill(P.TimeShield)}dieShot(){X.instance.playerData.setSkill(P.DieShot)}baseSkill11(){X.instance.playerData.setSkill(P.Back)}baseSkill13(){const t=X.instance;let e=h.skills[P.Anger].value||1;e=1,t.playerData.attack*=1,t.playerData.setSkill(P.Anger)}baseSkill14(){X.instance.playerData.setSkill(P.Cri)}baseSkill15(){const t=X.instance.playerData;let e=t.hp/t.currHP;e>1.5&&(e=1.5),t.crit*=e,t.critHurt*=e,t.setSkill(P.Fearless)}suckBlood(){X.instance.playerData.setSkill(P.SuckBlood)}dieBoom(){X.instance.playerData.setSkill(P.DieBoom)}skill(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(.71,-.71),this.getVec3(1,0),this.getVec3(.71,.71),this.getVec3(0,1),this.getVec3(-.71,.71),this.getVec3(-1,0),this.getVec3(-.71,-.71)];Laya.timer.loop(1e4,this,()=>{if(this.ins.gameState==C.START)for(let i=0;i<8;i++){const l=this.open(p.battle.PlayerSkill1,this.skill1Pre);let a=l.getComponent(_);a||(a=l.addComponent(_));const n=h.skills[P.SwimShell].value||1;a.setData(e.attack*n,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const o=l.getComponent(M);o.norV3=s[i].clone(),o.state=C.READY,o.tar=null,l.pos(t.x,t.y),this.ins.playerNode.addChild(l),Laya.Tween.to(l,{x:t.x+150*s[i].x,y:t.y+150*s[i].y},100,null,Laya.Handler.create(this,()=>{const t=this.ins.getMinEnemy(l);o.tar=t,7==i&&Laya.timer.once(1e3,this,()=>{S.event(V.BulSkill1_Start)})}))}}),this.ins.playerData.setSkill(P.SwimShell)}skill2(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(.17,-.98),this.getVec3(.34,-.94),this.getVec3(.5,-.87),this.getVec3(-.17,-.98),this.getVec3(-.34,-.94),this.getVec3(-.5,-.87)];Laya.timer.loop(5e3,this,()=>{if(this.ins.gameState==C.START)for(let i=0;i<7;i++){const l=this.open(p.battle.PlayerSkill2,this.skill2Pre);let a=l.getComponent(_);a||(a=l.addComponent(_));const n=h.skills[P.ShockWave].value||1;a.setData(e.attack*n,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),l.getComponent(Q).norV3=s[i].clone(),l.pos(t.x+200*s[i].x,t.y+200*s[i].y),this.ins.playerNode.addChild(l)}}),this.ins.playerData.setSkill(P.ShockWave)}skill3(){const t=this.ins.playerData,e=this.open(p.battle.PlayerSkill3,this.skill3Pre);let s=e.getComponent(_);s||(s=e.addComponent(_));const i=h.skills[P.Laser].value||1;s.setData(t.attack*i,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr);let l=this.ins.playerV2;e.pos(l.x,l.y),this.ins.playerNode.addChild(e),this.ins.playerData.setSkill(P.Laser)}skill4(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(.05,-1),this.getVec3(.16,-.99),this.getVec3(.26,-.97),this.getVec3(-.05,-1),this.getVec3(-.16,-.99),this.getVec3(-.26,-.97)];Laya.timer.loop(5e3,this,()=>{this.ins.gameState==C.START&&this.schedule(200,()=>{for(let i=0;i<6;i++){const l=this.open(p.battle.PlayerSkill4,this.skill4Pre);let a=l.getComponent(_);a||(a=l.addComponent(_));const n=h.skills[P.Shotgun].value||1;a.setData(e.attack*n,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),l.getComponent($).norV3=s[i].clone(),l.pos(t.x+0*s[i].x,t.y+0*s[i].y),this.ins.playerNode.addChild(l)}},this,3)}),this.ins.playerData.setSkill(P.Shotgun)}skill5(){const t=this.ins.playerV2,e=this.ins.playerData;Laya.timer.loop(5e3,this,()=>{if(this.ins.gameState!=C.START)return;let s=Math.floor(2*Math.random()+3),i=[];i.push(Math.floor(26*Math.random()+20)/180*Math.PI),i.push(Math.floor(91*Math.random()+45)/180*Math.PI),4==s&&i.push(Math.floor(91*Math.random()+45)/180*Math.PI),i.push(Math.floor(26*Math.random()+135)/180*Math.PI);let l=0;this.schedule(500,()=>{const s=this.open(p.battle.PlayerSkill5,this.skill5Pre);let a=s.getComponent(_);a||(a=s.addComponent(_));const n=h.skills[P.RainbowMissile].value||1;a.setData(e.attack*n,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const o=s.getComponent(Z);s.pos(t.x,t.y),o.pangle=i[l],o.tar=null,this.ins.playerNode.addChild(s),Laya.timer.once(500,this,()=>{const t=this.ins.getMinEnemy(s);o.tar=t}),l++},this,s)}),this.ins.playerData.setSkill(P.RainbowMissile)}skill6(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(1,0),this.getVec3(-1,0)];Laya.timer.once(3e3,this,()=>{for(let i=0;i<2;i++){const l=this.open(p.battle.PlayerSkill6,this.skill6Pre);let a=l.getComponent(_);a||(a=l.addComponent(_));const n=h.skills[P.RotatePoison].value||1;a.setData(e.attack*n,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const o=l.getComponent(J);o.norV3=s[i].clone(),o.angle=i*Math.PI,l.pos(t.x+200*s[i].x,t.y+200*s[i].y),this.ins.playerNode.addChild(l)}}),this.ins.playerData.setSkill(P.RotatePoison)}skill7(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(-.71,-.71),this.getVec3(.71,-.71)];Laya.timer.loop(7e3,this,()=>{if(this.ins.gameState==C.START)for(let i=0;i<3;i++){const l=this.open(p.battle.PlayerSkill7,this.skill7Pre);let a=l.getComponent(_);a||(a=l.addComponent(_));const n=h.skills[P.NaughtyGhost].value||1;a.setData(e.attack*n,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const o=l.getComponent(K);o.norV3=s[i].clone(),l.pos(t.x,t.y),this.ins.playerNode.addChild(l),Laya.Tween.to(l,{x:t.x+200*s[i].x,y:t.y+200*s[i].y},300,null,Laya.Handler.create(this,()=>{o.norV3.x=-o.norV3.x,2==i&&Laya.timer.once(300,this,()=>{S.event(V.BulSkill7_Start)})}))}}),this.ins.playerData.setSkill(P.NaughtyGhost)}skill8(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(1,0),this.getVec3(-1,0)];Laya.timer.once(3e3,this,()=>{for(let i=0;i<2;i++){const l=this.open(p.battle.PlayerSkill8,this.skill8Pre);let a=l.getComponent(_);a||(a=l.addComponent(_));const n=h.skills[P.RotateFire].value||1;a.setData(e.attack*n,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const o=l.getComponent(J);o.norV3=s[i].clone(),o.angle=i*Math.PI,l.pos(t.x+200*s[i].x,t.y+200*s[i].y),this.ins.playerNode.addChild(l)}}),this.ins.playerData.setSkill(P.RotateFire)}skill9(){const t=this.ins.playerData,e=this.open(p.battle.PlayerSkill9,this.skill9Pre);let s=e.getComponent(_);s||(s=e.addComponent(_));const i=h.skills[P.Magnet].value||1;s.setData(t.attack*i,t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr);let l=this.ins.playerV2;e.pos(l.x,l.y),this.ins.bgTopNode.addChild(e),this.ins.playerData.setSkill(P.Magnet)}skill10(){const t=this.ins.playerV2,e=this.ins.playerData,s=[this.getVec3(1,0),this.getVec3(-1,0)];Laya.timer.once(3e3,this,()=>{for(let i=0;i<2;i++){const l=this.open(p.battle.PlayerSkill10,this.skill10Pre);let a=l.getComponent(_);a||(a=l.addComponent(_));const n=h.skills[P.RotateIce].value||1;a.setData(e.attack*n,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const o=l.getComponent(J);o.norV3=s[i].clone(),o.angle=i*Math.PI,o.type=x.ICE,l.pos(t.x+200*s[i].x,t.y+200*s[i].y),this.ins.playerNode.addChild(l)}}),this.ins.playerData.setSkill(P.RotateIce)}wing1(){const t=this.ins;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=T[e/2];for(let e=0;e<2;e++){const l=this.open(p.battle.PlayerWing1,this.plaWing1Pre),a=l.getComponent(et);a.deltaX=i[e].dx,a.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(P.BlastWing)}wing2(){const t=X.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=T[e/2];for(let e=0;e<2;e++){const l=this.open(p.battle.PlayerWing2,this.plaWing2Pre),a=l.getComponent(et),n=l.getComponent(it);a.deltaX=i[e].dx,a.deltaY=i[e].dy,n.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(P.MissileWing)}wing3(){const t=X.instance;let e=t.plaWingsV2.length;if(e>=6)return;let s=t.playerV2,i=T[e/2];for(let e=0;e<2;e++){const l=this.open(p.battle.PlayerWing3,this.plaWing3Pre),a=l.getComponent(et),n=l.getComponent(at);a.deltaX=i[e].dx,a.deltaY=i[e].dy,n.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(P.LaserWing)}wing4(){const t=X.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=T[e/2];for(let e=0;e<2;e++){const l=this.open(p.battle.PlayerWing4,this.plaWing4Pre),a=l.getComponent(et);a.deltaX=i[e].dx,a.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(P.AutoWing)}wing5(){const t=X.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=T[e/2];for(let e=0;e<2;e++){const l=this.open(p.battle.PlayerWing5,this.plaWing5Pre),a=l.getComponent(et),n=l.getComponent(nt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,n.xv=i[e].v,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(P.ShotWing)}wing6(){const t=X.instance;let e=t.plaWingsV2.length;if(e>=4)return;let s=t.playerV2,i=T[e/2];for(let e=0;e<2;e++){const l=this.open(p.battle.PlayerWing6,this.plaWing6Pre),a=l.getComponent(et);l.getComponent(rt);a.deltaX=i[e].dx,a.deltaY=i[e].dy,l.pos(s.x+i[e].dx,s.y+i[e].dy),t.bgTopNode.addChild(l),t.plaWingsV2.push(l)}this.ins.playerData.setSkill(P.ShieldWing)}robot1(){const t=h.skills[P.LaserRobot],e=t.speed||5,s=t.fspeed||.2;Laya.timer.loop(5e3*e,this,()=>{if(this.ins.gameState!=C.START)return;const t=this.open(p.battle.PlayerRobot1,this.plaRob1Pre),e=t.getComponent(G);e.norV3=this.getVec3(0,-1),e.speed=s/5,t.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(t)}),this.ins.playerData.setSkill(P.BlastRobot)}robot2(){const t=h.skills[P.LaserRobot],e=t.speed||5,s=t.fspeed||.2;Laya.timer.loop(5e3*e,this,()=>{if(this.ins.gameState!=C.START)return;const t=this.open(p.battle.PlayerRobot2,this.plaRob2Pre),e=t.getComponent(G);e.norV3=this.getVec3(0,-1),e.speed=s/5,t.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(t)}),this.ins.playerData.setSkill(P.ShieldRobot)}robot3(){const t=h.skills[P.LaserRobot],e=this.ins.playerData,s=t.speed||5,i=t.fspeed||.2;Laya.timer.loop(5e3*s,this,()=>{if(this.ins.gameState!=C.START)return;const s=this.open(p.battle.PlayerRobot3,this.plaRob3Pre);let l=s.getComponent(_);l||(l=s.addComponent(_));const a=t.value||1;l.setData(e.attack*a,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const n=s.getComponent(G);n.norV3=this.getVec3(0,-1),n.speed=i/5,s.pos(this.ins.playerV2.x,this.ins.playerV2.y-100),this.ins.bgTopNode.addChild(s)}),this.ins.playerData.setSkill(P.LaserRobot)}}class ct extends f{constructor(){super(),this.ins=null,this.timer=0,this.eneQue={},this.start=!1,this.enemyPres={};for(const t in u){const e=u[t];this.enemyPres[t]=this.getRes(e)}this.enemyPres[1003]=this.enemyPres[1002],this.enemyPres[1005]=this.enemyPres[1004],this.enemyPres[1007]=this.enemyPres[1006],this.enemyPres[1009]=this.enemyPres[1008],this.enemyPres[1011]=this.enemyPres[1010],this.enemyPres[1013]=this.enemyPres[1012],this.enemyPres[1015]=this.enemyPres[1014]}onEnable(){this.ins=X.instance,S.on(V.LevelEnemy,this,this.makeLevelEnemy)}onDisable(){}makeLevelEnemy(){const t=this.ins.playerData,e=t.chapter,s=t.rate,l=i["enemys"+e][s];for(let t=0;t<l.length;t++){const e=l[t];if(this.enemyPres[e.type])if(1001==e.type){const t=Math.floor(3*Math.random()+4),s=e.time;for(let i=0;i<t;i++){let t=s+.2*i;this.eneQue[1e3*t]=e}}else this.eneQue[1e3*e.time]?this.eneQue[1e3*e.time+1]=e:this.eneQue[1e3*e.time]=e}this.start=!0,this.timer=0}enemy(t){const e=this.open(u[t.type],this.enemyPres[t.type]),s=e.getComponent(U);s.edata=t,s.isRotate=!1,s.isRotSelf=!1,s.isPauseSelf=!1,e.pos(0,-1e3),this.ins.enemyNode.addChild(e);const i=e.getComponent(v);this.ins.enemyCols.push(i),Object.keys(this.eneQue).length||S.event(V.LevelEnemyEnd)}onLateUpdate(){if(this.ins.gameState==C.START&&this.start){this.timer+=Laya.timer.delta;for(const t in this.eneQue)if(this.timer>=parseInt(t)){const e=this.eneQue[t];delete this.eneQue[t],this.enemy(e)}Object.keys(this.eneQue).length||(this.start=!1,this.timer=0)}}}class yt extends f{constructor(){super(),this.ins=null,this.playerPre=null,this.plaHPPre=null,this.playerMods={},this.playerPre=this.getRes(p.battle.Player),this.plaHPPre=this.getRes(p.battle.PlayerHP);for(const t in m){const e=m[t];this.playerMods[t]=this.getRes(e)}}onEnable(){this.ins=X.instance,this.initPlayerModel()}initPlayerModel(){const t=this.ins,e=t.playerData.id;let s=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,1280),s);const i=Laya.Sprite3D.instantiate(this.playerMods[e]);i.transform.position=s,i.transform.localScale=this.getVec3(2,2,2),t.playerV3=i,t.modSceneV3.addChild(i);const l=this.getRes(d.PlaneTrackModel);l.transform.position=this.getVec3(0,0,.05),i.addChild(l);const a=this.open(p.battle.Player,this.playerPre);a.pos(360,1280),t.playerNode.addChild(a),t.playerV2=a,t.playerCols.push(a.getComponent(v));const n=this.open(p.battle.PlayerHP,this.plaHPPre);n.pos(400,1240),t.effectNode.addChild(n),t.playerHPV2=n,t.modCameraV3.convertScreenCoordToOrthographicCoord(t.playerPosV2,s),t.playerPosV3=s,Laya.Tween.to(a,{y:t.playerPosV2.y},500,Laya.Ease.cubicOut),Laya.Tween.to(n,{y:t.playerPosV2.y-40},500,Laya.Ease.cubicOut),Laya.Tween.to(i.transform,{localPositionZ:s.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{t.gameState=C.START,S.event(V.LevelEnemy),S.event(V.PlayerBullet,e)}))}onDisable(){}}class pt extends f{constructor(){super(),this.qhBtn=null,this.gcBtn=null,this.zzBtn=null,this.fypBtn=null,this.cjbBtn=null,this.jgBtn=null,this.sdBtn=null,this.chddBtn=null,this.ddgBtn=null,this.xzdqBtn=null,this.xzhqBtn=null,this.cbdcBtn=null,this.xzbqBtn=null,this.sdljBtn=null,this.ddljBtn=null,this.jgljBtn=null,this.bpljBtn=null,this.hdljBtn=null,this.zzpljBtn=null,this.bpjqrBtn=null,this.hdjqrBtn=null,this.jgjqrBtn=null}onEnable(){this.setClick(this.qhBtn,this.baseSkill6.bind(this),this),this.setClick(this.gcBtn,this.baseSkill7.bind(this),this),this.setClick(this.zzBtn,this.baseSkill9.bind(this),this),this.setClick(this.fypBtn,this.skill1.bind(this),this),this.setClick(this.cjbBtn,this.skill2.bind(this),this),this.setClick(this.jgBtn,this.skill3.bind(this),this),this.setClick(this.sdBtn,this.skill4.bind(this),this),this.setClick(this.chddBtn,this.skill5.bind(this),this),this.setClick(this.xzdqBtn,this.skill6.bind(this),this),this.setClick(this.ddgBtn,this.skill7.bind(this),this),this.setClick(this.xzhqBtn,this.skill8.bind(this),this),this.setClick(this.cbdcBtn,this.skill9.bind(this),this),this.setClick(this.xzbqBtn,this.skill10.bind(this),this),this.setClick(this.sdljBtn,this.wing5.bind(this),this),this.setClick(this.ddljBtn,this.wing2.bind(this),this),this.setClick(this.jgljBtn,this.wing3.bind(this),this),this.setClick(this.bpljBtn,this.wing1.bind(this),this),this.setClick(this.hdljBtn,this.wing6.bind(this),this),this.setClick(this.zzpljBtn,this.wing4.bind(this),this),this.setClick(this.bpjqrBtn,this.robot1.bind(this),this),this.setClick(this.hdjqrBtn,this.robot2.bind(this),this),this.setClick(this.jgjqrBtn,this.robot3.bind(this),this)}baseSkill6(){S.event(V.BaseSkill6),S.event(V.DieBoom),S.event(V.DieShot),S.event(V.TimeShield),S.event(V.Shield)}baseSkill7(){S.event(V.BaseSkill7)}baseSkill9(){S.event(V.BaseSkill9)}skill1(){S.event(V.BulSkill1)}skill2(){S.event(V.BulSkill2)}skill3(){S.event(V.BulSkill3)}skill4(){S.event(V.BulSkill4)}skill5(){S.event(V.BulSkill5)}skill6(){S.event(V.BulSkill6)}skill7(){S.event(V.BulSkill7)}skill8(){S.event(V.BulSkill8)}skill9(){S.event(V.BulSkill9)}skill10(){S.event(V.BulSkill10)}wing1(){S.event(V.WingSkill1)}wing2(){S.event(V.WingSkill2)}wing3(){S.event(V.WingSkill3)}wing4(){S.event(V.WingSkill4)}wing5(){S.event(V.WingSkill5)}wing6(){S.event(V.WingSkill6)}robot1(){S.event(V.RobSkill1)}robot2(){S.event(V.RobSkill2)}robot3(){S.event(V.RobSkill3)}onDisable(){}}class dt extends f{constructor(){super(),this.maskNode=null,this.skill1Tit=null,this.skill1Icon=null,this.skill1Desc=null,this.skill2Tit=null,this.skill2Icon=null,this.skill2Desc=null,this.skill3Tit=null,this.skill3Icon=null,this.skill3Desc=null,this.skills=[]}onEnable(){this.setClick(this.skill1Icon,()=>{const t=this.skills[0].han;t&&t(),this.hide()},this),this.setClick(this.skill2Icon,()=>{const t=this.skills[1].han;t&&t(),this.hide()},this),this.setClick(this.skill3Icon,()=>{const t=this.skills[2].han;t&&t(),this.hide()},this),this.setClick(this.maskNode,()=>{},this,null,!0),this.skills.length||(this.skills.push({title:this.skill1Tit,icon:this.skill1Icon,desc:this.skill1Desc,han:null}),this.skills.push({title:this.skill2Tit,icon:this.skill2Icon,desc:this.skill2Desc,han:null}),this.skills.push({title:this.skill3Tit,icon:this.skill3Icon,desc:this.skill3Desc,han:null}))}setData(t){const e=this.skills;for(let s=0;s<t.length;s++){const i=t[s],l=e[s],a=h.skills[i];l.title.text=a.name,l.desc.text=a.describe,l.han=(()=>{let t="";i<2e3?t=`player_${i}_baseskill`:i>2e3&&i<3e3?t=`player_${i}_bulskill`:i>3e3&&i<4e3?t=`player_${i}_wingskill`:i>4e3&&(t=`player_${i}_robskill`),S.event(t)})}}hide(){Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{S.event(V.RateStart),this.owner.removeSelf()}))}onDisable(){}}class gt extends f{constructor(){super(),this.ins=X.instance,this.pauseBtn=null,this.lvPro=null,this.lvLab=null,this.rateLab=null,this.coinLab=null,this.rewardLab=null,this.rateTipLab=null}onEnable(){const t=this.ins,e=t.playerData,s=o.comChapters[e.chapter-1];this.rateLab.text=`${e.rate}/${s.level}`,this.setClick(this.pauseBtn,()=>{let e=t.gameState;e!=C.READY&&e!=C.END&&(t.gameState=e==C.START?C.PAUSE:C.START,this.loadPrefab(p.battleUI.PlayerSkillItem).then(()=>{this.openDialog(p.battleUI.GamePauseDialog,t.dialogNode)}))},this),S.on(V.RateStart,this,()=>{t.gameState=C.START;let i=l.levelExps[e.level],a=e.exp/i;this.lvPro.value=a,this.lvLab.text=`LV. ${e.level}`,e.rate+=1,this.rateLab.text=`${e.rate}/${s.level}`;let n=this.rateTipLab;n.text=`${e.rate}`,n.x=1080,Laya.Tween.to(n,{x:340},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{Laya.Tween.to(n,{x:380},1e3,null,Laya.Handler.create(this,()=>{Laya.Tween.to(n,{x:-360},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{}))}))})),S.event(V.LevelEnemy)}),S.on(V.RateEnd,this,()=>{const s=e.chapter;let a=e.rate;const n=e.rate+1;if(!i["enemys"+s][n])return t.playerNode.alpha=0,t.eneBulNode.alpha=0,t.effectNode.alpha=0,void(t.gameState=C.END);let r=l.upLevExps[a]||1,h=l.levelExps[e.level];e.exp+=r;let c=e.exp/h;Laya.Tween.to(this.lvPro,{value:c},1e3,Laya.Ease.cubicIn,Laya.Handler.create(this,()=>{if(e.exp>=h){let t=o.comChapters[e.chapter-1].maxair;e.level<=t?(e.level<t&&(e.level+=1),e.exp=0,this.getRandomSkill()):S.event(V.RateStart)}else S.event(V.RateStart)}))}),S.on(V.GameStateChange,this,()=>{this.ins.gameState==C.END&&(t.playerV3&&Laya.timer.once(3e3,this,()=>{const e=t.playerV3;let s=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,640),s),Laya.Tween.to(e.transform,{localPositionX:s.x,localPositionZ:s.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{Laya.timer.once(1e3,this,()=>{Laya.Tween.to(e.transform,{localPositionZ:s.z-8},300)})}))}),Laya.timer.once(5e3,this,()=>{Laya.Scene.open("LobbyScene.scene")}))}),S.on(V.GameOver,this,()=>{t.gameState=C.END})}getRandomSkill(){const t=this.ins,e=t.playerData;if(e.unlock.length<3)return void S.event(V.RateStart);t.gameState=C.PAUSE;const s=e.unlock,i=h.skills,l=t=>{const e=i[t],l=s.indexOf(t);e.add==n.Once&&s.splice(l,1),e.add==n.Add&&(i[t+1]&&i[t+1].add==n.Add?s[l]=t+1:s.splice(l,1))},a=(()=>{let l=s.concat();const a=l.indexOf(1013);if(e.currHP>=e.hp&&a>=0&&l.splice(a,1),t.plaWingsV2.length>=4)for(let t=l.length-1;t>=0;t--){const e=l[t];3==i[e].skilltype&&l.splice(t,1)}else{let t=null;for(const s in e.skills)3==i[s].skilltype&&(t=parseInt(s));if(t)for(let e=l.length-1;e>=0;e--){const s=l[e];3==i[s].skilltype&&s!=t&&l.splice(e,1)}}return l})(),o=[],r=s.length-1;for(;o.length<3;){let t=Math.floor(Math.random()*(r-0+1)+0);o.indexOf(t)<0&&o.push(t)}let c=a[o[0]],y=a[o[1]],d=a[o[2]];l(c),l(y),l(d),this.openDialog(p.battleUI.ChooseSkillDialog,t.dialogNode,t=>{t.getComponent(dt).setData([c,y,d])})}onDisable(){S.offAllCaller(this)}}var ut,mt,bt=Laya.Scene,kt=Laya.ClassUtils.regClass;!function(t){class e extends bt{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("BattleScene")}}t.BattleSceneUI=e,kt("ui.BattleSceneUI",e);class s extends bt{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("LobbyScene")}}t.LobbySceneUI=s,kt("ui.LobbySceneUI",s)}(ut||(ut={}));class St extends ut.LobbySceneUI{constructor(){super(),St.instance=this}onEnable(){}onDisable(){}}St.instance=null;class ft extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}}class Ct extends Laya.Script{constructor(){super(),this.interactable=!0,this.isChecked=!0,this.checkMark=null,this.clickHandle=null,this.cantHandle=null}onClick(){if(this.interactable){if(this.isChecked=!this.isChecked,this.checkMark&&(this.checkMark.visible=this.isChecked),this.clickHandle&&this.clickHandle(this.isChecked),this.owner&&this.owner.parent&&this.owner.parent.getComponent(ft)){let t=this.owner.parent.numChildren,e=this.owner.parent.getChildIndex(this.owner);for(let s=0;s<t;s++){const t=this.owner.parent.getChildAt(s).getComponent(Ct);if(!t)return;s==e?t.isChecked||(t.isChecked=!0):t.isChecked=!1,t.checkMark&&(t.checkMark.visible=t.isChecked)}}}else this.cantHandle&&this.cantHandle()}onEnable(){this.checkMark&&(this.checkMark.visible=this.isChecked)}onDisable(){}}class xt extends f{constructor(){super(),this.startBtn=null,this.chaHorSel=null,this.midNode=null,this.tabIndex=0}onEnable(){let t=!1;this.setClick(this.startBtn,()=>{t||(t=!0,this.loadBatPre().then(()=>{Laya.Scene.open("BattleScene.scene")}))},this),S.on(mt.OpenPage,this,this.onOpen)}onDisable(){S.offAllCaller(this)}onOpen(t){const e=this.owner;t==this.tabIndex?(e.visible=!0,this.midNode.x=-360,Laya.Tween.to(this.midNode,{x:360},300)):e.visible=!1}loadBatPre(){const t=[],e=p.battle;for(const s in e){const i=e[s];t.push(i)}const s=[];for(const t in d){const e=d[t];this.getRes(e)||s.push(e)}return new Promise((e,i)=>{let l=0,a=0;s.length&&a++,t.length&&a++,Laya.loader.create(s,Laya.Handler.create(this,()=>{console.log("load model complete..."),++l==a&&e()}),Laya.Handler.create(this,t=>{})),Laya.loader.create(t,Laya.Handler.create(this,()=>{console.log("load prefab complete..."),++l==a&&e()}),Laya.Handler.create(this,t=>{}),Laya.Loader.PREFAB)})}onDestroy(){}}class Vt extends Laya.Image{constructor(){super(),this.size(203,143),this.loadPrefab(p.lobby.HangarPlaneItem).then(t=>{const e=Laya.Pool.getItemByCreateFun(p.lobby.HangarPlaneItem,t.create,t);this.addChild(e)})}onEnable(){}onDisable(){}loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)})}}class Lt extends f{constructor(){super(),this.planeSpr=null,this.planeList=null,this.tabIndex=0}onEnable(){S.on(mt.OpenPage,this,this.onOpen),this.planeList.itemRender=Vt,this.planeList.vScrollBarSkin="",this.planeList.renderHandler=Laya.Handler.create(this,()=>{console.log(123)},null,!1),this.planeList.array=[1,2,3,4,5,6]}onDisable(){S.offAllCaller(this)}onOpen(t){const e=this.owner;t==this.tabIndex?e.visible=!0:e.visible=!1,S.event(mt.HangarPage,[e.visible,this.planeSpr])}onDestroy(){}}!function(t){t.OpenPage="lobby.openpage",t.HangarPage="lobby.hangar"}(mt||(mt={}));class Pt extends f{constructor(){super(),this.ins=null,this.scene3D=null,this.camera=null,this.battlePage=null,this.batTog=null,this.hangarPage=null,this.hanTog=null;const t=Laya.stage.addChild(new Laya.Scene3D);t.zOrder=-1,this.scene3D=t;const e=t.addChild(new Laya.Camera(0,.1,1e3));e.clearFlag=Laya.CameraClearFlags.DepthOnly,e.clearColor=new Laya.Vector4(0,0,0,0),e.transform.translate(this.getVec3(-1.8,2,2)),e.transform.rotate(new Laya.Vector3(-45,-45,0),!1,!1),this.camera=e,e.renderTarget=new Laya.RenderTexture(720,600,Laya.RenderTextureFormat.R16G16B16A16,Laya.RenderTextureDepthFormat.DEPTH_16),e.renderingOrder=-1,e.clearFlag=Laya.CameraClearFlags.SolidColor,e.clearColor=this.getVec4(0,0,0,0);const s=t.addChild(new Laya.DirectionLight);s.color=new Laya.Vector3(1,1,1),s.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0))}onEnable(){this.clearBattlePool(),this.ins=St.instance,console.log("stage -> ",Laya.stage);const t=this.ins;this.loadPrefab(p.lobby.BattlePage).then(e=>{const s=this.open(p.lobby.BattlePage,e);t.content.addChild(s),this.battlePage=s.getComponent(xt),this.battlePage.tabIndex=3}),this.loadPrefab(p.lobby.HangarPage).then(e=>{const s=this.open(p.lobby.HangarPage,e);s.visible=!1,t.content.addChild(s),this.hangarPage=s.getComponent(Lt),this.hangarPage.tabIndex=2}),this.batTog=t.batTog.getComponent(Ct),this.batTog.clickHandle=(()=>{this.battlePage&&(S.event(mt.OpenPage,this.battlePage.tabIndex),this.clickAnim())}),this.hanTog=t.hanTog.getComponent(Ct),this.hanTog.clickHandle=(()=>{this.hangarPage&&(S.event(mt.OpenPage,this.hangarPage.tabIndex),this.clickAnim())}),S.on(mt.HangarPage,this,this.onHangarPage)}onDisable(){this.scene3D.destroy(!0),Laya.timer.clearAll(this),S.offAllCaller(this)}clickAnim(){const t=this.ins;t.bottom.y=1178+t.bottom.height,Laya.Tween.to(t.bottom,{y:1178},500,Laya.Ease.quadInOut),t.top.y=0-t.top.height,Laya.Tween.to(t.top,{y:0},500,Laya.Ease.quadInOut)}clearBattlePool(){for(let t=0;t<L.length;t++){const e=L[t];Laya.Pool.clearBySign(e)}L.length=0}onHangarPage(t,e){const s=this.scene3D.getChildByName("plane");if(t){if(s)return;this.loadRes(d.PlaneModel1).then(t=>{const s=Laya.Sprite3D.instantiate(t);s.transform.localScale=new Laya.Vector3(3.5,3.5,3.5),this.scene3D.addChild(s),Laya.timer.frameLoop(1,this,()=>{s.transform.rotate(this.getVec3(0,.005,0))});let i=new Laya.Texture(this.camera.renderTarget,Laya.Texture.DEF_UV);e.graphics.drawTexture(i)})}}}class wt extends Laya.Script{constructor(){super(),this.speed=.1,this.bg1=null,this.bg2=null}onEnable(){}onDisable(){}onUpdate(){let t=Laya.timer.delta;if(this.bg1&&this.bg2){this.bg1.y>=1920&&(this.bg1.y=this.bg1.y-1920-640),this.bg2.y>=1920&&(this.bg2.y=this.bg2.y-1920-640);let e=t*this.speed;this.bg1.y+=e,this.bg2.y+=e}}}class Tt extends Laya.Image{constructor(){super(),this.size(128,150),this.loadPrefab(p.battleUI.PlayerSkillItem).then(t=>{const e=Laya.Pool.getItemByCreateFun(p.battleUI.PlayerSkillItem,t.create,t);this.addChild(e)})}onEnable(){}onDisable(){}loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)})}}class Et extends f{constructor(){super(),this.ins=X.instance,this.closeBtn=null,this.returnBtn=null,this.contBtn=null,this.currAtt=null,this.currHp=null,this.skills=null}onEnable(){this.setClick(this.closeBtn,this.onCloseClick,this),this.setClick(this.contBtn,this.onCloseClick,this),this.setClick(this.returnBtn,this.onReturnClick,this);const t=this.ins.playerData;this.currAtt.text=t.attack+" ",this.currHp.text=t.currHP+" ";const e=[];for(const s in t.skills)e.push(parseInt(s));this.skills.itemRender=Tt,this.skills.vScrollBarSkin="",this.skills.renderHandler=Laya.Handler.create(this,(t,s)=>{const i=t.getChildAt(0);if(!i)return;const l=i.getChildByName("desc"),a=(i.getChildByName("icon"),e[s]),n=h.skills[a];n&&(l.text=n.nameCN)},null,!1),this.skills.array=e}onCloseClick(){Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{this.ins.gameState==C.PAUSE&&(this.ins.gameState=C.START),this.owner.removeSelf()}))}onReturnClick(){Laya.Scene.open("LobbyScene.scene")}onDisable(){}}class vt extends f{constructor(){super()}onEnable(){let t={1001:2,1002:2,1003:2,1004:3,1005:3,1006:2,1007:2,1008:2,1009:2,1010:1.5,1011:1.5,1012:2,1013:2,1014:2,1015:2,1016:1.5,2001:6,3001:1.5,3002:1.5}[this.owner.__$type$__]||2;const e=this.owner.getChildByName("boom");e.scale(t,t),e.blendMode=Laya.BlendMode.LIGHTER,Laya.timer.once(250,this,()=>{this.owner.removeSelf()})}onDisable(){Laya.timer.clearAll(this),this.recover(this.owner)}}class Bt extends f{constructor(){super(),this.lighter1=null,this.lighter2=null}onEnable(){for(let t=1;t<3;t++){const e=this["lighter"+t];e&&(e.blendMode=Laya.BlendMode.LIGHTER)}}onDisable(){}}class Rt extends f{constructor(){super()}onEnable(){const t=this.owner;t.alpha=1,Laya.timer.once(300,this,()=>{Laya.Tween.to(t,{alpha:0},100,null,Laya.Handler.create(this,()=>{this.owner.removeSelf()}))})}onDisable(){Laya.timer.clearAll(this),this.recover(this.owner)}}class Dt extends f{constructor(){super(),this.ins=X.instance,this.skin=null}onEnable(){}onUpdate(){this.ins.gameState==C.START&&this.skin&&(this.skin.rotation+=5)}}class _t extends f{constructor(){super(),this.ins=X.instance,this.enemyCom=null,this.currSkill=null,this.eskillCom=null,this.skeCon=null,this.templet=null,this.ske=null,this.skill2001Pre=null,this.skill2001Pre=this.getRes(p.battle.EnemySkill2001)}onEnable(){if(this.enemyCom=this.owner.getComponent(U),this.eskillCom=this.owner.getComponent(I),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata,e=new Laya.Templet;this.templet=e,e.on(Laya.Event.COMPLETE,this,this.parseComplete),e.loadAni(g.Boos2001),S.on(V.EnemyHit,this,(e,s)=>{e==t.type&&(this.ske&&this.ske.play(0,!1),this.currSkill=s)})}onDisable(){this.templet.offAllCaller(this),this.ske.offAllCaller(this),this.ske.stop(),this.ske.removeSelf(),this.templet.destroy()}parseComplete(){this.ske=this.templet.buildArmature(0);const t=this.ske,e=E[2001];t.pos(e.self.x,e.self.y),t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t.play(1,!0),this.skeCon.addChild(t)}completeHandler(){this.ske.play(1,!0)}onEvent(t){this.ins.gameState==C.START&&("b1"==t.stringValue?1001==this.currSkill&&this.skill1001():"b2"==t.stringValue?1002==this.currSkill&&this.skill1002():"b3"==t.stringValue&&1003==this.currSkill&&this.skill1003())}skill1001(){const t=this.owner,e=this.enemyCom.edata,s=[-30,-20,-10,0,10,20,30],i=E[2001].b1,l=l=>{for(let a=0;a<s.length;a++){const n=this.open(p.battle.EnemySkill1,this.eskillCom.skill1Pre);let o=n.getComponent(_);o||(o=n.addComponent(_)),o.setData(e.att,0,0,0,0);const r=n.getComponent(W);r.norV3=this.getVec3(0,1),r.state=C.START,n.pos(t.x+i[l].x+s[a],t.y+i[l].y),this.ins.eneBulNode.addChild(n)}};for(let t=0;t<2;t++)l(t),this.schedule(100,()=>{l(t)},this,3)}skill1002(){const t=this.owner,e=this.enemyCom.edata,s=E[2001].b2,i=[this.getVec3(-.34,.94),this.getVec3(-.17,.98),this.getVec3(0,1),this.getVec3(.17,.98),this.getVec3(.34,.94)],l=l=>{for(let a=0;a<i.length;a++)for(let a=0;a<i.length;a++){const n=this.open(p.battle.EnemySkill2001,this.skill2001Pre);let o=n.getComponent(_);o||(o=n.addComponent(_)),o.setData(e.att,0,0,0,0);const r=n.getComponent(W);r.norV3=i[a].clone(),r.state=C.START,n.pos(t.x+s[l].x,t.y+s[l].y),this.ins.eneBulNode.addChild(n)}};for(let t=0;t<2;t++)l(t),this.schedule(100,()=>{l(t)},this,5)}skill1003(){const t=this.owner,e=this.enemyCom.edata,s=[-60,-30,0,30,60],i=[-10,-5,0,-5,-10],l=E[2001].b3,a=a=>{for(let n=0;n<s.length;n++){const o=this.open(p.battle.EnemySkill2001,this.skill2001Pre);let r=o.getComponent(_);r||(r=o.addComponent(_)),r.setData(e.att,0,0,0,0);const h=o.getComponent(W);h.norV3=this.getVec3(0,1),h.state=C.START,o.pos(t.x+l[a].x+s[n],t.y+l[a].y+i[n]),this.ins.eneBulNode.addChild(o)}};for(let t=0;t<2;t++)a(t),this.schedule(100,()=>{a(t)},this,5)}onUpdate(){}}class At extends f{constructor(){super()}onEnable(){const t=this.owner;let e=Math.floor(151*Math.random()+50);t.color=e>=1e3?"#ff0300":"#ffffff",t.scale(0,0);let s=Math.floor(6*Math.random()+15),i=Math.floor(16*Math.random()+45),l=Math.floor(6*Math.random()+5),a=Math.floor(6*Math.random()+5);Laya.Tween.to(t,{x:t.x+s,y:t.y-i,scaleX:1,scaleY:1},300,Laya.Ease.quintOut,Laya.Handler.create(this,()=>{Laya.timer.once(100,this,()=>{Laya.Tween.to(t,{x:t.x-l,y:t.y-a,scaleX:0,scaleY:0},100,null,Laya.Handler.create(this,()=>{t.removeSelf()}))})}))}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this),this.recover(this.owner)}onUpdate(){}}class Mt extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this.timer=0}onEnable(){this.timer=0,this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280}))}onDisable(){S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){this.ins.gameState==C.START&&(this.quadTree.check(this.ins.playerCols,this.selfCol),this.timer+=Laya.timer.delta,this.timer>=2e3&&this.owner.removeSelf())}}class Ht extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null}onEnable(){this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280}))}onCollisionEnter(t,e){const s=t.owner;if(!s||!s.parent)return;const i=s.getComponent(_);if(!i||!i.data)return;const l=this.ins.playerData;l.currHP-=i.data.attack+100,S.event(V.PlayerHP),l.currHP<=0&&(this.makeBoom(1004),S.event(V.GameOver))}onCollisionExit(t,e){}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}makeBoom(t){const e=this.getRes(p.battle.EnemyBoom),s=this.open(p.battle.EnemyBoom,e);s.__$type$__=t;const i=this.owner;s.x=i.x,s.y=i.y,this.ins.effectNode.addChild(s)}onLateUpdate(){this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class Wt extends f{constructor(){super(),this.ins=X.instance,this.line=null,this.bgBar=null,this.bar=null,this.hpLab=null,this.baseWidth=12,this.currBarWidth=60,this.currBaseNum=5}onEnable(){const t=this.ins.playerData;let e=this.currBaseNum*this.baseWidth;this.bgBar.width=e,this.currBarWidth=e,S.on(V.PlayerHP,this,()=>{let s=t.currHP/t.hp*e;this.currBarWidth=s,this.hpLab.text=Math.round(t.currHP/t.hp*100)+"%"}),S.on(V.PlayerMaxHP,this,()=>{this.currBaseNum++,e=this.currBaseNum*this.baseWidth,this.bgBar.width=e;let s=t.currHP/t.hp*e;this.currBarWidth=s,this.hpLab.text=Math.round(t.currHP/t.hp*100)+"%"})}onDisable(){S.offAllCaller(this)}onLateUpdate(){if(this.ins.gameState!=C.START)return;const t=this.owner;let e=Laya.timer.delta/1e3,s=this.getVec3(t.x,t.y),i=this.getVec3(this.ins.playerPosV2.x+40,this.ins.playerPosV2.y-40),l=this.getVec3();Laya.Vector3.lerp(s,i,8*e,l),t.pos(l.x,l.y);let a=this.ins.playerV2,n=l.x-a.x,o=l.y-a.y;this.line.height=Math.sqrt(n*n+o*o),this.line.rotation=Math.atan2(n,-o)/Math.PI*180;let r=this.getVec3();Laya.Vector3.lerp(this.getVec3(this.bar.width),this.getVec3(this.currBarWidth),.01*Laya.timer.delta,r),this.bar.width=r.x}}class jt extends f{constructor(){super(),this.ins=X.instance,this.robot1BPre=null,this.robot1BPre=this.getRes(p.battle.PlayerRobot1b)}onEnable(){const t=this.owner,e=[this.getVec3(.87,-.5),this.getVec3(.98,-.17),this.getVec3(.98,.17),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-.98,-.17),this.getVec3(-.98,.17),this.getVec3(-.87,.5)],s=this.ins.playerData,i=h.skills[P.BlastRobot];Laya.timer.loop(1e3,this,()=>{if(this.ins.gameState==C.START)for(let l=0;l<8;l++){const a=this.open(p.battle.PlayerRobot1b,this.robot1BPre);let n=a.getComponent(_);n||(n=a.addComponent(_));const o=i.value||1;n.setData(s.attack*o,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);let r=a.getComponent($);r||(r=a.addComponent($)),r.delta=294,r.speed=1,r.norV3=e[l].clone(),a.pos(t.x,t.y),this.ins.playerNode.addChild(a);const h=a.getChildByName("bi");h.height=0,Laya.Tween.clearAll(h),Laya.Tween.to(h,{height:294},300)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){}}class It extends f{constructor(){super(),this.ins=X.instance,this.robot2BPre=null,this.robot2BPre=this.getRes(p.battle.PlayerWing6b)}onEnable(){const t=this.owner,e=[this.getVec3(.87,-.5),this.getVec3(1,0),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-1,0),this.getVec3(-.87,.5)];Laya.timer.loop(1e3,this,()=>{if(this.ins.gameState==C.START)for(let s=0;s<6;s++){const i=this.open(p.battle.PlayerWing6b,this.robot2BPre),l=i.getComponent(ot);l.speed=.4,l.norV3=e[s].clone(),i.pos(t.x,t.y),this.ins.playerNode.addChild(i)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){}}class Nt extends f{constructor(){super(),this.ins=X.instance,this.left=null,this.right=null,this.vec=0,this.tar=null,this.im=null,this.point=null}onEnable(){const t=this.owner;this.left.alpha=0,this.right.alpha=0;const e=[this.right,this.left],s=this.ins;Laya.timer.loop(300,this,()=>{if(s.gameState!=C.START)return;const i=e[this.vec],l=i.getChildByName("point");if(i){let s=this.ins.getMinEnemy(t),a=this.vec?90:-90,n=730;if(s&&s.parent){let e=t.x+(i.x-25)-s.x,l=t.y-s.y;n=Math.sqrt(e*e+l*l),a=Math.atan2(e,-l)/Math.PI*180;const o=s.getComponent(q);o.onCollisionEnter(this,o,!0)}i.height=n,i.rotation=a,l.y=n/730*713,Laya.Tween.to(i,{alpha:1},100,null,Laya.Handler.create(this,()=>{if(s&&s.parent){const t=s.getComponent(q);t.onCollisionEnter(this,t,!0)}})),Laya.timer.once(200,this,()=>{Laya.Tween.to(i,{alpha:0},100)}),this.tar=s,this.im=i,this.point=l,this.vec++,this.vec>=e.length&&(this.vec=0)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){if(this.ins.gameState==C.START&&this.im&&this.point){const t=this.owner;let e=1500,s=this.vec?90:-90,i=this.tar;if(i&&i.parent){let l=t.x+(this.im.x-25)-i.x,a=t.y-i.y;e=Math.sqrt(l*l+a*a),s=Math.atan2(l,-a)/Math.PI*180}this.im.height=e,this.im.rotation=s,this.point.y=e/730*713}}}class Ut extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this.boomSke=null}onEnable(){const t=this.owner;this.ins;this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.boomSke&&(this.boomSke.blendMode=Laya.BlendMode.LIGHTER),Laya.timer.once(265,this,()=>{this.quadTree.check(this.ins.enemyCols,this.selfCol),t.removeSelf()})}onDisable(){this.selfCol.bids=[],S.event(V.LaserHide,this.selfCol),S.offAllCaller(this),Laya.timer.clearAll(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){}}class qt extends f{constructor(){super(),this.laser=null,this.ins=X.instance,this.selfCol=null,this.quadTree=null,this.target=null,this.startH=1500}set currH(t){this.laser.scaleY=t/1e3}onEnable(){const t=X.instance,e=this.owner;e.__type__=x.LASER,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(v),this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.target=null,this.currH=this.startH,e.alpha=1;let s=t.playerData,i=1e3*(s.fspeed+s.speed+1),l=1e3*s.speed+500;Laya.timer.loop(i,this,()=>{Laya.Tween.to(e,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids()})),Laya.timer.once(l,this,()=>{Laya.Tween.to(e,{alpha:1},500,null,Laya.Handler.create(this,()=>{if(2==t.playerData.laserSta&&t.playerData.trackBox&&t.playerData.trackBox.owner&&t.playerData.trackBox.owner.parent){const e=t.playerData.trackBox;e.bids.indexOf(this.selfCol.bid)<0&&(e.bids.push(this.selfCol.bid),t.playerData.trackCol.onCollisionEnter(this.selfCol,t.playerData.trackBox,!0))}}))})}),S.on(V.GameStateChange,this,()=>{t.gameState==C.START?e.visible=!0:e.visible=!1}),S.on(V.LaserCross,this,()=>{this.target=null,this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2}),S.on(V.LaserTrack,this,()=>{this.selfCol.bids=[],this.target=null}),S.on(V.LaserTrackTar,this,()=>{if(S.event(V.LaserHide,this.selfCol),t.playerData.trackTar&&t.playerData.trackBox&&t.playerData.trackCol&&e.visible&&1==e.alpha){const e=t.playerData.trackBox;e.bids.indexOf(this.selfCol.bid)<0&&(e.bids.push(this.selfCol.bid),t.playerData.trackCol.onCollisionEnter(this.selfCol,t.playerData.trackBox,!0))}})}onDisable(){this.clearBids(),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}clearBids(){this.owner;this.selfCol.bids=[],this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null,this.currH=this.startH,S.event(V.LaserHide,this.selfCol)}onCollisionEnter(t,e){const s=t.owner,i=e.owner;if(s&&i&&!X.instance.playerData.laserSta){let t=Math.abs(s.y-i.y);this.selfCol.height2>t&&(this.currH=t,this.selfCol.height2=t,this.selfCol.deltaY=-t/2,this.target=s)}}onCollisionExit(t,e){const s=t.owner,i=e.owner;s&&i&&!X.instance.playerData.laserSta&&(this.selfCol.bids.length||(this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null))}onLateUpdate(){const t=this.owner,e=X.instance;if(2==e.playerData.laserSta)if(e.playerData.trackTar){const s=e.playerData.trackTar;if(s.x>=0&&s.x<=720&&s.y>=0&&s.y<=1280){let s=e.playerData.trackTar.x-t.x,i=e.playerData.trackTar.y-t.y,l=Math.sqrt(s*s+i*i);this.currH=l,t.rotation=Math.atan2(s,-i)/Math.PI*180}}else t.rotation=0,this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2;if(2!=e.playerData.laserSta&&t.visible&&t.alpha>=.1&&this.quadTree.check(X.instance.enemyCols,this.selfCol),!e.playerData.laserSta&&this.target){const t=this.owner;let e=Math.abs(this.target.y-t.y);this.currH=e,this.selfCol.height2=e,this.selfCol.deltaY=-e/2}}}class Ot extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null}onEnable(){const t=this.owner;t.__type__=x.LASER,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),t.alpha=1;const e=h.skills[P.Laser];e.speed,e.fspeed;Laya.timer.loop(4e3,this,()=>{Laya.Tween.to(t,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids()})),Laya.timer.once(1500,this,()=>{Laya.Tween.to(t,{alpha:1},500)})}),S.on(V.GameStateChange,this,()=>{this.ins.gameState==C.START?t.visible=!0:t.visible=!1})}onDisable(){this.clearBids(),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}clearBids(){this.selfCol.bids.length=0,S.event(V.LaserHide,this.selfCol)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;const t=this.owner;t.visible&&t.alpha>=.1&&this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class Yt extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this.skeNode=null,this.state=C.READY}onEnable(){const t=this.owner;t.__type__=x.MAGNET,this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),t.visible=!1,this.skeNode&&(this.skeNode.blendMode=Laya.BlendMode.LIGHTER),this.state=C.START,Laya.timer.loop(3e3,this,()=>{this.ins.gameState==C.START&&(t.visible=!0,this.schedule(200,()=>{this.quadTree.check(X.instance.enemyCols,this.selfCol),this.selfCol.bids=[],S.event(V.LaserHide,this.selfCol)},this,2,null,!0,()=>{t.visible=!1}))})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;t.x=this.ins.playerV2.x,t.y=this.ins.playerV2.y}}class Xt extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.state=C.READY}onEnable(){const t=this.owner;this.state=C.START,this.selfCol=this.owner.getComponent(v);const e=this.ins.playerCols;t.alpha=0,Laya.timer.loop(5e3,this,()=>{Laya.Tween.to(t,{alpha:1},500,null,Laya.Handler.create(this,()=>{e.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol)})),Laya.timer.once(1500,this,()=>{let s=e.indexOf(this.selfCol);s>-1&&e.splice(s,1),Laya.Tween.to(t,{alpha:0},500)})})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins;t.gameState==C.START&&this.owner.pos(t.playerV2.x,t.playerV2.y)}}class zt extends f{constructor(){super(),this.ins=X.instance,this.selfCol=null,this.quadTree=null,this.state=C.READY,this._norV3=null,this.speed=.6}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){const t=this.owner,e=this.ins;t.__type__=x.MAGNET,this.selfCol=this.owner.getComponent(v),this.quadTree||(this.quadTree=new A({x:0,y:0,width:720,height:1280})),this.state=C.START;const s=this.getRes(p.battle.PlayerBlast);Laya.timer.loop(500,this,()=>{if(this.ins.gameState!=C.START)return;this.quadTree.check(this.ins.enemyCols,this.selfCol);const i=this.open(p.battle.PlayerBlast,s);i.pos(t.x,t.y),e.effectNode.addChild(i),this.selfCol.bids=[],S.event(V.LaserHide,this.selfCol)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=C.START)return;if(this.state!=C.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=0||t.x>=720||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class Gt extends f{constructor(){super(),this.ins=X.instance,this.wing1BPre=null,this.wing1BPre=this.getRes(p.battle.PlayerWing1b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=h.skills[P.BlastWing],i=s.speed||5;s.fspeed;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=C.START)return;const i=this.open(p.battle.PlayerWing1b,this.wing1BPre);let l=i.getComponent(_);l||(l=i.addComponent(_));const a=s.value||1;l.setData(e.attack*a,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),i.getComponent(zt).norV3=this.getVec3(0,-1),i.pos(t.x,t.y),this.ins.playerNode.addChild(i)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}onLateUpdate(){}}class Ft extends f{constructor(){super(),this.ins=X.instance,this.wing4BPre=null,this.wing4BPre=this.getRes(p.battle.PlayerWing4b)}onEnable(){const t=this.owner,e=this.ins.playerData,s=h.skills[P.AutoWing],i=s.speed/5||.2;s.fspeed;Laya.timer.loop(1e3*i,this,()=>{if(this.ins.gameState!=C.START)return;const i=this.open(p.battle.PlayerWing4b,this.wing4BPre);let l=i.getComponent(_);l||(l=i.addComponent(_));const a=s.value||1;l.setData(e.attack*a,e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr);const n=i.getComponent(M);n.speed=.5,n.state=C.START,n.norV3=this.getVec3(0,-1);let o=this.ins.getMinEnemy(t),r=180;if(o&&o.parent){n.tar=o;let e=this.getVec3(0,-1),s=this.getVec3();Laya.Vector3.subtract(this.getVec3(o.x,o.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,e),n.norV3=e,r=i.rotation}t.rotation=r,i.pos(t.x,t.y-50),this.ins.playerNode.addChild(i)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),S.offAllCaller(this)}onLateUpdate(){}}class Qt extends Laya.Script{constructor(){super(),this.selectIndex=0,this.itemScale=1,this.space=25,this.startY=0,this.selectDistance=0,this.itemX=[],this.dragRegion=null}onEnable(){const t=this.owner;this.startY=t.y;const e=t.getChildAt(0),s=t.x,i=this.space,l=e.width,a=e.x;this.selectDistance=(l+i)/2;let n=this.owner.numChildren;const o=l*n+i*(n-1);t.width=o;for(let e=0;e<n;e++){let n=-e*(l+i)+s;this.itemX[e]=n;const o=t.getChildAt(e);o.x=a+e*(l+i);let r=e==this.selectIndex?1:this.itemScale;o.scaleX=r,o.scaleY=r}this.dragRegion=new Laya.Rectangle(t.x-o+l,t.y,o-l,0),t.on(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.on(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.on(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.on(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd),t.x=this.itemX[this.selectIndex]}onBoxMove(){this.owner.startDrag(this.dragRegion,!1,100)}onBoxMoving(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);let s=1-Math.abs(t.x-this.itemX[0])/100*.15;return e.scaleX=s,void(e.scaleY=s)}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);let s=1-Math.abs(this.itemX[this.itemX.length-1]-t.x)/100*.15;return e.scaleX=s,void(e.scaleY=s)}for(let e=0;e<this.itemX.length;e++){let s=t.getChildAt(e),i=t.getChildAt(e+1),l=this.itemX[e],a=this.itemX[e+1];if(t.x>=a&&t.x<=l){let n=1-Math.abs(t.x-l)/Math.abs(l-a)*(1-this.itemScale),o=this.itemScale+1-n;s.scaleX=n,s.scaleY=n,i.scaleX=o,i.scaleY=o,e++}else s.scaleX=this.itemScale,s.scaleY=this.itemScale}}onBoxMoveEnd(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);return void Laya.Tween.to(e,{scaleX:1,scaleY:1},100)}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);return void Laya.Tween.to(e,{scaleX:1,scaleY:1},100)}t.stopDrag();for(let e=0;e<this.itemX.length;e++){const s=this.itemX[e];if(t.x!=s&&Math.abs(t.x-s)<=this.selectDistance){Laya.Tween.to(t,{x:s},100),this.selectIndex=e;break}}let e=this.owner.numChildren;for(let s=0;s<e;s++){const e=t.getChildAt(s);let i=s==this.selectIndex?1:this.itemScale;Laya.Tween.to(e,{scaleX:i,scaleY:i},100)}}onDisable(){const t=this.owner;t.off(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.off(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.off(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.off(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd)}onUpdate(){const t=this.owner;t.y!=this.startY&&(t.y=this.startY)}}class $t{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("app/battle/SkillManager.ts",ht),t("app/battle/EnemyManager.ts",ct),t("app/battle/PlayerManager.ts",yt),t("app/battle/SkillDialog.ts",pt),t("app/battle/BattleScene.ts",X),t("app/battle/bg/BattleSceneUI.ts",gt),t("app/lobby/LobbySceneUI.ts",St),t("core/component/Toggle.ts",Ct),t("core/component/ToggleContainer.ts",ft),t("app/lobby/LobbyScene.ts",Pt),t("app/battle/bg/BgNode.ts",wt),t("app/battle/bg/ChooseSkillDialog.ts",dt),t("app/battle/bg/GamePauseDialog.ts",Et),t("app/battle/effect/EnemyBoom.ts",vt),t("app/battle/effect/LighterSkeleton.ts",Bt),t("app/battle/effect/PlayerBlast.ts",Rt),t("app/battle/effect/PlayerLaserHit.ts",R),t("core/utils/BoxCollision.ts",v),t("app/battle/enemy/Enemy.ts",U),t("app/battle/enemy/EnemyCollision.ts",q),t("app/battle/enemy/EnemySkill.ts",I),t("app/battle/enemy/Enemy1001.ts",Dt),t("app/battle/enemy/Enemy2001.ts",_t),t("app/battle/enemy/EnemyHPTip.ts",At),t("app/battle/enemySkill/EnemyLine.ts",H),t("app/battle/enemySkill/EnemySkill1.ts",W),t("app/battle/enemySkill/EnemySkill13.ts",Mt),t("app/battle/enemySkill/EnemySkill3.ts",j),t("app/battle/player/Player.ts",Y),t("app/battle/player/PlayerCollision.ts",Ht),t("app/battle/player/PlayerHP.ts",Wt),t("app/battle/robot/PlayerRobot.ts",G),t("app/battle/robot/PlayerRobot1.ts",jt),t("app/battle/robot/PlayerRobot2.ts",It),t("app/battle/robot/PlayerRobot3.ts",Nt),t("app/battle/skill/PlayerDieBoom.ts",Ut),t("app/battle/skill/PlayerSkill1.ts",M),t("app/battle/player/PlayerLaser.ts",z),t("app/battle/player/PlayerLaserCollision.ts",qt),t("app/battle/skill/PlayerShield.ts",F),t("app/battle/skill/PlayerSkill6.ts",J),t("app/battle/skill/PlayerSkill2.ts",Q),t("app/battle/skill/PlayerSkill3.ts",Ot),t("app/battle/skill/PlayerSkill4.ts",$),t("app/battle/skill/PlayerSkill5.ts",Z),t("app/battle/skill/PlayerSkill7.ts",K),t("app/battle/skill/PlayerSkill9.ts",Yt),t("app/battle/skill/PlayerTimeShield.ts",Xt),t("app/battle/wing/PlayerWing.ts",et),t("app/battle/wing/PlayerWing1.ts",Gt),t("app/battle/skill/PlayerSkill11.ts",zt),t("app/battle/wing/PlayerWing2.ts",it),t("app/battle/skill/PlayerSkill10.ts",st),t("app/battle/wing/PlayerWing3.ts",at),t("app/battle/wing/PlayerWingLaser.ts",lt),t("app/battle/wing/PlayerWing4.ts",Ft),t("app/battle/wing/PlayerWing5.ts",nt),t("app/battle/wing/PlayerWing6.ts",rt),t("app/battle/skill/PlayerSkill12.ts",ot),t("core/component/HorizontalSelect.ts",Qt),t("app/lobby/BattlePage.ts",xt),t("app/lobby/hangar/HangarPage.ts",Lt)}}$t.width=720,$t.height=1280,$t.scaleMode="fixedwidth",$t.screenMode="none",$t.alignV="top",$t.alignH="center",$t.startScene="LobbyScene.scene",$t.sceneRoot="",$t.debug=!1,$t.stat=!1,$t.physicsDebug=!1,$t.exportSceneToJson=!0,$t.init();new class{constructor(){window.Laya3D?Laya3D.init($t.width,$t.height):Laya.init($t.width,$t.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=$t.scaleMode,Laya.stage.screenMode=$t.screenMode,Laya.stage.alignV=$t.alignV,Laya.stage.alignH=$t.alignH,Laya.URL.exportSceneToJson=$t.exportSceneToJson,($t.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),$t.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),$t.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.ClassUtils.regClass("laya.effect.ColorFilterSetter",Laya.ColorFilterSetter),Laya.ClassUtils.regClass("laya.effect.GlowFilterSetter",Laya.GlowFilterSetter),Laya.ClassUtils.regClass("laya.effect.BlurFilterSetter",Laya.BlurFilterSetter)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){const t=()=>{$t.startScene&&Laya.Scene.open($t.startScene)},e=[];for(const t in b){const s=b[t];e.push(s)}const s=[];for(const t in k){const e=k[t];s.push(e)}let a=0;Laya.loader.load(e,Laya.Handler.create(this,()=>{2==++a&&t()})),Laya.loader.load(s,Laya.Handler.create(this,()=>{a++;const e=Laya.loader.getRes(k.Chapter);o.setChatpers(e);const s=Laya.loader.getRes(k.Skill);h.setSkills(s);const n=Laya.loader.getRes(k.Enaircraft);r.setEnemys(n);const c=Laya.loader.getRes(k.Level1);i.setEnemys1(c);const p=Laya.loader.getRes(k.Exp);l.setExps(p);const d=Laya.loader.getRes(k.Upaircraft);y.setPlanes(d),2==a&&t()}),null,Laya.Loader.JSON)}}}();